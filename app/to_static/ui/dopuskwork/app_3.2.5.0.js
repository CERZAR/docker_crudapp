//@charset UTF-8
var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.defineProperty=$jscomp.ASSUME_ES5||'function'==typeof Object.defineProperties?Object.defineProperty:function(target,property,descriptor){target!=Array.prototype&&target!=Object.prototype&&(target[property]=descriptor.value)};
$jscomp.getGlobal=function(maybeGlobal){return'undefined'!=typeof window&&window===maybeGlobal?maybeGlobal:'undefined'!=typeof global&&null!=global?global:maybeGlobal};$jscomp.global=$jscomp.getGlobal(this);$jscomp.SYMBOL_PREFIX='jscomp_symbol_';$jscomp.initSymbol=function(){$jscomp.initSymbol=function(){};$jscomp.global.Symbol||($jscomp.global.Symbol=$jscomp.Symbol)};$jscomp.Symbol=function(){var counter=0;return function(opt_description){return $jscomp.SYMBOL_PREFIX+(opt_description||'')+counter++}}();
$jscomp.initSymbolIterator=function(){$jscomp.initSymbol();var symbolIterator=$jscomp.global.Symbol.iterator;symbolIterator||(symbolIterator=$jscomp.global.Symbol.iterator=$jscomp.global.Symbol('iterator'));'function'!=typeof Array.prototype[symbolIterator]&&$jscomp.defineProperty(Array.prototype,symbolIterator,{configurable:!0,writable:!0,value:function(){return $jscomp.arrayIterator(this)}});$jscomp.initSymbolIterator=function(){}};
$jscomp.arrayIterator=function(array){var index=0;return $jscomp.iteratorPrototype(function(){return index<array.length?{done:!1,value:array[index++]}:{done:!0}})};$jscomp.iteratorPrototype=function(next){$jscomp.initSymbolIterator();next={next:next};next[$jscomp.global.Symbol.iterator]=function(){return this};return next};
$jscomp.makeIterator=function(iterable){$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();var iteratorFunction=iterable[Symbol.iterator];return iteratorFunction?iteratorFunction.call(iterable):$jscomp.arrayIterator(iterable)};
$jscomp.polyfill=function(target,polyfill,fromLang,toLang){if(polyfill){fromLang=$jscomp.global;target=target.split('.');for(toLang=0;toLang<target.length-1;toLang++){var key=target[toLang];key in fromLang||(fromLang[key]={});fromLang=fromLang[key]}target=target[target.length-1];toLang=fromLang[target];polyfill=polyfill(toLang);polyfill!=toLang&&null!=polyfill&&$jscomp.defineProperty(fromLang,target,{configurable:!0,writable:!0,value:polyfill})}};$jscomp.FORCE_POLYFILL_PROMISE=!1;
$jscomp.polyfill('Promise',function(NativePromise){function AsyncExecutor(){this.batch_=null}function resolvingPromise(opt_value){return opt_value instanceof PolyfillPromise?opt_value:new PolyfillPromise(function(resolve,reject){resolve(opt_value)})}if(NativePromise&&!$jscomp.FORCE_POLYFILL_PROMISE)return NativePromise;AsyncExecutor.prototype.asyncExecute=function(f){null==this.batch_&&(this.batch_=[],this.asyncExecuteBatch_());this.batch_.push(f);return this};AsyncExecutor.prototype.asyncExecuteBatch_=
function(){var self=this;this.asyncExecuteFunction(function(){self.executeBatch_()})};var nativeSetTimeout=$jscomp.global.setTimeout;AsyncExecutor.prototype.asyncExecuteFunction=function(f){nativeSetTimeout(f,0)};AsyncExecutor.prototype.executeBatch_=function(){for(;this.batch_&&this.batch_.length;){var executingBatch=this.batch_;this.batch_=[];for(var i=0;i<executingBatch.length;++i){var f=executingBatch[i];executingBatch[i]=null;try{f()}catch(error){this.asyncThrow_(error)}}}this.batch_=null};AsyncExecutor.prototype.asyncThrow_=
function(exception){this.asyncExecuteFunction(function(){throw exception;})};var PolyfillPromise=function(executor){this.state_=0;this.result_=void 0;this.onSettledCallbacks_=[];var resolveAndReject=this.createResolveAndReject_();try{executor(resolveAndReject.resolve,resolveAndReject.reject)}catch(e){resolveAndReject.reject(e)}};PolyfillPromise.prototype.createResolveAndReject_=function(){function firstCallWins(method){return function(x){alreadyCalled||(alreadyCalled=!0,method.call(thisPromise,x))}}
var thisPromise=this,alreadyCalled=!1;return{resolve:firstCallWins(this.resolveTo_),reject:firstCallWins(this.reject_)}};PolyfillPromise.prototype.resolveTo_=function(value){if(value===this)this.reject_(new TypeError('A Promise cannot resolve to itself'));else if(value instanceof PolyfillPromise)this.settleSameAsPromise_(value);else{a:switch(typeof value){case 'object':var JSCompiler_inline_result=null!=value;break a;case 'function':JSCompiler_inline_result=!0;break a;default:JSCompiler_inline_result=
!1}JSCompiler_inline_result?this.resolveToNonPromiseObj_(value):this.fulfill_(value)}};PolyfillPromise.prototype.resolveToNonPromiseObj_=function(obj){var thenMethod=void 0;try{thenMethod=obj.then}catch(error){this.reject_(error);return}'function'==typeof thenMethod?this.settleSameAsThenable_(thenMethod,obj):this.fulfill_(obj)};PolyfillPromise.prototype.reject_=function(reason){this.settle_(2,reason)};PolyfillPromise.prototype.fulfill_=function(value){this.settle_(1,value)};PolyfillPromise.prototype.settle_=
function(settledState,valueOrReason){if(0!=this.state_)throw Error('Cannot settle('+settledState+', '+valueOrReason+'): Promise already settled in state'+this.state_);this.state_=settledState;this.result_=valueOrReason;this.executeOnSettledCallbacks_()};PolyfillPromise.prototype.executeOnSettledCallbacks_=function(){if(null!=this.onSettledCallbacks_){for(var i=0;i<this.onSettledCallbacks_.length;++i)asyncExecutor.asyncExecute(this.onSettledCallbacks_[i]);this.onSettledCallbacks_=null}};var asyncExecutor=
new AsyncExecutor;PolyfillPromise.prototype.settleSameAsPromise_=function(promise){var methods=this.createResolveAndReject_();promise.callWhenSettled_(methods.resolve,methods.reject)};PolyfillPromise.prototype.settleSameAsThenable_=function(thenMethod,thenable){var methods=this.createResolveAndReject_();try{thenMethod.call(thenable,methods.resolve,methods.reject)}catch(error){methods.reject(error)}};PolyfillPromise.prototype.then=function(onFulfilled,onRejected){function createCallback(paramF,defaultF){return'function'==
typeof paramF?function(x){try{resolveChild(paramF(x))}catch(error){rejectChild(error)}}:defaultF}var resolveChild,rejectChild,childPromise=new PolyfillPromise(function(resolve,reject){resolveChild=resolve;rejectChild=reject});this.callWhenSettled_(createCallback(onFulfilled,resolveChild),createCallback(onRejected,rejectChild));return childPromise};PolyfillPromise.prototype.catch=function(onRejected){return this.then(void 0,onRejected)};PolyfillPromise.prototype.callWhenSettled_=function(onFulfilled,
onRejected){function callback(){switch(thisPromise.state_){case 1:onFulfilled(thisPromise.result_);break;case 2:onRejected(thisPromise.result_);break;default:throw Error('Unexpected state: '+thisPromise.state_);}}var thisPromise=this;null==this.onSettledCallbacks_?asyncExecutor.asyncExecute(callback):this.onSettledCallbacks_.push(callback)};PolyfillPromise.resolve=resolvingPromise;PolyfillPromise.reject=function(opt_reason){return new PolyfillPromise(function(resolve,reject){reject(opt_reason)})};
PolyfillPromise.race=function(thenablesOrValues){return new PolyfillPromise(function(resolve,reject){for(var iterator=$jscomp.makeIterator(thenablesOrValues),iterRec=iterator.next();!iterRec.done;iterRec=iterator.next())resolvingPromise(iterRec.value).callWhenSettled_(resolve,reject)})};PolyfillPromise.all=function(thenablesOrValues){var iterator=$jscomp.makeIterator(thenablesOrValues),iterRec=iterator.next();return iterRec.done?resolvingPromise([]):new PolyfillPromise(function(resolveAll,rejectAll){function onFulfilled(i){return function(ithResult){resultsArray[i]=
ithResult;unresolvedCount--;0==unresolvedCount&&resolveAll(resultsArray)}}var resultsArray=[],unresolvedCount=0;do resultsArray.push(void 0),unresolvedCount++,resolvingPromise(iterRec.value).callWhenSettled_(onFulfilled(resultsArray.length-1),rejectAll),iterRec=iterator.next();while(!iterRec.done)})};return PolyfillPromise},'es6','es3');
$jscomp.polyfill('Promise.prototype.finally',function(orig){return orig?orig:function(onFinally){return this.then(function(value){return Promise.resolve(onFinally()).then(function(){return value})},function(reason){return Promise.resolve(onFinally()).then(function(){throw reason;})})}},'es9','es3');$jscomp.underscoreProtoCanBeSet=function(){var x={a:!0},y={};try{return y.__proto__=x,y.a}catch(e){}return!1};
$jscomp.setPrototypeOf='function'==typeof Object.setPrototypeOf?Object.setPrototypeOf:$jscomp.underscoreProtoCanBeSet()?function(target,proto){target.__proto__=proto;if(target.__proto__!==proto)throw new TypeError(target+' is not extensible');return target}:null;$jscomp.generator={};$jscomp.generator.ensureIteratorResultIsObject_=function(result){if(!(result instanceof Object))throw new TypeError('Iterator result '+result+' is not an object');};
$jscomp.generator.Context=function(){this.isRunning_=!1;this.yieldAllIterator_=null;this.yieldResult=void 0;this.nextAddress=1;this.finallyAddress_=this.catchAddress_=0;this.finallyContexts_=this.abruptCompletion_=null};$jscomp.generator.Context.prototype.start_=function(){if(this.isRunning_)throw new TypeError('Generator is already running');this.isRunning_=!0};$jscomp.generator.Context.prototype.stop_=function(){this.isRunning_=!1};
$jscomp.generator.Context.prototype.jumpToErrorHandler_=function(){this.nextAddress=this.catchAddress_||this.finallyAddress_};$jscomp.generator.Context.prototype.next_=function(value){this.yieldResult=value};$jscomp.generator.Context.prototype.throw_=function(e){this.abruptCompletion_={exception:e,isException:!0};this.jumpToErrorHandler_()};$jscomp.generator.Context.prototype.return=function(value){this.abruptCompletion_={return:value};this.nextAddress=this.finallyAddress_};
$jscomp.generator.Context.prototype.jumpThroughFinallyBlocks=function(nextAddress){this.abruptCompletion_={jumpTo:nextAddress};this.nextAddress=this.finallyAddress_};$jscomp.generator.Context.prototype.yield=function(value,resumeAddress){this.nextAddress=resumeAddress;return{value:value}};
$jscomp.generator.Context.prototype.yieldAll=function(iterable,resumeAddress){iterable=$jscomp.makeIterator(iterable);var result=iterable.next();$jscomp.generator.ensureIteratorResultIsObject_(result);if(result.done)this.yieldResult=result.value,this.nextAddress=resumeAddress;else return this.yieldAllIterator_=iterable,this.yield(result.value,resumeAddress)};$jscomp.generator.Context.prototype.jumpTo=function(nextAddress){this.nextAddress=nextAddress};
$jscomp.generator.Context.prototype.jumpToEnd=function(){this.nextAddress=0};$jscomp.generator.Context.prototype.setCatchFinallyBlocks=function(catchAddress,finallyAddress){this.catchAddress_=catchAddress;void 0!=finallyAddress&&(this.finallyAddress_=finallyAddress)};$jscomp.generator.Context.prototype.setFinallyBlock=function(finallyAddress){this.catchAddress_=0;this.finallyAddress_=finallyAddress||0};
$jscomp.generator.Context.prototype.leaveTryBlock=function(nextAddress,catchAddress){this.nextAddress=nextAddress;this.catchAddress_=catchAddress||0};$jscomp.generator.Context.prototype.enterCatchBlock=function(nextCatchBlockAddress){this.catchAddress_=nextCatchBlockAddress||0;nextCatchBlockAddress=this.abruptCompletion_.exception;this.abruptCompletion_=null;return nextCatchBlockAddress};
$jscomp.generator.Context.prototype.enterFinallyBlock=function(nextCatchAddress,nextFinallyAddress,finallyDepth){finallyDepth?this.finallyContexts_[finallyDepth]=this.abruptCompletion_:this.finallyContexts_=[this.abruptCompletion_];this.catchAddress_=nextCatchAddress||0;this.finallyAddress_=nextFinallyAddress||0};
$jscomp.generator.Context.prototype.leaveFinallyBlock=function(nextAddress,finallyDepth){finallyDepth=this.finallyContexts_.splice(finallyDepth||0)[0];if(finallyDepth=this.abruptCompletion_=this.abruptCompletion_||finallyDepth){if(finallyDepth.isException)return this.jumpToErrorHandler_();void 0!=finallyDepth.jumpTo&&this.finallyAddress_<finallyDepth.jumpTo?(this.nextAddress=finallyDepth.jumpTo,this.abruptCompletion_=null):this.nextAddress=this.finallyAddress_}else this.nextAddress=nextAddress};
$jscomp.generator.Context.prototype.forIn=function(object){return new $jscomp.generator.Context.PropertyIterator(object)};$jscomp.generator.Context.PropertyIterator=function(object){this.object_=object;this.properties_=[];for(var property in object)this.properties_.push(property);this.properties_.reverse()};$jscomp.generator.Context.PropertyIterator.prototype.getNext=function(){for(;0<this.properties_.length;){var property=this.properties_.pop();if(property in this.object_)return property}return null};
$jscomp.generator.Engine_=function(program){this.context_=new $jscomp.generator.Context;this.program_=program};$jscomp.generator.Engine_.prototype.next_=function(value){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_.next,value,this.context_.next_);this.context_.next_(value);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.return_=function(value){this.context_.start_();var yieldAllIterator=this.context_.yieldAllIterator_;if(yieldAllIterator)return this.yieldAllStep_('return'in yieldAllIterator?yieldAllIterator['return']:function(v){return{value:v,done:!0}},value,this.context_.return);this.context_.return(value);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.throw_=function(exception){this.context_.start_();if(this.context_.yieldAllIterator_)return this.yieldAllStep_(this.context_.yieldAllIterator_['throw'],exception,this.context_.next_);this.context_.throw_(exception);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.yieldAllStep_=function(action,value,nextAction){try{var result=action.call(this.context_.yieldAllIterator_,value);$jscomp.generator.ensureIteratorResultIsObject_(result);if(!result.done)return this.context_.stop_(),result;var resultValue=result.value}catch(e){return this.context_.yieldAllIterator_=null,this.context_.throw_(e),this.nextStep_()}this.context_.yieldAllIterator_=null;nextAction.call(this.context_,resultValue);return this.nextStep_()};
$jscomp.generator.Engine_.prototype.nextStep_=function(){for(;this.context_.nextAddress;)try{var yieldValue=this.program_(this.context_);if(yieldValue)return this.context_.stop_(),{value:yieldValue.value,done:!1}}catch(e){this.context_.yieldResult=void 0,this.context_.throw_(e)}this.context_.stop_();if(this.context_.abruptCompletion_){yieldValue=this.context_.abruptCompletion_;this.context_.abruptCompletion_=null;if(yieldValue.isException)throw yieldValue.exception;return{value:yieldValue.return,
done:!0}}return{value:void 0,done:!0}};$jscomp.generator.Generator_=function(engine){this.next=function(opt_value){return engine.next_(opt_value)};this.throw=function(exception){return engine.throw_(exception)};this.return=function(value){return engine.return_(value)};$jscomp.initSymbolIterator();$jscomp.initSymbol();$jscomp.initSymbolIterator();this[Symbol.iterator]=function(){return this}};
$jscomp.generator.createGenerator=function(generator,program){program=new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(program));$jscomp.setPrototypeOf&&$jscomp.setPrototypeOf(program,generator.prototype);return program};
$jscomp.asyncExecutePromiseGenerator=function(generator){function passValueToGenerator(value){return generator.next(value)}function passErrorToGenerator(error){return generator.throw(error)}return new Promise(function(resolve,reject){function handleGeneratorRecord(genRec){genRec.done?resolve(genRec.value):Promise.resolve(genRec.value).then(passValueToGenerator,passErrorToGenerator).then(handleGeneratorRecord,reject)}handleGeneratorRecord(generator.next())})};
$jscomp.asyncExecutePromiseGeneratorFunction=function(generatorFunction){return $jscomp.asyncExecutePromiseGenerator(generatorFunction())};$jscomp.asyncExecutePromiseGeneratorProgram=function(program){return $jscomp.asyncExecutePromiseGenerator(new $jscomp.generator.Generator_(new $jscomp.generator.Engine_(program)))};
Ext.define('Ext.theme.neptune.Component',{override:'Ext.Component',initComponent:function(){this.callParent();this.dock&&void 0===this.border&&(this.border=!1)},privates:{initStyles:function(){var hasOwnBorder=this.hasOwnProperty('border'),border=this.border;this.dock&&(this.border=null);this.callParent(arguments);hasOwnBorder?this.border=border:delete this.border}}},function(){Ext.namespace('Ext.theme.is').Neptune=!0;Ext.theme.name='Neptune'});
Ext.define('Ext.theme.triton.Component',{override:'Ext.Component'},function(){Ext.namespace('Ext.theme.is').Triton=!0;Ext.theme.name='Triton'});Ext.define('Ext.theme.neptune.resizer.Splitter',{override:'Ext.resizer.Splitter',size:8});Ext.define('Ext.theme.triton.resizer.Splitter',{override:'Ext.resizer.Splitter',size:10});Ext.define('Ext.theme.neptune.toolbar.Toolbar',{override:'Ext.toolbar.Toolbar',usePlainButtons:!1,border:!1});
Ext.define('Ext.theme.neptune.toolbar.Paging',{override:'Ext.toolbar.Paging',defaultButtonUI:'plain-toolbar',inputItemWidth:40});Ext.define('Ext.theme.triton.toolbar.Paging',{override:'Ext.toolbar.Paging',inputItemWidth:50});
Ext.define('Ext.theme.neptune.layout.component.Dock',{override:'Ext.layout.component.Dock',noBorderClassTable:[0,Ext.baseCSSPrefix+'noborder-l',Ext.baseCSSPrefix+'noborder-b',Ext.baseCSSPrefix+'noborder-bl',Ext.baseCSSPrefix+'noborder-r',Ext.baseCSSPrefix+'noborder-rl',Ext.baseCSSPrefix+'noborder-rb',Ext.baseCSSPrefix+'noborder-rbl',Ext.baseCSSPrefix+'noborder-t',Ext.baseCSSPrefix+'noborder-tl',Ext.baseCSSPrefix+'noborder-tb',Ext.baseCSSPrefix+'noborder-tbl',Ext.baseCSSPrefix+'noborder-tr',Ext.baseCSSPrefix+
'noborder-trl',Ext.baseCSSPrefix+'noborder-trb',Ext.baseCSSPrefix+'noborder-trbl'],edgeMasks:{top:8,right:4,bottom:2,left:1},handleItemBorders:function(){var edges=0,owner=this.owner,bodyBorder=owner.bodyBorder,ownerBorder=owner.border,collapsed=this.collapsed,edgeMasks=this.edgeMasks,noBorderCls=this.noBorderClassTable,dockedItemsGen=owner.dockedItems.generation,ln;if(this.initializedBorders!==dockedItemsGen){var addCls=[];var removeCls=[];var borderCls=this.getBorderCollapseTable();noBorderCls=
this.getBorderClassTable?this.getBorderClassTable():noBorderCls;this.initializedBorders=dockedItemsGen;this.collapsed=!1;dockedItemsGen=this.getDockedItems('visual');this.collapsed=collapsed;var i=0;for(ln=dockedItemsGen.length;i<ln;i++){var item=dockedItemsGen[i];if(!item.ignoreBorderManagement){var dock=item.dock;var mask=collapsed=0;addCls.length=0;removeCls.length=0;if('bottom'!==dock){if(edges&8)var b=item.border;else b=ownerBorder,!1!==b&&(collapsed+=8);!1===b&&(mask+=8)}'left'!==dock&&(edges&
4?b=item.border:(b=ownerBorder,!1!==b&&(collapsed+=4)),!1===b&&(mask+=4));'top'!==dock&&(edges&2?b=item.border:(b=ownerBorder,!1!==b&&(collapsed+=2)),!1===b&&(mask+=2));'right'!==dock&&(edges&1?b=item.border:(b=ownerBorder,!1!==b&&(collapsed+=1)),!1===b&&(mask+=1));(b=item.lastBorderMask)!==mask&&(item.lastBorderMask=mask,b&&(removeCls[0]=noBorderCls[b]),mask&&(addCls[0]=noBorderCls[mask]));(b=item.lastBorderCollapse)!==collapsed&&(item.lastBorderCollapse=collapsed,b&&(removeCls[removeCls.length]=
borderCls[b]),collapsed&&(addCls[addCls.length]=borderCls[collapsed]));removeCls.length&&item.removeCls(removeCls);addCls.length&&item.addCls(addCls);edges|=edgeMasks[dock]}}mask=collapsed=0;addCls.length=0;removeCls.length=0;edges&8?b=bodyBorder:(b=ownerBorder,!1!==b&&(collapsed+=8));!1===b&&(mask+=8);edges&4?b=bodyBorder:(b=ownerBorder,!1!==b&&(collapsed+=4));!1===b&&(mask+=4);edges&2?b=bodyBorder:(b=ownerBorder,!1!==b&&(collapsed+=2));!1===b&&(mask+=2);edges&1?b=bodyBorder:(b=ownerBorder,!1!==
b&&(collapsed+=1));!1===b&&(mask+=1);(b=this.lastBodyBorderMask)!==mask&&(this.lastBodyBorderMask=mask,b&&(removeCls[0]=noBorderCls[b]),mask&&(addCls[0]=noBorderCls[mask]));(b=this.lastBodyBorderCollapse)!==collapsed&&(this.lastBodyBorderCollapse=collapsed,b&&(removeCls[removeCls.length]=borderCls[b]),collapsed&&(addCls[addCls.length]=borderCls[collapsed]));removeCls.length&&owner.removeBodyCls(removeCls);addCls.length&&owner.addBodyCls(addCls)}},onRemove:function(item){var lastBorderMask=item.lastBorderMask,
lastBorderCollapse=item.lastBorderCollapse;item.destroyed||item.ignoreBorderManagement||(lastBorderMask&&(item.lastBorderMask=0,item.removeCls(this.noBorderClassTable[lastBorderMask])),lastBorderCollapse&&(item.lastBorderCollapse=0,item.removeCls(this.getBorderCollapseTable()[lastBorderCollapse])));this.callParent([item])}});Ext.define('Ext.theme.neptune.panel.Panel',{override:'Ext.panel.Panel',border:!1,bodyBorder:!1,initBorderProps:Ext.emptyFn,initBodyBorder:function(){!0!==this.bodyBorder&&this.callParent()}});
Ext.define('Ext.theme.neptune.form.field.HtmlEditor',{override:'Ext.form.field.HtmlEditor',defaultButtonUI:'plain-toolbar'});
Ext.onReady(function(){Ext.Date&&(Ext.Date.defaultFormat='d.m.Y',Ext.Date.monthNames='Январь Февраль Март Апрель Май Июнь Июль Август Сентябрь Октябрь Ноябрь Декабрь'.split(' '),Ext.Date.shortMonthNames='Янв Февр Март Апр Май Июнь Июль Авг Сент Окт Нояб Дек'.split(' '),Ext.Date.getShortMonthName=function(month){return Ext.Date.shortMonthNames[month]},Ext.Date.monthNumbers={'Янв':0,'Фев':1,'Мар':2,'Апр':3,'Май':4,'Июн':5,'Июл':6,'Авг':7,'Сен':8,'Окт':9,'Ноя':10,'Дек':11},Ext.Date.getMonthNumber=function(name){return Ext.Date.monthNumbers[name.substring(0,
1).toUpperCase()+name.substring(1,3).toLowerCase()]},Ext.Date.dayNames='Воскресенье Понедельник Вторник Среда Четверг Пятница Суббота'.split(' '),Ext.Date.getShortDayName=function(day){return Ext.Date.dayNames[day].substring(0,3)});Ext.util&&Ext.util.Format&&Ext.apply(Ext.util.Format,{thousandSeparator:' ',decimalSeparator:',',currencySign:'руб',dateFormat:'d.m.Y'})});Ext.define('Ext.locale.ru.view.View',{override:'Ext.view.View',emptyText:''});
Ext.define('Ext.locale.ru.grid.plugin.DragDrop',{override:'Ext.grid.plugin.DragDrop',dragText:'{0} выбранных строк'});Ext.define('Ext.locale.ru.tab.Tab',{override:'Ext.tab.Tab',closeText:'Закрыть эту вкладку'});Ext.define('Ext.locale.ru.form.field.Base',{override:'Ext.form.field.Base',invalidText:'Значение в этом поле неверное'});Ext.define('Ext.locale.ru.view.AbstractView',{override:'Ext.view.AbstractView',loadingText:'Загрузка...'});
Ext.define('Ext.locale.ru.picker.Date',{override:'Ext.picker.Date',todayText:'Сегодня',minText:'Эта дата раньше минимальной даты',maxText:'Эта дата позже максимальной даты',disabledDaysText:'Недоступно',disabledDatesText:'Недоступно',nextText:'Следующий месяц (Control+Вправо)',prevText:'Предыдущий месяц (Control+Влево)',monthYearText:'Выбор месяца (Control+Вверх/Вниз для выбора года)',todayTip:'{0} (Пробел)',format:'d.m.y',startDay:1});
Ext.define('Ext.locale.ru.picker.Month',{override:'Ext.picker.Month',okText:'\x26#160;OK\x26#160;',cancelText:'Отмена'});Ext.define('Ext.locale.ru.toolbar.Paging',{override:'Ext.PagingToolbar',beforePageText:'Страница',afterPageText:'из {0}',firstText:'Первая страница',prevText:'Предыдущая страница',nextText:'Следующая страница',lastText:'Последняя страница',refreshText:'Обновить',displayMsg:'Отображаются записи с {0} по {1}, всего {2}',emptyMsg:'Нет данных для отображения'});
Ext.define('Ext.locale.ru.form.field.Text',{override:'Ext.form.field.Text',minLengthText:'Минимальная длина этого поля {0}',maxLengthText:'Максимальная длина этого поля {0}',blankText:'Это поле обязательно для заполнения',regexText:'',emptyText:null});Ext.define('Ext.locale.ru.form.field.Number',{override:'Ext.form.field.Number',minText:'Значение этого поля не может быть меньше {0}',maxText:'Значение этого поля не может быть больше {0}',nanText:'{0} не является числом',negativeText:'Значение не может быть отрицательным'});
Ext.define('Ext.locale.ru.form.field.Date',{override:'Ext.form.field.Date',disabledDaysText:'Недоступно',disabledDatesText:'Недоступно',minText:'Дата в этом поле должна быть позже {0}',maxText:'Дата в этом поле должна быть раньше {0}',invalidText:'{0} не является правильной датой - дата должна быть указана в формате {1}',format:'d.m.y',altFormats:'d.m.y|d/m/Y|d-m-y|d-m-Y|d/m|d-m|dm|dmy|dmY|d|Y-m-d'});
Ext.define('Ext.locale.ru.form.field.ComboBox',{override:'Ext.form.field.ComboBox',valueNotFoundText:void 0},function(){Ext.apply(Ext.form.field.ComboBox.prototype.defaultListConfig,{loadingText:'Загрузка...'})});
Ext.define('Ext.locale.ru.form.field.VTypes',{override:'Ext.form.field.VTypes',emailText:'Это поле должно содержать адрес электронной почты в формате "user@example.com"',urlText:'Это поле должно содержать URL в формате "http://www.example.com"',alphaText:'Это поле должно содержать только латинские буквы и символ подчеркивания "_"',alphanumText:'Это поле должно содержать только латинские буквы, цифры и символ подчеркивания "_"'});
Ext.define('Ext.locale.ru.form.field.HtmlEditor',{override:'Ext.form.field.HtmlEditor',createLinkText:'Пожалуйста, введите адрес:'},function(){Ext.apply(Ext.form.field.HtmlEditor.prototype,{buttonTips:{bold:{title:'Полужирный (Ctrl+B)',text:'Применение полужирного начертания к выделенному тексту.',cls:Ext.baseCSSPrefix+'html-editor-tip'},italic:{title:'Курсив (Ctrl+I)',text:'Применение курсивного начертания к выделенному тексту.',cls:Ext.baseCSSPrefix+'html-editor-tip'},underline:{title:'Подчёркнутый (Ctrl+U)',
text:'Подчёркивание выделенного текста.',cls:Ext.baseCSSPrefix+'html-editor-tip'},increasefontsize:{title:'Увеличить размер',text:'Увеличение размера шрифта.',cls:Ext.baseCSSPrefix+'html-editor-tip'},decreasefontsize:{title:'Уменьшить размер',text:'Уменьшение размера шрифта.',cls:Ext.baseCSSPrefix+'html-editor-tip'},backcolor:{title:'Заливка',text:'Изменение цвета фона для выделенного текста или абзаца.',cls:Ext.baseCSSPrefix+'html-editor-tip'},forecolor:{title:'Цвет текста',text:'Измение цвета текста.',
cls:Ext.baseCSSPrefix+'html-editor-tip'},justifyleft:{title:'Выровнять текст по левому краю',text:'Вырaвнивание текста по левому краю.',cls:Ext.baseCSSPrefix+'html-editor-tip'},justifycenter:{title:'По центру',text:'Вырaвнивание текста по центру.',cls:Ext.baseCSSPrefix+'html-editor-tip'},justifyright:{title:'Выровнять текст по правому краю',text:'Вырaвнивание текста по правому краю.',cls:Ext.baseCSSPrefix+'html-editor-tip'},insertunorderedlist:{title:'Маркеры',text:'Начать маркированный список.',
cls:Ext.baseCSSPrefix+'html-editor-tip'},insertorderedlist:{title:'Нумерация',text:'Начать нумернованный список.',cls:Ext.baseCSSPrefix+'html-editor-tip'},createlink:{title:'Вставить гиперссылку',text:'Создание ссылки из выделенного текста.',cls:Ext.baseCSSPrefix+'html-editor-tip'},sourceedit:{title:'Исходный код',text:'Переключиться на исходный код.',cls:Ext.baseCSSPrefix+'html-editor-tip'}}})});Ext.define('Ext.locale.ru.form.Basic',{override:'Ext.form.Basic',waitTitle:'Пожалуйста, подождите...'});
Ext.define('Ext.locale.ru.grid.header.Container',{override:'Ext.grid.header.Container',sortAscText:'Сортировать по возрастанию',sortDescText:'Сортировать по убыванию',lockText:'Закрепить столбец',unlockText:'Снять закрепление столбца',columnsText:'Столбцы'});Ext.define('Ext.locale.ru.grid.GroupingFeature',{override:'Ext.grid.feature.Grouping',emptyGroupText:'(Пусто)',groupByText:'Группировать по этому полю',showGroupsText:'Отображать по группам'});
Ext.define('Ext.locale.ru.grid.PropertyColumnModel',{override:'Ext.grid.PropertyColumnModel',nameText:'Название',valueText:'Значение',dateFormat:'d.m.Y'});Ext.define('Ext.locale.ru.window.MessageBox',{override:'Ext.window.MessageBox',buttonText:{ok:'OK',cancel:'Отмена',yes:'Да',no:'Нет'}});Ext.define('Ext.locale.ru.form.field.File',{override:'Ext.form.field.File',buttonText:'Обзор...'});Ext.define('Ext.locale.ru.Component',{override:'Ext.Component'});
Ext.define('Ext.theme.triton.list.TreeItem',{override:'Ext.list.TreeItem',compatibility:Ext.isIE8,setFloated:function(floated,wasFloated){this.callParent([floated,wasFloated]);this.toolElement.syncRepaint()}});Ext.define('Ext.theme.neptune.container.ButtonGroup',{override:'Ext.container.ButtonGroup',usePlainButtons:!1});
Ext.define('Ext.theme.triton.form.field.Checkbox',{override:'Ext.form.field.Checkbox',compatibility:Ext.isIE8,initComponent:function(){this.callParent();Ext.on({show:'onGlobalShow',scope:this})},onFocus:function(e){this.callParent([e]);(e=this.getFocusClsEl())&&e.syncRepaint()},onBlur:function(e){this.callParent([e]);(e=this.getFocusClsEl())&&e.syncRepaint()},onGlobalShow:function(cmp){cmp.isAncestor(this)&&this.getFocusClsEl().syncRepaint()}});
Ext.define('Ext.theme.neptune.picker.Month',{override:'Ext.picker.Month',measureMaxHeight:36});Ext.define('Ext.theme.triton.picker.Month',{override:'Ext.picker.Month',footerButtonUI:'default-toolbar',calculateMonthMargin:Ext.emptyFn});Ext.define('Ext.theme.triton.picker.Date',{override:'Ext.picker.Date',footerButtonUI:'default-toolbar'});
Ext.define('Ext.theme.neptune.panel.Table',{override:'Ext.panel.Table',lockableBodyBorder:!0,initComponent:function(){this.callParent();this.hasOwnProperty('bodyBorder')||this.hideHeaders||!this.lockableBodyBorder&&this.lockable||(this.bodyBorder=!0)}});Ext.define('Ext.theme.neptune.grid.RowEditor',{override:'Ext.grid.RowEditor',buttonUI:'default-toolbar'});
Ext.define('Ext.theme.triton.grid.column.Column',{override:'Ext.grid.column.Column',compatibility:Ext.isIE8,onTitleMouseOver:function(){var triggerEl=this.triggerEl;this.callParent(arguments);triggerEl&&triggerEl.syncRepaint()}});Ext.define('Ext.theme.triton.grid.column.Check',{override:'Ext.grid.column.Check',compatibility:Ext.isIE8,setRecordCheck:function(record,index,checked,cell){this.callParent(arguments);Ext.fly(cell).syncRepaint()}});
Ext.define('Ext.theme.neptune.grid.column.RowNumberer',{override:'Ext.grid.column.RowNumberer',width:25});Ext.define('Ext.theme.triton.grid.column.RowNumberer',{override:'Ext.grid.column.RowNumberer',width:32});
Ext.define('Ext.theme.triton.menu.Item',{override:'Ext.menu.Item',compatibility:Ext.isIE8,onFocus:function(e){this.callParent([e]);this.repaintIcons()},onFocusLeave:function(e){this.callParent([e]);this.repaintIcons()},privates:{repaintIcons:function(){var iconEl=this.iconEl,arrowEl=this.arrowEl,checkEl=this.checkEl;iconEl&&iconEl.syncRepaint();arrowEl&&arrowEl.syncRepaint();checkEl&&checkEl.syncRepaint()}}});Ext.define('Ext.theme.neptune.menu.Separator',{override:'Ext.menu.Separator',border:!0});
Ext.define('Ext.theme.neptune.menu.Menu',{override:'Ext.menu.Menu',showSeparator:!1});Ext.define('Ext.theme.triton.menu.Menu',{override:'Ext.menu.Menu',compatibility:Ext.isIE8,afterShow:function(){var item,len;this.callParent(arguments);var items=this.items.getRange();var i=0;for(len=items.length;i<len;i++)(item=items[i])&&item.repaintIcons&&item.repaintIcons()}});Ext.define('Ext.theme.triton.grid.plugin.RowExpander',{override:'Ext.grid.plugin.RowExpander',headerWidth:32});
Ext.define('Ext.theme.triton.grid.selection.SpreadsheetModel',{override:'Ext.grid.selection.SpreadsheetModel',checkboxHeaderWidth:32});Ext.define('Ext.theme.triton.selection.CheckboxModel',{override:'Ext.selection.CheckboxModel',headerWidth:32,onHeaderClick:function(headerCt,header,e){this.callParent([headerCt,header,e]);Ext.isIE8&&header.getView().ownerGrid.el.syncRepaint()}});
Ext.define(null,{override:'Ext.ux.gauge.needle.Abstract',compatibility:Ext.isIE10p,setTransform:function(centerX,centerY,rotation){var needleGroup=this.getNeedleGroup();this.callParent([centerX,centerY,rotation]);needleGroup.set({transform:getComputedStyle(needleGroup.dom).getPropertyValue('transform')})},updateStyle:function(style){this.callParent([style]);Ext.isObject(style)&&'transform'in style&&(style=this.getNeedlePath(),style.set({transform:getComputedStyle(style.dom).getPropertyValue('transform')}))}});
Ext.define('Ext.ux.ajax.Simlet',function(){var urlRegex=/([^?#]*)(#.*)?$/,dateRegex=/^(\d{4})-(\d{2})-(\d{2})T(\d{2}):(\d{2}):(\d{2}(?:\.\d*)?)Z$/,intRegex=/^[+-]?\d+$/,floatRegex=/^[+-]?\d+\.\d+$/;return{alias:'simlet.basic',isSimlet:!0,responseProps:['responseText','responseXML','status','statusText','responseHeaders'],status:200,statusText:'OK',constructor:function(config){Ext.apply(this,config)},doGet:function(ctx){return this.handleRequest(ctx)},doPost:function(ctx){return this.handleRequest(ctx)},
doRedirect:function(ctx){return!1},doDelete:function(ctx){this.removeFromData(ctx,ctx.xhr.options.records)},exec:function(xhr){var fn=this['do'+Ext.String.capitalize(xhr.method.toLowerCase())];return fn?fn.call(this,this.getCtx(xhr.method,xhr.url,xhr)):{status:405,statusText:'Method Not Allowed'}},getCtx:function(method,url,xhr){return{method:method,params:this.parseQueryString(url),url:url,xhr:xhr}},handleRequest:function(ctx){var me=this,ret={},val;Ext.Array.forEach(me.responseProps,function(prop){prop in
me&&(val=me[prop],Ext.isFunction(val)&&(val=val.call(me,ctx)),ret[prop]=val)});return ret},openRequest:function(method,url,options,async){var ctx=this.getCtx(method,url);ctx=this.doRedirect(ctx);'destroy'===options.action&&(method='delete');ctx?options=ctx:(options=new Ext.ux.ajax.SimXhr({mgr:this.manager,simlet:this,options:options}),options.open(method,url,async));return options},parseQueryString:function(str){var m=urlRegex.exec(str);str={};var value,n;if(m&&m[1]){var parts=m[1].split('\x26');
var i=0;for(n=parts.length;i<n;++i)if((value=parts[i].split('\x3d'))[0]){m=decodeURIComponent(value.shift());var value$jscomp$0=1<value.length?value.join('\x3d'):value[0];if(Ext.isDefined(value$jscomp$0))if(value$jscomp$0=decodeURIComponent(value$jscomp$0),intRegex.test(value$jscomp$0))value$jscomp$0=parseInt(value$jscomp$0,10);else if(floatRegex.test(value$jscomp$0))value$jscomp$0=parseFloat(value$jscomp$0);else if(value=dateRegex.exec(value$jscomp$0))value$jscomp$0=new Date(Date.UTC(+value[1],+value[2]-
1,+value[3],+value[4],+value[5],+value[6]));value=value$jscomp$0;m in str?Ext.isArray(str[m])?str[m].push(value):str[m]=[str[m],value]:str[m]=value}}return str},redirect:function(method,url,params){switch(arguments.length){case 2:if('string'===typeof url)break;params=url;case 1:url=method,method='GET'}params&&(url=Ext.urlAppend(url,Ext.Object.toQueryString(params)));return this.manager.openRequest(method,url)},removeFromData:function(ctx,records){var me=this,data=me.getData(ctx),idProperty=(ctx.xhr.options.proxy&&
ctx.xhr.options.proxy.getModel()||{}).idProperty||'id',i;Ext.each(records,function(record){record=record.get(idProperty);for(i=data.length;0<i--;)if(data[i][idProperty]===record){me.deleteRecord(i);break}})}}}());
Ext.define('Ext.ux.ajax.DataSimlet',function(){function makeSortFn(def,cmp){var order=def.direction,sign=order&&'DESC'===order.toUpperCase()?-1:1;return function(leftRec,rightRec){var lhs=leftRec[def.property],rhs=rightRec[def.property];return(lhs=lhs<rhs?-1:rhs<lhs?1:0)||!cmp?lhs*sign:cmp(leftRec,rightRec)}}function makeSortFns(defs,cmp){var i;for(i=defs&&defs.length;i;)cmp=makeSortFn(defs[--i],cmp);return cmp}return{extend:Ext.ux.ajax.Simlet,buildNodes:function(node,path){var nodeData={data:[]},
len=node.length,i,child;this.nodes[path]=nodeData;for(i=0;i<len;++i){nodeData.data.push(child=node[i]);var children=child.text||child.title;child.id=path?path+'/'+children:children;children=child.children;(child.leaf=!children)||(delete child.children,this.buildNodes(children,child.id))}},deleteRecord:function(pos){this.data&&'function'!==typeof this.data&&Ext.Array.removeAt(this.data,pos)},fixTree:function(ctx,tree){ctx=ctx.params.node;var nodes;(nodes=this.nodes)||(this.nodes=nodes={},this.buildNodes(tree,
''));(ctx=nodes[ctx])?(this.node&&(this.node.sortedData=this.sortedData,this.node.currentOrder=this.currentOrder),this.node=ctx,this.data=ctx.data,this.sortedData=ctx.sortedData,this.currentOrder=ctx.currentOrder):this.data=null},getData:function(ctx){var params=ctx.params,order=(params.filter||'')+(params.group||'')+'-'+(params.sort||'')+'-'+(params.dir||''),tree=this.tree;tree&&this.fixTree(ctx,tree);tree=this.data;if('function'===typeof tree){var dynamicData=!0;tree=tree.call(this,ctx)}if(!tree||
'--'===order)return tree||[];if(!dynamicData&&order===this.currentOrder)return this.sortedData;ctx.filterSpec=params.filter&&Ext.decode(params.filter);ctx.groupSpec=params.group&&Ext.decode(params.group);dynamicData=params.sort;dynamicData=params.dir?[{direction:params.dir,property:dynamicData}]:params.sort?Ext.decode(params.sort):null;ctx.filterSpec&&(params=new Ext.util.FilterCollection,params.add(this.processFilters(ctx.filterSpec)),tree=Ext.Array.filter(tree,params.getFilterFn()));params=makeSortFns(ctx.sortSpec=
dynamicData);ctx.groupSpec&&(params=makeSortFns([ctx.groupSpec],params));tree=Ext.isArray(tree)?tree.slice(0):tree;params&&Ext.Array.sort(tree,params);this.sortedData=tree;this.currentOrder=order;return tree},processFilters:Ext.identityFn,getPage:function(ctx,data){var ret=data;data=data.length;var start=ctx.params.start||0;ctx=ctx.params.limit?Math.min(data,start+ctx.params.limit):data;if(start||ctx<data)ret=ret.slice(start,ctx);return ret},getGroupSummary:function(groupField,rows,ctx){return rows[0]},
getSummary:function(ctx,data,page){function flush(){accum&&(summary.push(me.getGroupSummary(groupField,accum,ctx)),accum=null)}var me=this,groupField=ctx.groupSpec.property,accum,todo={},summary=[],fieldValue,lastFieldValue;Ext.each(page,function(rec){fieldValue=rec[groupField];todo[fieldValue]=!0});Ext.each(data,function(rec){fieldValue=rec[groupField];lastFieldValue!==fieldValue&&(flush(),lastFieldValue=fieldValue);if(!todo[fieldValue])return!summary.length;accum?accum.push(rec):accum=[rec];return!0});
flush();return summary}}}());
Ext.define('Ext.ux.ajax.JsonSimlet',{extend:Ext.ux.ajax.DataSimlet,alias:'simlet.json',doGet:function(ctx){var data=this.getData(ctx),page=this.getPage(ctx,data),reader=ctx.xhr.options.proxy&&ctx.xhr.options.proxy.getReader(),root=reader&&reader.getRootProperty(),ret=this.callParent(arguments),response={};root&&Ext.isArray(page)?(response[root]=page,response[reader.getTotalProperty()]=data.length):response=page;ctx.groupSpec&&(response.summaryData=this.getSummary(ctx,data,page));ret.responseText=
Ext.encode(response);return ret},doPost:function(ctx){return this.doGet(ctx)}});
Ext.define('Ext.ux.ajax.GroupingSimlet',{extend:Ext.ux.ajax.JsonSimlet,alias:'simlet.grouping',lastPost:null,lastResponse:null,doGet:function(ctx){var data=this.getData(ctx),page=this.getPage(ctx,data),reader=ctx.xhr.options.proxy&&ctx.xhr.options.proxy.getReader(),root=reader&&reader.getRootProperty(),ret=this.callParent(arguments),response={},summary={};root&&Ext.isArray(page)?(response[root]=page,response[reader.getTotalProperty()]=data.length):response=page;if(ctx.groupSpec&&ctx.summarySpec){response[reader.getGroupRootProperty()]=
this.getGroupSummaries(ctx,data,page);root=ctx.summarySpec.length;for(page=0;page<root;page++){var s=ctx.summarySpec[page];summary[s.name]=s.data.calculate(data,s.name,null,0,data.length)}response[reader.getSummaryRootProperty()]=summary}this.lastResponse=response;ret.responseText=Ext.encode(this.lastResponse);return ret},doPost:function(ctx){return this.doGet(ctx)},getData:function(ctx){var params=ctx.params,order=(params.filter||'')+(params.group||'')+'-'+(params.sort||'')+'-'+(params.dir||''),
tree=this.tree;tree&&this.fixTree(ctx,tree);this.lastPost=params;tree=this.data;'function'===typeof tree&&(tree=tree.call(this,ctx));if(!tree||'--'===order)return tree||[];ctx.filterSpec=params.filter&&Ext.decode(params.filter);ctx.groupSpec=params.group&&Ext.decode(params.group);ctx.summarySpec=params.summary&&Ext.decode(params.summary);var fields=params.sort;fields=params.dir?[{direction:params.dir,property:fields}]:params.sort&&Ext.decode(params.sort);ctx.filterSpec&&(params=new Ext.util.FilterCollection,
params.add(this.processFilters(ctx.filterSpec)),tree=Ext.Array.filter(tree,params.getFilterFn()));params=this.makeSortFns(ctx.sortSpec=fields);ctx.groupSpec&&(params=this.makeSortFns(ctx.groupSpec,params));tree=Ext.isArray(tree)?tree.slice(0):tree;params&&Ext.Array.sort(tree,params);this.sortedData=tree;this.currentOrder=order;return tree},getGroupSummaries:function(ctx,data,page){var groupers=ctx.groupSpec;ctx=ctx.summarySpec;var out=[],i$jscomp$0,k;var len$jscomp$0=groupers.length;for(i$jscomp$0=
0;i$jscomp$0<len$jscomp$0;i$jscomp$0++){var grouper=groupers[i$jscomp$0];var values=Ext.Array.pluck(page,grouper.property);grouper.values=Ext.Array.unique(values)}for(i$jscomp$0=0;i$jscomp$0<len$jscomp$0;i$jscomp$0++){grouper=groupers[i$jscomp$0];values=grouper.values;var length=values.length;var record={};if(0<i$jscomp$0){var len2=out.length;for(page=0;page<len2;page++)for(k=0;k<length;k++)record=Ext.clone(out[page]),record[grouper.property]=values[k],out.push(record)}else for(page=0;page<length;page++)record=
{},record[grouper.property]=values[page],out.push(record)}len$jscomp$0=out.length;for(i$jscomp$0=0;i$jscomp$0<len$jscomp$0;i$jscomp$0++){record=out[i$jscomp$0];var keys=Ext.Object.getKeys(record);values=Ext.Array.filter(data,function(item){var match=!0,i;var len=keys.length;for(i=0;i<len;i++){var key=keys[i];match=match&&item[key]===record[key]}return match});length=ctx.length;for(page=0;page<length;page++)groupers=ctx[page],groupers.data||(groupers.data=Ext.Factory.dataSummary(groupers.summary)),
record[groupers.name]=groupers.data.calculate(values,groupers.name,null,0,values.length)}return out},makeSortFn:function(def,cmp){var order=def.direction,sign=order&&'DESC'===order.toUpperCase()?-1:1;return function(leftRec,rightRec){var lhs=leftRec[def.property],rhs=rightRec[def.property];return(lhs=lhs<rhs?-1:rhs<lhs?1:0)||!cmp?lhs*sign:cmp(leftRec,rightRec)}},makeSortFns:function(defs,cmp){var i;for(i=(defs=Ext.Array.from(defs))&&defs.length;i;)cmp=this.makeSortFn(defs[--i],cmp);return cmp}});
Ext.define('Ext.ux.ajax.PivotSimlet',{extend:Ext.ux.ajax.JsonSimlet,alias:'simlet.pivot',lastPost:null,lastResponse:null,keysSeparator:'',grandTotalKey:'',doPost:function(ctx){var ret=this.callParent(arguments);this.lastResponse=this.processData(this.getData(ctx),Ext.decode(ctx.xhr.body));ret.responseText=Ext.encode(this.lastResponse);return ret},processData:function(data,params){var len=data.length,response={success:!0,leftAxis:[],topAxis:[],results:[]},leftAxis=new Ext.util.MixedCollection,topAxis=
new Ext.util.MixedCollection,results=new Ext.util.MixedCollection,i,j,k;this.lastPost=params;this.keysSeparator=params.keysSeparator;this.grandTotalKey=params.grandTotalKey;for(i=0;i<len;i++){var leftKeys=this.extractValues(data[i],params.leftAxis,leftAxis);var topKeys=this.extractValues(data[i],params.topAxis,topAxis);this.addResult(data[i],this.grandTotalKey,this.grandTotalKey,results);for(j=0;j<leftKeys.length;j++)for(this.addResult(data[i],leftKeys[j],this.grandTotalKey,results),k=0;k<topKeys.length;k++)this.addResult(data[i],
leftKeys[j],topKeys[k],results);for(j=0;j<topKeys.length;j++)this.addResult(data[i],this.grandTotalKey,topKeys[j],results)}response.leftAxis=leftAxis.getRange();response.topAxis=topAxis.getRange();len=results.getCount();for(i=0;i<len;i++){data=results.getAt(i);data.values={};for(j=0;j<params.aggregate.length;j++)k=params.aggregate[j],data.values[k.id]=this[k.aggregator](data.records,k.dataIndex,data.leftKey,data.topKey);delete data.records;response.results.push(data)}leftAxis.clear();topAxis.clear();
results.clear();return response},getKey:function(value){this.keysMap=this.keysMap||{};Ext.isDefined(this.keysMap[value])||(this.keysMap[value]=Ext.id());return this.keysMap[value]},extractValues:function(record,dimensions,col){var len=dimensions.length,keys=[],j,item;var key='';for(j=0;j<len;j++){var dim=dimensions[j];key+=(0<j?this.keysSeparator:'')+this.getKey(record[dim.dataIndex]);(item=col.getByKey(key))||col.add(key,{key:key,value:record[dim.dataIndex],dimensionId:dim.id});keys.push(key)}return keys},
addResult:function(record,leftKey,topKey,results){var item=results.getByKey(leftKey+'/'+topKey);item||(item=results.add(leftKey+'/'+topKey,{leftKey:leftKey,topKey:topKey,records:[]}));item.records.push(record)},sum:function(records,measure,rowGroupKey,colGroupKey){rowGroupKey=records.length;colGroupKey=0;var i;for(i=0;i<rowGroupKey;i++)colGroupKey+=Ext.Number.from(records[i][measure],0);return colGroupKey},avg:function(records,measure,rowGroupKey,colGroupKey){rowGroupKey=records.length;colGroupKey=
0;var i;for(i=0;i<rowGroupKey;i++)colGroupKey+=Ext.Number.from(records[i][measure],0);return 0<rowGroupKey?colGroupKey/rowGroupKey:0},min:function(records,measure,rowGroupKey,colGroupKey){rowGroupKey=[];colGroupKey=records.length;var i;for(i=0;i<colGroupKey;i++)rowGroupKey.push(records[i][measure]);return Ext.Array.min(rowGroupKey)},max:function(records,measure,rowGroupKey,colGroupKey){rowGroupKey=[];colGroupKey=records.length;var i;for(i=0;i<colGroupKey;i++)rowGroupKey.push(records[i][measure]);
return Ext.Array.max(rowGroupKey)},count:function(records,measure,rowGroupKey,colGroupKey){return records.length},variance:function(records,measure,rowGroupKey,colGroupKey){var me=Ext.pivot.Aggregators,length=records.length;me=me.avg.apply(me,arguments);var total=0,i;if(0<me)for(i=0;i<length;i++)total+=Math.pow(Ext.Number.from(records[i][measure],0)-me,2);return 0<total&&1<length?total/(length-1):0},varianceP:function(records,measure,rowGroupKey,colGroupKey){var me=Ext.pivot.Aggregators,length=records.length;
me=me.avg.apply(me,arguments);var total=0,i;if(0<me)for(i=0;i<length;i++)total+=Math.pow(Ext.Number.from(records[i][measure],0)-me,2);return 0<total&&0<length?total/length:0},stdDev:function(records,measure,rowGroupKey,colGroupKey){var me=Ext.pivot.Aggregators;me=me.variance.apply(me,arguments);return 0<me?Math.sqrt(me):0},stdDevP:function(records,measure,rowGroupKey,colGroupKey){var me=Ext.pivot.Aggregators;me=me.varianceP.apply(me,arguments);return 0<me?Math.sqrt(me):0}});
Ext.define('Ext.ux.ajax.SimXhr',{readyState:0,mgr:null,simlet:null,constructor:function(config){Ext.apply(this,config);this.requestHeaders={}},abort:function(){this.timer&&(Ext.undefer(this.timer),this.timer=null);this.aborted=!0},getAllResponseHeaders:function(){var headers=[];Ext.isObject(this.responseHeaders)&&Ext.Object.each(this.responseHeaders,function(name,value){headers.push(name+': '+value)});return headers.join('\r\n')},getResponseHeader:function(header){var headers=this.responseHeaders;
return headers&&headers[header]||null},open:function(method,url,async,user,password){this.method=method;this.url=url;this.async=!1!==async;this.user=user;this.password=password;this.setReadyState(1)},overrideMimeType:function(mimeType){this.mimeType=mimeType},schedule:function(){var me=this,delay=me.simlet.delay||me.mgr.delay;if(delay)me.timer=Ext.defer(function(){me.onTick()},delay);else me.onTick()},send:function(body){this.body=body;if(this.async)this.schedule();else this.onComplete()},setReadyState:function(state){this.readyState!==
state&&(this.readyState=state,this.onreadystatechange())},setRequestHeader:function(header,value){this.requestHeaders[header]=value},onreadystatechange:Ext.emptyFn,onComplete:function(){var callback;this.readyState=4;Ext.apply(this,this.simlet.exec(this));if(callback=this.jsonpCallback)callback=callback+'('+this.responseText+')',eval(callback)},onTick:function(){this.timer=null;this.onComplete();if(this.onreadystatechange)this.onreadystatechange()}});
Ext.define('Ext.ux.ajax.SimManager',{singleton:!0,defaultType:'basic',delay:150,ready:!1,constructor:function(){this.simlets=[]},getSimlet:function(url){var index=url.indexOf('?'),simlets=this.simlets,len=simlets.length;0>index&&(index=url.indexOf('#'));0<index&&(url=url.substring(0,index));for(index=0;index<len;++index){var simlet=simlets[index];var simUrl=simlet.url;if(simUrl=simUrl instanceof RegExp?simUrl.test(url):simUrl===url)return simlet}return this.defaultSimlet},getXhr:function(method,url,
options,async){var simlet=this.getSimlet(url);return simlet?simlet.openRequest(method,url,options,async):null},init:function(config){var me=this;Ext.apply(me,config);me.ready||(me.ready=!0,'defaultSimlet'in me||(me.defaultSimlet=new Ext.ux.ajax.Simlet({status:404,statusText:'Not Found'})),me._openRequest=Ext.data.Connection.prototype.openRequest,Ext.data.request.Ajax.override({openRequest:function(options,requestOptions,async){var xhr=!options.nosim&&me.getXhr(requestOptions.method,requestOptions.url,
options,async);xhr||(xhr=this.callParent(arguments));return xhr}}),Ext.data.JsonP&&Ext.data.JsonP.self.override({createScript:function(url,params,options){var fullUrl=Ext.urlAppend(url,Ext.Object.toQueryString(params));(fullUrl=!options.nosim&&me.getXhr('GET',fullUrl,options,!0))||(fullUrl=this.callParent(arguments));return fullUrl},loadScript:function(request){var script=request.script;script.simlet?(script.jsonpCallback=request.params[request.callbackKey],script.send(null),request.script=document.createElement('script')):
this.callParent(arguments)}}));return me},openRequest:function(method,url,async){return this._openRequest.call(Ext.data.Connection.prototype,{},{method:method,url:url},async)},register:function(simlet$jscomp$0){function reg(one){var simlet=one;simlet.isSimlet||(simlet=Ext.create('simlet.'+(simlet.type||simlet.stype||me.defaultType),one));me.simlets.push(simlet);simlet.manager=me}var me=this;me.init();Ext.isArray(simlet$jscomp$0)?Ext.each(simlet$jscomp$0,reg):simlet$jscomp$0.isSimlet||simlet$jscomp$0.url?
reg(simlet$jscomp$0):Ext.Object.each(simlet$jscomp$0,function(url,s){s.url=url;reg(s)});return me}});
Ext.define('Ext.ux.ajax.XmlSimlet',{extend:Ext.ux.ajax.DataSimlet,alias:'simlet.xml',xmlTpl:'\x3c{root}\x3e\n;\x3ctpl for\x3d"data"\x3e;    \x3c{parent.record}\x3e\n;\x3ctpl for\x3d"parent.fields"\x3e;        \x3c{name}\x3e{[parent[values.name]]}\x3c/{name}\x3e\n;\x3c/tpl\x3e;    \x3c/{parent.record}\x3e\n;\x3c/tpl\x3e;\x3c/{root}\x3e'.split(';'),doGet:function(ctx){var data=this.getData(ctx),page=this.getPage(ctx,data),proxy=ctx.xhr.options.operation.getProxy(),reader=proxy&&proxy.getReader(),model=
reader&&reader.getModel();proxy=this.callParent(arguments);reader={data:page,reader:reader,fields:model&&model.fields,root:reader&&reader.getRootProperty(),record:reader&&reader.record};ctx.groupSpec&&(reader.summaryData=this.getSummary(ctx,data,page));this.xmlTpl&&(data=Ext.XTemplate.getTpl(this,'xmlTpl'),data=data.apply(reader));'undefined'!==typeof DOMParser?page=(new DOMParser).parseFromString(data,'text/xml'):(page=new ActiveXObject('Microsoft.XMLDOM'),page.async=!1,page.loadXML(data));proxy.responseText=
data;proxy.responseXML=page;return proxy},fixTree:function(){var buffer=[];this.callParent(arguments);this.buildTreeXml(this.data,buffer);this.data=buffer.join('')},buildTreeXml:function(nodes,buffer){var rootProperty=this.rootProperty,recordProperty=this.recordProperty;buffer.push('\x3c',rootProperty,'\x3e');Ext.Array.forEach(nodes,function(node){var key;buffer.push('\x3c',recordProperty,'\x3e');for(key in node)'children'===key?this.buildTreeXml(node.children,buffer):buffer.push('\x3c',key,'\x3e',
node[key],'\x3c/',key,'\x3e');buffer.push('\x3c/',recordProperty,'\x3e')});buffer.push('\x3c/',rootProperty,'\x3e')}});
Ext.define('Ext.ux.event.Driver',{extend:Ext.util.Observable,active:null,specialKeysByName:{PGUP:33,PGDN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40},specialKeysByCode:{},getTextSelection:function(el){var doc=el.ownerDocument;if('number'===typeof el.selectionStart){var start=el.selectionStart;var end=el.selectionEnd}else doc.selection&&(doc=doc.selection.createRange(),el=el.createTextRange(),el.setEndPoint('EndToStart',doc),start=el.text.length,end=start+doc.text.length);return[start,end]},getTime:function(){return(new Date).getTime()},
getTimestamp:function(){return this.getTime()-this.startTime},onStart:function(){},onStop:function(){},start:function(){this.active||(this.active=new Date,this.startTime=this.getTime(),this.onStart(),this.fireEvent('start',this))},stop:function(){this.active&&(this.active=null,this.onStop(),this.fireEvent('stop',this))}},function(){var proto=this.prototype;Ext.Object.each(proto.specialKeysByName,function(name,value){proto.specialKeysByCode[value]=name})});
Ext.define('Ext.ux.event.Maker',{eventQueue:[],startAfter:500,timerIncrement:500,currentTiming:0,constructor:function(config){var me=this;me.currentTiming=me.startAfter;Ext.isArray(config)||(config=[config]);Ext.Array.each(config,function(item){item.el=item.el||'el';Ext.Array.each(Ext.ComponentQuery.query(item.cmpQuery),function(cmp){var event={};var y=item.domQuery?cmp.el.down(item.domQuery):cmp[item.el];event.target='#'+y.dom.id;event.type=item.type;event.button=config.button||0;cmp=y.getX()+y.getWidth()/
2;y=y.getY()+y.getHeight()/2;event.xy=[cmp,y];event.ts=me.currentTiming;me.currentTiming+=me.timerIncrement;me.eventQueue.push(event)});item.screenshot&&(me.eventQueue[me.eventQueue.length-1].screenshot=!0)});return me.eventQueue}});
Ext.define('Ext.ux.event.Player',function(Player){var defaults={},mouseEvents={},keyEvents={},doc,uiEvents={},bubbleEvents={resize:1,reset:1,submit:1,change:1,select:1,error:1,abort:1};Ext.each('click dblclick mouseover mouseout mousedown mouseup mousemove'.split(' '),function(type){bubbleEvents[type]=defaults[type]=mouseEvents[type]={bubbles:!0,cancelable:'mousemove'!==type,detail:1,screenX:0,screenY:0,clientX:0,clientY:0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,button:0}});Ext.each(['keydown',
'keyup','keypress'],function(type){bubbleEvents[type]=defaults[type]=keyEvents[type]={bubbles:!0,cancelable:!0,ctrlKey:!1,altKey:!1,shiftKey:!1,metaKey:!1,keyCode:0,charCode:0}});Ext.each('blur change focus resize scroll select'.split(' '),function(type){defaults[type]=uiEvents[type]={bubbles:type in bubbleEvents,cancelable:!1,detail:1}});var inputSpecialKeys={8:function(target,start,end){start<end?target.value=target.value.substring(0,start)+target.value.substring(end):0<start&&(target.value=target.value.substring(0,
--start)+target.value.substring(end));this.setTextSelection(target,start,start)},46:function(target,start,end){start<end?target.value=target.value.substring(0,start)+target.value.substring(end):start<target.value.length-1&&(target.value=target.value.substring(0,start)+target.value.substring(start+1));this.setTextSelection(target,start,start)}};return{extend:Ext.ux.event.Driver,keyFrameEvents:{click:!0},pauseForAnimations:!0,speed:1,stallTime:0,_inputSpecialKeys:{INPUT:inputSpecialKeys,TEXTAREA:Ext.apply({},
inputSpecialKeys)},tagPathRegEx:/(\w+)(?:\[(\d+)\])?/,xpathRe:/^[#~](?:[a-z][-a-z0-9_]*)(?:\/[a-z]+)*$/i,constructor:function(config){var me=this;me.callParent(arguments);me.timerFn=function(){me.onTick()};me.attachTo=me.attachTo||window;me.counter=0;doc=me.attachTo.document},getElementFromXPath:function(xpath){xpath=xpath.split('/');var regex=this.tagPathRegEx,n;var child=this.attachTo.document;child='~'===xpath[0]?child.body:child.getElementById(xpath[0].substring(1));var i=1;for(n=xpath.length;child&&
i<n;++i){var m=regex.exec(xpath[i]);var count=m[2]?parseInt(m[2],10):1;m=m[1].toUpperCase();for(child=child.firstChild;child;child=child.nextSibling)if(child.tagName===m){if(1===count)break;--count}}return child},locateElement:function(locator){if(this.xpathRe.test(locator))var cmp=this.getElementFromXPath(locator);else locator=locator.split('\x3d\x3e'),cmp=Ext.String.trim(locator[0]),locator=Ext.String.trim(locator[1]),cmp=cmp?(cmp=Ext.first(cmp))&&cmp.el:Ext.getBody(),locator&&cmp&&(cmp=(cmp=Ext.query(locator,
!0,cmp))&&cmp[0]);return cmp},offsetToRangeCharacterMove:function(el,offset){return offset-(el.value.slice(0,offset).split('\r\n').length-1)},setTextSelection:function(el,startOffset,endOffset){0>startOffset&&(startOffset+=el.value.length);null==endOffset&&(endOffset=startOffset);0>endOffset&&(endOffset+=el.value.length);if('number'===typeof el.selectionStart)el.selectionStart=startOffset,el.selectionEnd=endOffset;else{var range=el.createTextRange();var startCharMove=this.offsetToRangeCharacterMove(el,
startOffset);range.collapse(!0);startOffset===endOffset?range.move('character',startCharMove):(range.moveEnd('character',this.offsetToRangeCharacterMove(el,endOffset)),range.moveStart('character',startCharMove));range.select()}},getTimeIndex:function(){return(this.getTimestamp()-this.stallTime)*this.speed},makeToken:function(eventDescriptor,signal){var me=this,t0;eventDescriptor[signal]=!0;eventDescriptor.defer=function(){eventDescriptor[signal]=!1;t0=me.getTime()};eventDescriptor.finish=function(){eventDescriptor[signal]=
!0;me.stallTime+=me.getTime()-t0;me.schedule()}},nextEvent:function(eventDescriptor){var index=++this.queueIndex;this.keyFrameEvents[eventDescriptor.type]&&Ext.Array.insert(this.eventQueue,index,[{keyframe:!0,ts:eventDescriptor.ts}])},peekEvent:function(){var ev=this.eventQueue[this.queueIndex]||null;ev&&void 0===ev.seq&&(ev.seq=this.counter++);return ev},replaceEvent:function(index,events){for(var t,i=0,n=events.length;i<n;++i)i&&(t=events[i-1],delete t.afterplay,delete t.screenshot,delete events[i].beforeplay);
Ext.Array.replace(this.eventQueue,null==index?this.queueIndex:index,1,events)},processEvents:function(){for(var animations=this.pauseForAnimations&&this.attachTo.Ext.fx.Manager.items,eventDescriptor;null!==(eventDescriptor=this.peekEvent());){if(animations&&animations.getCount())return!0;if(eventDescriptor.keyframe){if(!this.processKeyFrame(eventDescriptor))return!1;this.nextEvent(eventDescriptor)}else if(eventDescriptor.ts<=this.getTimeIndex()&&!1!==this.fireEvent('beforeplay',this,eventDescriptor)&&
this.playEvent(eventDescriptor))this.nextEvent(eventDescriptor);else return!0}this.stop();return!1},processKeyFrame:function(eventDescriptor){eventDescriptor.defer||(this.makeToken(eventDescriptor,'done'),this.fireEvent('keyframe',this,eventDescriptor));return eventDescriptor.done},injectEvent:function(target,event){var type=event.type,options=Ext.apply({},event,defaults[type]);return'type'===type?(type=this._inputSpecialKeys[target.tagName])?this.injectTypeInputEvent(target,event,type):this.injectTypeEvent(target,
event):'focus'===type&&target.focus?(target.focus(),!0):'blur'===type&&target.blur?(target.blur(),!0):'scroll'===type?(target.scrollLeft=event.pos[0],target.scrollTop=event.pos[1],!0):'mduclick'===type?this.injectEvent(target,Ext.applyIf({type:'mousedown'},event))&&this.injectEvent(target,Ext.applyIf({type:'mouseup'},event))&&this.injectEvent(target,Ext.applyIf({type:'click'},event)):mouseEvents[type]?Player.injectMouseEvent(target,options,this.attachTo):keyEvents[type]?Player.injectKeyEvent(target,
options,this.attachTo):uiEvents[type]?Player.injectUIEvent(target,type,options.bubbles,options.cancelable,options.view||this.attachTo,options.detail):!1},injectTypeEvent:function(target,event){var text=event.text,xlat=[],n;if(text){delete event.text;var upper=text.toUpperCase();var i=0;for(n=text.length;i<n;++i){var ch=text.charCodeAt(i);var chUp=upper.charCodeAt(i);xlat.push(Ext.applyIf({type:'keydown',charCode:chUp,keyCode:chUp},event),Ext.applyIf({type:'keypress',charCode:ch,keyCode:ch},event),
Ext.applyIf({type:'keyup',charCode:chUp,keyCode:chUp},event))}}else xlat.push(Ext.applyIf({type:'keydown',charCode:event.keyCode},event),Ext.applyIf({type:'keyup',charCode:event.keyCode},event));i=0;for(n=xlat.length;i<n;++i)this.injectEvent(target,xlat[i]);return!0},injectTypeInputEvent:function(target,event,handler){var text=event.text;if(handler){var sel=this.getTextSelection(target);if(text)event=sel[0],target.value=target.value.substring(0,event)+text+target.value.substring(sel[1]),event+=text.length,
this.setTextSelection(target,event,event);else{if(!(handler=handler[event.keyCode]))return'caret'in event?this.setTextSelection(target,event.caret,event.caret):event.selection&&this.setTextSelection(target,event.selection[0],event.selection[1]),this.injectTypeEvent(target,event);handler.call(this,target,sel[0],sel[1])}}return!0},playEvent:function(eventDescriptor){var target=this.locateElement(eventDescriptor.target),now=this.getTimeIndex(),timeout=eventDescriptor.timeout;void 0===eventDescriptor.startedAt&&
(eventDescriptor.startedAt=now);if(!target)return null!==timeout&&now-eventDescriptor.startedAt>(timeout||3E4)&&this.playEventHook(eventDescriptor,'timeout','onEventTimeout'),!1;if(!this.playEventHook(eventDescriptor,'beforeplay'))return!1;eventDescriptor.injected||(eventDescriptor.injected=!0,now=this.translateEvent(eventDescriptor,target),this.injectEvent(target,now));return this.playEventHook(eventDescriptor,'afterplay')},playEventHook:function(eventDescriptor,hookName,hookHandler){var doneName=
hookName+'.done',firedName=hookName+'.fired';return(hookName=hookHandler||eventDescriptor[hookName])&&!eventDescriptor[doneName]?(eventDescriptor[firedName]||(eventDescriptor[firedName]=!0,this.makeToken(eventDescriptor,doneName),this.eventScope&&Ext.isString(hookName)&&(hookName=this.eventScope[hookName]),hookName&&hookName.call(this.eventScope||this,eventDescriptor)),!1):!0},schedule:function(){this.timer||(this.timer=Ext.defer(this.timerFn,10))},_translateAcross:'type button charCode keyCode caret pos text selection'.split(' '),
translateEvent:function(eventDescriptor,target){for(var event={},modKeys=eventDescriptor.modKeys||'',names=this._translateAcross,i=names.length,name,xy;i--;)name=names[i],name in eventDescriptor&&(event[name]=eventDescriptor[name]);event.altKey=0<modKeys.indexOf('A');event.ctrlKey=0<modKeys.indexOf('C');event.metaKey=0<modKeys.indexOf('M');event.shiftKey=0<modKeys.indexOf('S');target&&'x'in eventDescriptor?(xy=Ext.fly(target).getXY(),xy[0]+=eventDescriptor.x,xy[1]+=eventDescriptor.y):'x'in eventDescriptor?
xy=[eventDescriptor.x,eventDescriptor.y]:'px'in eventDescriptor&&(xy=[eventDescriptor.px,eventDescriptor.py]);xy&&(event.clientX=event.screenX=xy[0],event.clientY=event.screenY=xy[1]);eventDescriptor.key&&(event.keyCode=this.specialKeysByName[eventDescriptor.key]);'wheel'===eventDescriptor.type&&('onwheel'in this.attachTo.document?(event.wheelX=eventDescriptor.dx,event.wheelY=eventDescriptor.dy):(event.type='mousewheel',event.wheelDeltaX=-40*eventDescriptor.dx,event.wheelDeltaY=event.wheelDelta=-40*
eventDescriptor.dy));return event},onStart:function(){this.queueIndex=0;this.schedule()},onStop:function(){this.timer&&(Ext.undefer(this.timer),this.timer=null)},onTick:function(){this.timer=null;this.processEvents()&&this.schedule()},statics:{ieButtonCodeMap:{0:1,1:4,2:2},injectKeyEvent:function(target,options,view){var type=options.type,customEvent=null;'textevent'===type&&(type='keypress');view=view||window;if(doc.createEvent){try{customEvent=doc.createEvent('KeyEvents'),customEvent.initKeyEvent(type,
options.bubbles,options.cancelable,view,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.keyCode,options.charCode)}catch(ex){try{customEvent=doc.createEvent('Events')}catch(uierror){customEvent=doc.createEvent('UIEvents')}finally{customEvent.initEvent(type,options.bubbles,options.cancelable),customEvent.view=view,customEvent.altKey=options.altKey,customEvent.ctrlKey=options.ctrlKey,customEvent.shiftKey=options.shiftKey,customEvent.metaKey=options.metaKey,customEvent.keyCode=
options.keyCode,customEvent.charCode=options.charCode}}target.dispatchEvent(customEvent)}else if(doc.createEventObject)customEvent=doc.createEventObject(),customEvent.bubbles=options.bubbles,customEvent.cancelable=options.cancelable,customEvent.view=view,customEvent.ctrlKey=options.ctrlKey,customEvent.altKey=options.altKey,customEvent.shiftKey=options.shiftKey,customEvent.metaKey=options.metaKey,customEvent.keyCode=0<options.charCode?options.charCode:options.keyCode,target.fireEvent('on'+type,customEvent);
else return!1;return!0},injectMouseEvent:function(target,options,view){var type=options.type;view=view||window;if(doc.createEvent){var customEvent=doc.createEvent('MouseEvents');customEvent.initMouseEvent?customEvent.initMouseEvent(type,options.bubbles,options.cancelable,view,options.detail,options.screenX,options.screenY,options.clientX,options.clientY,options.ctrlKey,options.altKey,options.shiftKey,options.metaKey,options.button,options.relatedTarget):(customEvent=doc.createEvent('UIEvents'),customEvent.initEvent(type,
options.bubbles,options.cancelable),customEvent.view=view,customEvent.detail=options.detail,customEvent.screenX=options.screenX,customEvent.screenY=options.screenY,customEvent.clientX=options.clientX,customEvent.clientY=options.clientY,customEvent.ctrlKey=options.ctrlKey,customEvent.altKey=options.altKey,customEvent.metaKey=options.metaKey,customEvent.shiftKey=options.shiftKey,customEvent.button=options.button,customEvent.relatedTarget=options.relatedTarget);options.relatedTarget&&!customEvent.relatedTarget&&
('mouseout'===type?customEvent.toElement=options.relatedTarget:'mouseover'===type&&(customEvent.fromElement=options.relatedTarget));target.dispatchEvent(customEvent)}else if(doc.createEventObject)customEvent=doc.createEventObject(),customEvent.bubbles=options.bubbles,customEvent.cancelable=options.cancelable,customEvent.view=view,customEvent.detail=options.detail,customEvent.screenX=options.screenX,customEvent.screenY=options.screenY,customEvent.clientX=options.clientX,customEvent.clientY=options.clientY,
customEvent.ctrlKey=options.ctrlKey,customEvent.altKey=options.altKey,customEvent.metaKey=options.metaKey,customEvent.shiftKey=options.shiftKey,customEvent.button=Player.ieButtonCodeMap[options.button]||0,customEvent.relatedTarget=options.relatedTarget,target.fireEvent('on'+type,customEvent);else return!1;return!0},injectUIEvent:function(target,options,view){view=view||window;if(doc.createEvent){var customEvent=doc.createEvent('UIEvents');customEvent.initUIEvent(options.type,options.bubbles,options.cancelable,
view,options.detail);target.dispatchEvent(customEvent)}else if(doc.createEventObject)customEvent=doc.createEventObject(),customEvent.bubbles=options.bubbles,customEvent.cancelable=options.cancelable,customEvent.view=view,customEvent.detail=options.detail,target.fireEvent('on'+options.type,customEvent);else return!1;return!0}}}});
Ext.define('Ext.ux.event.Recorder',function(Recorder){function apply(){var n=arguments.length,obj={kind:'other'},i;for(i=0;i<n;++i)Ext.apply(obj,arguments[i]);obj.alt&&!obj.event&&(obj.event=obj.alt);return obj}function key(extra){return apply({kind:'keyboard',modKeys:!0,key:!0},extra)}function mouse(extra){return apply({kind:'mouse',button:!0,modKeys:!0,xy:!0},extra)}var eventKey;var eventsToRecord={keydown:key(),keypress:key(),keyup:key(),dragmove:mouse({alt:'mousemove',pageCoords:!0,whileDrag:!0}),
mousemove:mouse({pageCoords:!0}),mouseover:mouse(),mouseout:mouse(),click:mouse(),wheel:mouse({wheel:!0}),mousedown:mouse({press:!0}),mouseup:mouse({release:!0}),scroll:apply({listen:!1}),focus:apply(),blur:apply()};for(eventKey in eventsToRecord)eventsToRecord[eventKey].event||(eventsToRecord[eventKey].event=eventKey);eventsToRecord.wheel.event=null;return{extend:Ext.ux.event.Driver,eventsToRecord:eventsToRecord,ignoreIdRegEx:/ext-gen(?:\d+)/,inputRe:/^(input|textarea)$/i,constructor:function(config){var events=
config&&config.eventsToRecord;events&&(this.eventsToRecord=Ext.apply(Ext.apply({},this.eventsToRecord),events),delete config.eventsToRecord);this.callParent(arguments);this.clear();this.modKeys=[];this.attachTo=this.attachTo||window},clear:function(){this.eventsRecorded=[]},listenToEvent:function(event){var me=this,el=me.attachTo.document.body,fn=function(){return me.onEvent.apply(me,arguments)},cleaner={};el.attachEvent&&10>el.ownerDocument.documentMode?(event='on'+event,el.attachEvent(event,fn),
cleaner.destroy=function(){fn&&(el.detachEvent(event,fn),fn=null)}):(el.addEventListener(event,fn,!0),cleaner.destroy=function(){fn&&(el.removeEventListener(event,fn,!0),fn=null)});return cleaner},coalesce:function(rec,ev){var events=this.eventsRecorded,length=events.length,tail=length&&events[length-1],tail2=1<length&&events[length-2],tail3=2<length&&events[length-3];if(!tail)return!1;if('mousemove'===rec.type){if('mousemove'===tail.type&&200>rec.ts-tail.ts)return rec.ts=tail.ts,events[length-1]=
rec,!0}else if('click'===rec.type){if(tail2&&'mouseup'===tail.type&&'mousedown'===tail2.type&&rec.button===tail.button&&rec.button===tail2.button&&rec.target===tail.target&&rec.target===tail2.target&&this.samePt(rec,tail)&&this.samePt(rec,tail2))return events.pop(),tail2.type='mduclick',!0}else if('keyup'===rec.type)if(tail2&&'keypress'===tail.type&&'keydown'===tail2.type){if(rec.target===tail.target&&rec.target===tail2.target)return events.pop(),tail2.type='type',tail2.text=String.fromCharCode(tail.charCode),
delete tail2.charCode,delete tail2.keyCode,tail3&&'type'===tail3.type&&tail3.text&&tail3.target===tail2.target&&(tail3.text+=tail2.text,events.pop()),!0}else{if(this.completeKeyStroke(tail,rec))return tail.type='type',this.completeSpecialKeyStroke(ev.target,tail,rec),!0;if('scroll'===tail.type&&this.completeKeyStroke(tail2,rec))return tail2.type='type',this.completeSpecialKeyStroke(ev.target,tail2,rec),events.pop(),events.pop(),events.push(tail,tail2),!0}return!1},completeKeyStroke:function(down,
up){return down&&'keydown'===down.type&&down.keyCode===up.keyCode?(delete down.charCode,!0):!1},completeSpecialKeyStroke:function(target,down,up){return(up=this.specialKeysByCode[up.keyCode])&&this.inputRe.test(target.tagName)?(delete down.keyCode,down.key=up,down.selection=this.getTextSelection(target),down.selection[0]===down.selection[1]&&(down.caret=down.selection[0],delete down.selection),!0):!1},getElementXPath:function(el){var good=!1,xpath=[],sibling,t;for(t=el;t;t=t.parentNode){if(t===this.attachTo.document.body){xpath.unshift('~');
good=!0;break}if(t.id&&!this.ignoreIdRegEx.test(t.id)){xpath.unshift('#'+t.id);good=!0;break}el=1;for(sibling=t;sibling=sibling.previousSibling;)sibling.tagName===t.tagName&&++el;sibling=t.tagName.toLowerCase();2>el?xpath.unshift(sibling):xpath.unshift(sibling+'['+el+']')}return good?xpath.join('/'):null},getRecordedEvents:function(){return this.eventsRecorded},onEvent:function(ev){var e=new Ext.event.Event(ev),info=this.eventsToRecord[e.type],rec={type:e.type,ts:this.getTimestamp(),target:this.getElementXPath(e.target)};
if(info&&rec.target){var root=e.target.ownerDocument;root=root.defaultView||root.parentWindow;if(root===this.attachTo){this.eventsToRecord.scroll&&this.syncScroll(e.target);if(info.xy){var xy=e.getXY();info.pageCoords||!rec.target?(rec.px=xy[0],rec.py=xy[1]):(root=Ext.fly(e.getTarget()).getXY(),xy[0]-=root[0],xy[1]-=root[1],rec.x=xy[0],rec.y=xy[1])}if(info.button&&(rec.button='buttons'in ev?ev.buttons:ev.button,!rec.button&&info.whileDrag))return;info.wheel&&(rec.type='wheel','wheel'===info.event?
(rec.dx=ev.deltaX,rec.dy=ev.deltaY):'number'===typeof ev.wheelDeltaX?(rec.dx=-.025*ev.wheelDeltaX,rec.dy=-.025*ev.wheelDeltaY):ev.wheelDelta?rec.dy=-.025*ev.wheelDelta:ev.detail&&(rec.dy=ev.detail));info.modKeys&&(this.modKeys[0]=e.altKey?'A':'',this.modKeys[1]=e.ctrlKey?'C':'',this.modKeys[2]=e.metaKey?'M':'',this.modKeys[3]=e.shiftKey?'S':'',ev=this.modKeys.join(''))&&(rec.modKeys=ev);info.key&&(rec.charCode=e.getCharCode(),rec.keyCode=e.getKey());this.coalesce(rec,e)?this.fireEvent('coalesce',
this,rec):(this.eventsRecorded.push(rec),this.fireEvent('add',this,rec))}}},onStart:function(){var me=this,ddm=me.attachTo.Ext.dd.DragDropManager,evproto=me.attachTo.Ext.EventObjectImpl.prototype,special=[];Recorder.prototype.eventsToRecord.wheel.event='onwheel'in me.attachTo.document?'wheel':'mousewheel';me.listeners=[];Ext.Object.each(me.eventsToRecord,function(name,value){value&&!1!==value.listen&&(value.event||(value.event=name),value.alt&&value.alt!==name?me.eventsToRecord[value.alt]||special.push(value):
me.listeners.push(me.listenToEvent(value.event)))});Ext.each(special,function(info){me.eventsToRecord[info.alt]=info;me.listeners.push(me.listenToEvent(info.alt))});me.ddmStopEvent=ddm.stopEvent;ddm.stopEvent=Ext.Function.createSequence(ddm.stopEvent,function(e){me.onEvent(e)});me.evStopEvent=evproto.stopEvent;evproto.stopEvent=Ext.Function.createSequence(evproto.stopEvent,function(){me.onEvent(this)})},onStop:function(){Ext.destroy(this.listeners);this.listeners=null;this.attachTo.Ext.dd.DragDropManager.stopEvent=
this.ddmStopEvent;this.attachTo.Ext.EventObjectImpl.prototype.stopEvent=this.evStopEvent},samePt:function(pt1,pt2){return pt1.x===pt2.x&&pt1.y===pt2.y},syncScroll:function(el){for(var ts=this.getTimestamp(),oldX,oldY,x,y,scrolled;el&&(oldX=el.$lastScrollLeft,oldY=el.$lastScrollTop,x=el.scrollLeft,y=el.scrollTop,scrolled=!1,oldX!==x&&(x&&(scrolled=!0),el.$lastScrollLeft=x),oldY!==y&&(y&&(scrolled=!0),el.$lastScrollTop=y),scrolled&&(this.eventsRecorded.push(oldX={type:'scroll',target:this.getElementXPath(el),
ts:ts,pos:[x,y]}),this.fireEvent('add',this,oldX)),'BODY'!==el.tagName);el=el.parentNode);}}});
Ext.define('Ext.ux.gauge.needle.Abstract',{mixins:[Ext.mixin.Factoryable],alias:'gauge.needle.abstract',isNeedle:!0,config:{path:null,innerRadius:25,outerRadius:'100% - 20',style:null,radius:0,gauge:null},constructor:function(config){this.initConfig(config)},applyInnerRadius:function(innerRadius){return this.getGauge().getRadiusFn(innerRadius)},applyOuterRadius:function(outerRadius){return this.getGauge().getRadiusFn(outerRadius)},updateRadius:function(){this.regeneratePath()},setTransform:function(centerX,
centerY,rotation){this.getNeedleGroup().setStyle('transform','translate('+centerX+'px,'+centerY+'px) rotate('+rotation+'deg)')},applyPath:function(path){return Ext.isFunction(path)?path:null},updatePath:function(path){this.regeneratePath(path)},regeneratePath:function(path){path=path||this.getPath();var radius=this.getRadius(),inner=this.getInnerRadius()(radius);radius=this.getOuterRadius()(radius);path=radius>inner?path(inner,radius):'';this.getNeedlePath().dom.setAttribute('d',path)},getNeedleGroup:function(){var gauge=
this.getGauge(),group=this.needleGroup;group||(group=this.needleGroup=Ext.get(document.createElementNS(gauge.svgNS,'g')),gauge.getSvg().appendChild(group));return group},getNeedlePath:function(){var pathElement=this.pathElement;pathElement||(pathElement=this.pathElement=Ext.get(document.createElementNS(this.getGauge().svgNS,'path')),pathElement.dom.setAttribute('class',Ext.baseCSSPrefix+'gauge-needle'),this.getNeedleGroup().appendChild(pathElement));return pathElement},updateStyle:function(style){var pathElement=
this.getNeedlePath();Ext.isObject(style)?pathElement.setStyle(style):pathElement.dom.removeAttribute('style')},destroy:function(){this.pathElement=Ext.destroy(this.pathElement);this.needleGroup=Ext.destroy(this.needleGroup);this.setGauge(null)}});
Ext.define('Ext.ux.gauge.Gauge',{alternateClassName:'Ext.ux.Gauge',extend:Ext.Gadget,xtype:'gauge',config:{padding:10,trackStart:135,trackLength:270,angleOffset:0,minValue:0,maxValue:100,value:50,needle:null,needleDefaults:{cached:!0,$value:{type:'diamond'}},clockwise:!0,textTpl:['\x3ctpl\x3e{value:number("0.00")}%\x3c/tpl\x3e'],textAlign:'c-c',textOffset:{dx:0,dy:0},trackStyle:{outerRadius:'100%',innerRadius:'100% - 20',round:!1},valueStyle:{outerRadius:'100% - 2',innerRadius:'100% - 18',round:!1},
animation:!0},baseCls:Ext.baseCSSPrefix+'gauge',template:[{reference:'bodyElement',children:[{reference:'textElement',cls:Ext.baseCSSPrefix+'gauge-text'}]}],defaultBindProperty:'value',pathAttributes:{fill:!0,fillOpacity:!0,stroke:!0,strokeOpacity:!0,strokeWidth:!0},easings:{linear:Ext.identityFn,'in':function(t){return t*t*t},out:function(t){return--t*t*t+1},inOut:function(t){return.5>t?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1}},resizeDelay:0,resizeTimerId:0,size:null,svgNS:'http://www.w3.org/2000/svg',svg:null,
defs:null,trackArc:null,valueArc:null,trackGradient:null,valueGradient:null,fx:null,fxValue:0,fxAngleOffset:0,constructor:function(config){this.fitSectorInRectCache={startAngle:null,lengthAngle:null,minX:null,maxX:null,minY:null,maxY:null};this.interpolator=this.createInterpolator();this.callParent([config]);this.el.on('resize','onElementResize',this)},doDestroy:function(){Ext.undefer(this.resizeTimerId);this.el.un('resize','onElementResize',this);this.stopAnimation();this.setNeedle(null);this.trackGradient=
Ext.destroy(this.trackGradient);this.valueGradient=Ext.destroy(this.valueGradient);this.defs=Ext.destroy(this.defs);this.svg=Ext.destroy(this.svg);this.callParent()},afterComponentLayout:function(width,height,oldWidth,oldHeight){this.callParent([width,height,oldWidth,oldHeight]);Ext.isIE9&&this.handleResize()},onElementResize:function(element,size){this.handleResize(size)},handleResize:function(size,instantly){var el=this.element;el&&(size=size||el.getSize())&&size.width&&size.height&&(this.resizeTimerId=
Ext.undefer(this.resizeTimerId),!instantly&&this.resizeDelay?this.resizeTimerId=Ext.defer(this.handleResize,this.resizeDelay,this,[size,!0]):(this.size=size,this.resizeHandler(size)))},updateMinValue:function(minValue){this.interpolator.setDomain(minValue,this.getMaxValue());this.isConfiguring||this.render()},updateMaxValue:function(maxValue){this.interpolator.setDomain(this.getMinValue(),maxValue);this.isConfiguring||this.render()},updateAngleOffset:function(angleOffset,oldAngleOffset){var me=this,
animation=me.getAnimation();me.fxAngleOffset=angleOffset;me.isConfiguring||(animation.duration?me.animate(oldAngleOffset,angleOffset,animation.duration,me.easings[animation.easing],function(angleOffset){me.fxAngleOffset=angleOffset;me.render()}):me.render())},applyTrackStart:function(trackStart){(0>trackStart||360<=trackStart)&&Ext.raise("'trackStart' should be within [0, 360).");return trackStart},applyTrackLength:function(trackLength){(0>=trackLength||360<trackLength)&&Ext.raise("'trackLength' should be within (0, 360].");
return trackLength},updateTrackStart:function(trackStart){this.isConfiguring||this.render()},updateTrackLength:function(trackLength){this.interpolator.setRange(0,trackLength);this.isConfiguring||this.render()},applyPadding:function(padding){if('string'===typeof padding){var ratio=parseFloat(padding)/100;return function(x){return x*ratio}}return function(){return padding}},updatePadding:function(){this.isConfiguring||this.render()},applyValue:function(value){var minValue=this.getMinValue(),maxValue=
this.getMaxValue();return Math.min(Math.max(value,minValue),maxValue)},updateValue:function(value$jscomp$0,oldValue){var me=this,animation=me.getAnimation();me.fxValue=value$jscomp$0;me.isConfiguring||(me.writeText(),animation.duration?me.animate(oldValue,value$jscomp$0,animation.duration,me.easings[animation.easing],function(value){me.fxValue=value;me.render()}):me.render())},applyTextTpl:function(textTpl){textTpl&&!textTpl.isTemplate&&(textTpl=new Ext.XTemplate(textTpl));return textTpl},applyTextOffset:function(offset){offset=
offset||{};offset.dx=offset.dx||0;offset.dy=offset.dy||0;return offset},updateTextTpl:function(){this.writeText();this.isConfiguring||this.centerText()},writeText:function(options){options=this.getValue();var minValue=this.getMinValue(),maxValue=this.getMaxValue(),delta=maxValue-minValue;this.getTextTpl().overwrite(this.textElement,{value:options,percent:(options-minValue)/delta*100,minValue:minValue,maxValue:maxValue,delta:delta})},centerText:function(cx,cy,sectorRegion,innerRadius,outerRadius){outerRadius=
this.textElement;var textAlign=this.getTextAlign();Ext.Number.isEqual(innerRadius,0,.1)||sectorRegion.isOutOfBound({x:cx,y:cy})?(cx=outerRadius.getRegion().alignTo({align:textAlign,target:sectorRegion}),outerRadius.setLeft(cx.left),outerRadius.setTop(cx.top)):(sectorRegion=outerRadius.getBox(),outerRadius.setLeft(cx-sectorRegion.width/2),outerRadius.setTop(cy-sectorRegion.height/2))},camelCaseRe:/([a-z])([A-Z])/g,camelToHyphen:function(name){return name.replace(this.camelCaseRe,'$1-$2').toLowerCase()},
applyTrackStyle:function(trackStyle){trackStyle.innerRadius=this.getRadiusFn(trackStyle.innerRadius);trackStyle.outerRadius=this.getRadiusFn(trackStyle.outerRadius);if(Ext.isArray(trackStyle.fill)){var trackGradient=this.getTrackGradient();this.setGradientStops(trackGradient,trackStyle.fill);trackStyle.fill='url(#'+trackGradient.dom.getAttribute('id')+')'}return trackStyle},updateTrackStyle:function(trackStyle){var trackArc=Ext.fly(this.getTrackArc()),name;for(name in trackStyle)name in this.pathAttributes?
trackArc.setStyle(this.camelToHyphen(name),trackStyle[name]):trackArc.setStyle(name,trackStyle[name])},applyValueStyle:function(valueStyle){valueStyle.innerRadius=this.getRadiusFn(valueStyle.innerRadius);valueStyle.outerRadius=this.getRadiusFn(valueStyle.outerRadius);if(Ext.isArray(valueStyle.fill)){var valueGradient=this.getValueGradient();this.setGradientStops(valueGradient,valueStyle.fill);valueStyle.fill='url(#'+valueGradient.dom.getAttribute('id')+')'}return valueStyle},updateValueStyle:function(valueStyle){var valueArc=
Ext.fly(this.getValueArc()),name;for(name in valueStyle)name in this.pathAttributes?valueArc.setStyle(this.camelToHyphen(name),valueStyle[name]):valueArc.setStyle(name,valueStyle[name])},getRadiusFn:function(radius$jscomp$0){var increment=0;if(Ext.isNumber(radius$jscomp$0))var result=function(){return radius$jscomp$0};else if(Ext.isString(radius$jscomp$0)){radius$jscomp$0=radius$jscomp$0.replace(/ /g,'');var ratio=parseFloat(radius$jscomp$0)/100;result=radius$jscomp$0.search('%');result<radius$jscomp$0.length-
1&&(increment=parseFloat(radius$jscomp$0.substr(result+1)));result=function(radius){return radius*ratio+increment};result.ratio=ratio}return result},getSvg:function(){var svg=this.svg;svg||(svg=this.svg=Ext.get(document.createElementNS(this.svgNS,'svg')),this.bodyElement.append(svg));return svg},getTrackArc:function(){var trackArc=this.trackArc;trackArc||(trackArc=this.trackArc=document.createElementNS(this.svgNS,'path'),this.getSvg().append(trackArc,!0),trackArc.setAttribute('class',Ext.baseCSSPrefix+
'gauge-track'));return trackArc},getValueArc:function(){var valueArc=this.valueArc;this.getTrackArc();valueArc||(valueArc=this.valueArc=document.createElementNS(this.svgNS,'path'),this.getSvg().append(valueArc,!0),valueArc.setAttribute('class',Ext.baseCSSPrefix+'gauge-value'));return valueArc},applyNeedle:function(needle,oldNeedle){this.getValueArc();return Ext.Factory.gaugeNeedle.update(oldNeedle,needle,this,'createNeedle','needleDefaults')},createNeedle:function(config){return Ext.apply({gauge:this},
config)},getDefs:function(){var defs=this.defs;defs||(defs=this.defs=Ext.get(document.createElementNS(this.svgNS,'defs')),this.getSvg().appendChild(defs));return defs},setGradientSize:function(gradient,x1,y1,x2,y2){gradient.setAttribute('x1',x1);gradient.setAttribute('y1',y1);gradient.setAttribute('x2',x2);gradient.setAttribute('y2',y2)},resizeGradients:function(size){var trackGradient=this.getTrackGradient(),valueGradient=this.getValueGradient(),y1=size.height/2,x2=size.width;size=size.height/2;
this.setGradientSize(trackGradient.dom,0,y1,x2,size);this.setGradientSize(valueGradient.dom,0,y1,x2,size)},setGradientStops:function(gradient,stops){for(var ln=stops.length,i,stopCfg,stopEl;gradient.firstChild;)gradient.removeChild(gradient.firstChild);for(i=0;i<ln;i++)stopCfg=stops[i],stopEl=document.createElementNS(this.svgNS,'stop'),gradient.appendChild(stopEl),stopEl.setAttribute('offset',stopCfg.offset),stopEl.setAttribute('stop-color',stopCfg.color),'opacity'in stopCfg&&stopEl.setAttribute('stop-opacity',
stopCfg.opacity)},getTrackGradient:function(){var trackGradient=this.trackGradient;trackGradient||(trackGradient=this.trackGradient=Ext.get(document.createElementNS(this.svgNS,'linearGradient')),trackGradient.dom.setAttribute('gradientUnits','userSpaceOnUse'),this.getDefs().appendChild(trackGradient),Ext.get(trackGradient));return trackGradient},getValueGradient:function(){var valueGradient=this.valueGradient;valueGradient||(valueGradient=this.valueGradient=Ext.get(document.createElementNS(this.svgNS,
'linearGradient')),valueGradient.dom.setAttribute('gradientUnits','userSpaceOnUse'),this.getDefs().appendChild(valueGradient),Ext.get(valueGradient));return valueGradient},getArcPoint:function(centerX,centerY,radius,degrees){degrees=degrees/180*Math.PI;return[centerX+radius*Math.cos(degrees),centerY+radius*Math.sin(degrees)]},isCircle:function(startAngle,endAngle){return Ext.Number.isEqual(Math.abs(endAngle-startAngle),360,.001)},getArcPath:function(centerX,centerY,innerRadius,outerRadius,startAngle,
endAngle,round){var isCircle=this.isCircle(startAngle,endAngle);endAngle-=.01;var innerStartPoint=this.getArcPoint(centerX,centerY,innerRadius,startAngle),innerEndPoint=this.getArcPoint(centerX,centerY,innerRadius,endAngle),outerStartPoint=this.getArcPoint(centerX,centerY,outerRadius,startAngle);centerX=this.getArcPoint(centerX,centerY,outerRadius,endAngle);startAngle=180>=endAngle-startAngle?0:1;innerEndPoint=['M',innerStartPoint[0],innerStartPoint[1],'A',innerRadius,innerRadius,0,startAngle,1,innerEndPoint[0],
innerEndPoint[1]];innerRadius=(outerRadius-innerRadius)/2;isCircle?innerEndPoint.push('M',centerX[0],centerX[1]):round?innerEndPoint.push('A',innerRadius,innerRadius,0,0,0,centerX[0],centerX[1]):innerEndPoint.push('L',centerX[0],centerX[1]);innerEndPoint.push('A',outerRadius,outerRadius,0,startAngle,0,outerStartPoint[0],outerStartPoint[1]);round&&!isCircle&&innerEndPoint.push('A',innerRadius,innerRadius,0,0,0,innerStartPoint[0],innerStartPoint[1]);innerEndPoint.push('Z');return innerEndPoint.join(' ')},
resizeHandler:function(size){this.getSvg().setSize(size);this.resizeGradients(size);this.render()},createInterpolator:function(rangeCheck){var domainStart=0,domainDelta=1,rangeStart=0,rangeEnd=1,interpolator=function(x,invert){var t=0;domainDelta&&(t=(x-domainStart)/domainDelta,rangeCheck&&(t=Math.max(0,t),t=Math.min(1,t)),invert&&(t=1-t));return(1-t)*rangeStart+t*rangeEnd};interpolator.setDomain=function(a,b){domainStart=a;domainDelta=b-a;return this};interpolator.setRange=function(a,b){rangeStart=
a;rangeEnd=b;return this};interpolator.getDomain=function(){return[domainStart,domainStart+domainDelta]};interpolator.getRange=function(){return[rangeStart,rangeEnd]};return interpolator},applyAnimation:function(animation){!0===animation?animation={}:!1===animation&&(animation={duration:0});'duration'in animation||(animation.duration=1E3);animation.easing in this.easings||(animation.easing='out');return animation},updateAnimation:function(){this.stopAnimation()},animate:function(from,to,duration,
easing,fn,scope){function frame(){var t=Math.min(Ext.AnimationQueue.frameStartTime-start,duration)/duration,value=interpolator(easing(t));scope?'string'===typeof fn?scope[fn].call(scope,value):fn.call(scope,value):fn(value);1<=t&&(Ext.AnimationQueue.stop(frame,scope),me.fx=null)}var me=this,start=Ext.now(),interpolator=me.createInterpolator().setRange(from,to);me.stopAnimation();Ext.AnimationQueue.start(frame,scope);me.fx={frame:frame,scope:scope}},stopAnimation:function(){this.fx&&(Ext.AnimationQueue.stop(this.fx.frame,
this.fx.scope),this.fx=null)},unitCircleExtrema:{0:[1,0],90:[0,1],180:[-1,0],270:[0,-1],360:[1,0],450:[0,1],540:[-1,0],630:[0,-1]},getUnitSectorExtrema:function(startAngle,lengthAngle){var extrema=this.unitCircleExtrema,points=[],angle;for(angle in extrema)angle>startAngle&&angle<startAngle+lengthAngle&&points.push(extrema[angle]);return points},fitSectorInRect:function(width,height,startAngle,lengthAngle,ratio){if(Ext.Number.isEqual(lengthAngle,360,.001))return{cx:width/2,cy:height/2,radius:Math.min(width,
height)/2,region:new Ext.util.Region(0,width,height,0)};var cache=this.fitSectorInRectCache;if(cache.startAngle===startAngle&&cache.lengthAngle===lengthAngle){ratio=cache.minX;var maxX=cache.maxX;var xx=cache.minY;var yy=cache.maxY}else ratio=this.getUnitSectorExtrema(startAngle,lengthAngle).concat([this.getArcPoint(0,0,1,startAngle),this.getArcPoint(0,0,ratio,startAngle),this.getArcPoint(0,0,1,startAngle+lengthAngle),this.getArcPoint(0,0,ratio,startAngle+lengthAngle)]),xx=ratio.map(function(point){return point[0]}),
yy=ratio.map(function(point){return point[1]}),ratio=Math.min.apply(null,xx),maxX=Math.max.apply(null,xx),xx=Math.min.apply(null,yy),yy=Math.max.apply(null,yy),cache.startAngle=startAngle,cache.lengthAngle=lengthAngle,cache.minX=ratio,cache.maxX=maxX,cache.minY=xx,cache.maxY=yy;startAngle=Math.min(width/(maxX-ratio),height/(yy-xx));lengthAngle=new Ext.util.Region(xx*startAngle,maxX*startAngle,yy*startAngle,ratio*startAngle);width=new Ext.util.Region(0,width,height,0);width=lengthAngle.alignTo({align:'c-c',
target:width});return{cx:width.left-ratio*startAngle,cy:width.top-xx*startAngle,radius:startAngle,region:width}},fitSectorInPaddedRect:function(width,height,padding,startAngle,lengthAngle,ratio){width=this.fitSectorInRect(width-2*padding,height-2*padding,startAngle,lengthAngle,ratio);width.cx+=padding;width.cy+=padding;width.region.translateBy(padding,padding);return width},normalizeAngle:function(angle){return(angle%360+360)%360},render:function(){if(this.size){var textOffset=this.getTextOffset(),
trackArc=this.getTrackArc(),valueArc=this.getValueArc(),needle=this.getNeedle(),clockwise=this.getClockwise(),value=this.fxValue,angleOffset=this.fxAngleOffset,trackLength=this.getTrackLength(),width=this.size.width,height=this.size.height,padding=this.getPadding()(Math.min(width,height));angleOffset=this.normalizeAngle(this.getTrackStart()+angleOffset);var trackEnd=angleOffset+trackLength;value=this.interpolator(value);var trackStyle=this.getTrackStyle(),valueStyle=this.getValueStyle();trackLength=
this.fitSectorInPaddedRect(width,height,padding,angleOffset,trackLength,trackStyle.innerRadius.ratio);width=trackLength.cx;height=trackLength.cy;padding=trackLength.radius;var trackInnerRadius=Math.max(0,trackStyle.innerRadius(padding)),trackOuterRadius=Math.max(0,trackStyle.outerRadius(padding)),valueInnerRadius=Math.max(0,valueStyle.innerRadius(padding)),valueOuterRadius=Math.max(0,valueStyle.outerRadius(padding));trackStyle=this.getArcPath(width,height,trackInnerRadius,trackOuterRadius,angleOffset,
trackEnd,trackStyle.round);clockwise=this.getArcPath(width,height,valueInnerRadius,valueOuterRadius,clockwise?angleOffset:trackEnd-value,clockwise?angleOffset+value:trackEnd,valueStyle.round);this.centerText(width+textOffset.dx,height+textOffset.dy,trackLength.region,trackInnerRadius,trackOuterRadius);trackArc.setAttribute('d',trackStyle);valueArc.setAttribute('d',clockwise);needle&&(needle.setRadius(padding),needle.setTransform(width,height,-90+angleOffset+value));this.fireEvent('render',this)}}});
Ext.define('Ext.ux.gauge.needle.Arrow',{extend:Ext.ux.gauge.needle.Abstract,alias:'gauge.needle.arrow',config:{path:function(ir,or){return 30<or-ir?'M0,'+(ir+5)+' L-4,'+ir+' L-4,'+(ir+10)+' L-1,'+(ir+15)+' L-1,'+(or-7)+' L-5,'+(or-10)+' L0,'+or+' L5,'+(or-10)+' L1,'+(or-7)+' L1,'+(ir+15)+' L4,'+(ir+10)+' L4,'+ir+' Z':''}}});
Ext.define('Ext.ux.gauge.needle.Diamond',{extend:Ext.ux.gauge.needle.Abstract,alias:'gauge.needle.diamond',config:{path:function(ir,or){return 10<or-ir?'M0,'+ir+' L-4,'+(ir+5)+' L0,'+or+' L4,'+(ir+5)+' Z':''}}});Ext.define('Ext.ux.gauge.needle.Rectangle',{extend:Ext.ux.gauge.needle.Abstract,alias:'gauge.needle.rectangle',config:{path:function(ir,or){return 10<or-ir?'M-2,'+ir+' L2,'+ir+' L2,'+or+' L-2,'+or+' Z':''}}});
Ext.define('Ext.ux.gauge.needle.Spike',{extend:Ext.ux.gauge.needle.Abstract,alias:'gauge.needle.spike',config:{path:function(ir,or){return 10<or-ir?'M0,'+(ir+5)+' L-4,'+ir+' L0,'+or+' L4,'+ir+' Z':''}}});Ext.define('Ext.ux.gauge.needle.Wedge',{extend:Ext.ux.gauge.needle.Abstract,alias:'gauge.needle.wedge',config:{path:function(ir,or){return 10<or-ir?'M-4,'+ir+' L0,'+or+' L4,'+ir+' Z':''}}});
Ext.define('Ext.ux.rating.Picker',{extend:Ext.Gadget,xtype:'rating',focusable:!0,cachedConfig:{family:'monospace',glyphs:'☆★',minimum:1,limit:5,overStyle:null,rounding:1,scale:'125%',selectedStyle:null,tip:null,trackOver:!0,value:null,tooltipText:null,trackingValue:null},config:{animate:null},element:{cls:'u'+Ext.baseCSSPrefix+'rating-picker',reference:'element',children:[{reference:'innerEl',cls:'u'+Ext.baseCSSPrefix+'rating-picker-inner',listeners:{click:'onClick',mousemove:'onMouseMove',mouseenter:'onMouseEnter',
mouseleave:'onMouseLeave'},children:[{reference:'valueEl',cls:'u'+Ext.baseCSSPrefix+'rating-picker-value'},{reference:'trackerEl',cls:'u'+Ext.baseCSSPrefix+'rating-picker-tracker'}]}]},defaultBindProperty:'value',twoWayBindable:'value',overCls:'u'+Ext.baseCSSPrefix+'rating-picker-over',trackOverCls:'u'+Ext.baseCSSPrefix+'rating-picker-track-over',applyGlyphs:function(value){'string'===typeof value?(2!==value.length&&Ext.raise('Expected 2 characters for "glyphs" not "'+value+'".'),value=[value.charAt(0),
value.charAt(1)]):'number'===typeof value[0]&&(value=[String.fromCharCode(value[0]),String.fromCharCode(value[1])]);return value},applyOverStyle:function(style){this.trackerEl.applyStyles(style)},applySelectedStyle:function(style){this.valueEl.applyStyles(style)},applyTip:function(tip){tip&&'function'!==typeof tip&&(tip.isTemplate||(tip=new Ext.XTemplate(tip)),tip=tip.apply.bind(tip));return tip},applyTrackingValue:function(value){return this.applyValue(value)},applyValue:function(v){if(null!==v){var rounding=
this.getRounding();var limit=this.getLimit();var min=this.getMinimum();v=Math.round(Math.round(v/rounding)*rounding*1E3)/1E3;v=v<min?min:v>limit?limit:v}return v},onClick:function(event){event=this.valueFromEvent(event);this.setValue(event)},onMouseEnter:function(){this.element.addCls(this.overCls)},onMouseLeave:function(){this.element.removeCls(this.overCls)},onMouseMove:function(event){event=this.valueFromEvent(event);this.setTrackingValue(event)},updateFamily:function(family){this.element.setStyle('fontFamily',
"'"+family+"'")},updateGlyphs:function(){this.refreshGlyphs()},updateLimit:function(){this.refreshGlyphs()},updateScale:function(size){this.element.setStyle('fontSize',size)},updateTip:function(){this.refreshTip()},updateTooltipText:function(text){this.setTooltip(text)},updateTrackingValue:function(value){var trackerEl=this.trackerEl;value=this.valueToPercent(value);trackerEl.setStyle('width',value);this.refreshTip()},updateTrackOver:function(trackOver){this.element.toggleCls(this.trackOverCls,trackOver)},
updateValue:function(value,oldValue){var animate=this.getAnimate(),valueEl=this.valueEl,newWidth=this.valueToPercent(value);this.isConfiguring||!animate?valueEl.setStyle('width',newWidth):(valueEl.stopAnimation(),valueEl.animate(Ext.merge({from:{width:this.valueToPercent(oldValue)},to:{width:newWidth}},animate)));this.refreshTip();this.isConfiguring||(this.hasListeners.change&&this.fireEvent('change',this,value,oldValue),(animate=(oldValue=this.getWidgetColumn&&this.getWidgetColumn())&&this.getWidgetRecord&&
this.getWidgetRecord())&&oldValue.dataIndex&&animate.set(oldValue.dataIndex,value))},afterCachedConfig:function(){this.refresh();return this.callParent(arguments)},initConfig:function(instanceConfig){this.isConfiguring=!0;this.callParent([instanceConfig]);this.refresh()},setConfig:function(){this.isReconfiguring=!0;this.callParent(arguments);this.isReconfiguring=!1;this.refresh();return this},privates:{getGlyphTextNode:function(dom){var node=dom.lastChild;node&&3===node.nodeType||(node=dom.ownerDocument.createTextNode(''),
dom.appendChild(node));return node},getTooltipData:function(){return{component:this,tracking:this.getTrackingValue(),trackOver:this.getTrackOver(),value:this.getValue()}},refresh:function(){this.invalidGlyphs&&this.refreshGlyphs(!0);this.invalidTip&&this.refreshTip(!0)},refreshGlyphs:function(now){now=!now&&(this.isConfiguring||this.isReconfiguring);var on,off;if(!now){var el=this.getGlyphTextNode(this.innerEl.dom);var valueEl=this.getGlyphTextNode(this.valueEl.dom);var trackerEl=this.getGlyphTextNode(this.trackerEl.dom);
var glyphs=this.getGlyphs();var limit=this.getLimit();for(on=off='';limit--;)off+=glyphs[0],on+=glyphs[1];el.nodeValue=off;valueEl.nodeValue=on;trackerEl.nodeValue=on}this.invalidGlyphs=now},refreshTip:function(now){now=!now&&(this.isConfiguring||this.isReconfiguring);var tooltip;if(!now&&(tooltip=this.getTip())){var data=this.getTooltipData();data=tooltip(data);this.setTooltipText(data)}this.invalidTip=now},valueFromEvent:function(event){var el=this.innerEl,ex=event.getX();event=this.getRounding();
var cx=el.getX();ex-=cx;el=el.getWidth();cx=this.getLimit();this.getInherited().rtl&&(ex=el-ex);return Math.ceil(ex/el*cx/event)*event},valueToPercent:function(value){value=value/this.getLimit()*100;return value+'%'}}});
Ext.define('Ext.ux.overrides.rating.Picker',{override:'Ext.ux.rating.Picker',initConfig:function(config){config&&config.tooltip&&(config.tip=config.tooltip,Ext.log.warn('[Ext.ux.rating.Picker] The "tooltip" config was replaced by "tip"'));this.callParent([config])},updateTooltipText:function(text){var innerEl=this.innerEl,QuickTips=Ext.tip&&Ext.tip.QuickTipManager,tip=QuickTips&&QuickTips.tip;QuickTips&&(innerEl.dom.setAttribute('data-qtip',text),this.trackerEl.dom.setAttribute('data-qtip',text),
(QuickTips=(QuickTips=tip&&tip.activeTarget)&&QuickTips.el)&&innerEl.contains(QuickTips)&&tip.update(text))}});
Ext.define('Ext.ux.dd.BoxContainerDD',{extend:Ext.dd.DD,alignElWithMouse:function(el,iPageX,iPageY){iPageX=this.getTargetCoord(iPageX,iPageY);iPageY=iPageX.x;var y=iPageX.y,fly=el.dom?el:Ext.fly(el,'_dd');if(this.deltaSetXY)this.setLocalXY(fly,Math.max(0,iPageY+this.deltaSetXY[0]),Math.max(0,y+this.deltaSetXY[1]));else{var aCoord=[Math.max(0,iPageY),Math.max(0,y)];fly.setXY(aCoord);aCoord=this.getLocalX(fly);fly=fly.getLocalY();this.deltaSetXY=[aCoord-iPageY,fly-y]}this.cachePosition(iPageY,y);this.autoScroll(iPageY,
y,el.offsetHeight,el.offsetWidth);return iPageX}});
Ext.define('Ext.ux.BoxReorderer',{extend:Ext.plugin.Abstract,alias:'plugin.boxreorderer',mixins:{observable:Ext.util.Observable},itemSelector:'.x-box-item',animate:100,constructor:function(){this.callParent(arguments);this.mixins.observable.constructor.call(this)},init:function(container){var layout=container.getLayout();this.container=container;this.names=layout._props[layout.type].names;this.animatePolicy={};this.animatePolicy[this.names.x]=!0;this.container.on({scope:this,boxready:this.onBoxReady,
beforedestroy:this.onContainerDestroy})},onContainerDestroy:function(){var dd=this.dd;dd&&(dd.unreg(),this.dd=null)},onBoxReady:function(){var layout=this.container.getLayout(),names=this.names;layout=this.dd=new Ext.ux.dd.BoxContainerDD(layout.innerCt,this.container.id+'-reorderer');Ext.apply(layout,{animate:this.animate,reorderer:this,container:this.container,getDragCmp:this.getDragCmp,clickValidator:Ext.Function.createInterceptor(layout.clickValidator,this.clickValidator,this,!1),onMouseDown:this.onMouseDown,
startDrag:this.startDrag,onDrag:this.onDrag,endDrag:this.endDrag,getNewIndex:this.getNewIndex,doSwap:this.doSwap,findReorderable:this.findReorderable,names:names});layout.dim=names.width;layout.startAttr=names.beforeX;layout.endAttr=names.afterX},getDragCmp:function(e){return this.container.getChildByElement(e.getTarget(this.itemSelector,10))},clickValidator:function(e){e=this.getDragCmp(e);return!(!e||!1===e.reorderable)},onMouseDown:function(e){var container=this.container;if(this.dragCmp=this.getDragCmp(e)){var cmpEl=
this.dragCmp.getEl();this.startIndex=this.curIndex=container.items.indexOf(this.dragCmp);cmpEl=cmpEl.getBox();this.lastPos=cmpEl[this.startAttr];container=container.el.getBox();'width'===this.dim?(this.minX=container.left,this.maxX=container.right-cmpEl.width,this.minY=this.maxY=cmpEl.top,this.deltaX=e.getX()-cmpEl.left):(this.minY=container.top,this.maxY=container.bottom-cmpEl.height,this.minX=this.maxX=cmpEl.left,this.deltaY=e.getY()-cmpEl.top);this.constrainY=this.constrainX=!0}},startDrag:function(){var dragCmp=
this.dragCmp,scrollable;if(dragCmp){if((scrollable=this.container.getScrollable())&&scrollable.scrollBy(-1).then(function(){scrollable.scrollBy(1)}),dragCmp.setPosition=Ext.emptyFn,dragCmp.animate=!1,this.animate&&(this.container.getLayout().animatePolicy=this.reorderer.animatePolicy),this.dragElId=dragCmp.getEl().id,this.reorderer.fireEvent('StartDrag',this,this.container,dragCmp,this.curIndex),dragCmp.suspendEvents(),dragCmp.disabled=!0,dragCmp.el.setStyle('zIndex',100),!dragCmp.nextSibling()){dragCmp=
this.container.layout.targetEl;var dom=dragCmp.dom;var left=dom.scrollWidth-1;dom=dom.scrollHeight-1;this.spacerEl=Ext.dom.Helper.append(dragCmp,{tag:'div',style:'width: 1px;height: 1px;position: absolute;left: '+left+'px;top: '+dom+'px;"'})}}else this.dragElId=null},findReorderable:function(newIndex){var items=this.container.items;if(!1===items.getAt(newIndex).reorderable){var newItem=items.getAt(newIndex);if(newIndex>this.startIndex)for(;newItem&&!1===newItem.reorderable;)newIndex++,newItem=items.getAt(newIndex);
else for(;newItem&&!1===newItem.reorderable;)newIndex--,newItem=items.getAt(newIndex)}newIndex=Math.min(Math.max(newIndex,0),items.getCount()-1);return!1===items.getAt(newIndex).reorderable?-1:newIndex},doSwap:function(newIndex){var items=this.container.items,container=this.container;newIndex=this.findReorderable(newIndex);if(-1!==newIndex&&newIndex!==this.curIndex){this.reorderer.fireEvent('ChangeIndex',this,container,this.dragCmp,this.startIndex,newIndex);var orig=items.getAt(this.curIndex);var dest=
items.getAt(newIndex);items.remove(orig);var tmpIndex=Math.min(Math.max(newIndex,0),items.getCount()-1);items.insert(tmpIndex,orig);items.remove(dest);items.insert(this.curIndex,dest);container.updateLayout({isRoot:!0});this.curIndex=newIndex}},onDrag:function(e){e=this.getNewIndex(e.getPoint());void 0!==e&&(this.reorderer.fireEvent('Drag',this,this.container,this.dragCmp,this.startIndex,this.curIndex),this.doSwap(e))},endDrag:function(e){var dragCmp=this.dragCmp,container=this.container,layout=container.getLayout();
e&&e.stopEvent();if(dragCmp){delete this.dragElId;delete dragCmp.setPosition;dragCmp.animate=!0;dragCmp.lastBox[this.names.x]=dragCmp.getPosition(!0)[this.names.widthIndex];container.updateLayout({isRoot:!0});if(e=Ext.fx.Manager.getFxQueue(dragCmp.el.id)[0])e.on({afteranimate:this.reorderer.afterBoxReflow,scope:this});else Ext.asap(this.reorderer.afterBoxReflow,this);this.animate&&delete layout.animatePolicy;this.reorderer.fireEvent('drop',this,container,dragCmp,this.startIndex,this.curIndex)}},afterBoxReflow:function(){var spacerEl=
Ext.fly(this.spacerEl),dragCmp=this.dragCmp;dragCmp.el.setStyle('zIndex','');dragCmp.disabled=!1;dragCmp.resumeEvents();spacerEl&&(spacerEl.remove(),this.spacerEl=null)},getNewIndex:function(pointerPos){pointerPos=this.getDragEl();var dragBox=Ext.fly(pointerPos).getBox(),i=0,it=this.container.items.items,ln=it.length,lastPos=this.lastPos;for(this.lastPos=dragBox[this.startAttr];i<ln;i++){var targetEl=it[i].getEl();if(targetEl.dom!==pointerPos&&targetEl.is(this.reorderer.itemSelector))if(targetEl=
targetEl.getBox(),targetEl=targetEl[this.startAttr]+(targetEl[this.dim]>>1),i<this.curIndex){if(dragBox[this.startAttr]<lastPos&&dragBox[this.startAttr]<targetEl-5)return i}else if(i>this.curIndex&&dragBox[this.startAttr]>lastPos&&dragBox[this.endAttr]>targetEl+5)return i}}});
Ext.define('Ext.ux.CellDragDrop',{extend:Ext.plugin.Abstract,alias:'plugin.celldragdrop',enforceType:!1,applyEmptyText:!1,emptyText:'',dropBackgroundColor:'green',noDropBackgroundColor:'red',dragText:'{0} selected row{1}',ddGroup:'GridDD',enableDrop:!0,enableDrag:!0,containerScroll:!1,init:function(view){view.on('render',this.onViewRender,this,{single:!0})},destroy:function(){this.dragZone=this.dropZone=Ext.destroy(this.dragZone,this.dropZone);this.callParent()},enable:function(){this.dragZone&&this.dragZone.unlock();
this.dropZone&&this.dropZone.unlock();this.callParent()},disable:function(){this.dragZone&&this.dragZone.lock();this.dropZone&&this.dropZone.lock();this.callParent()},onViewRender:function(view$jscomp$0){var me=this,scrollEl;me.enableDrag&&(me.containerScroll&&(scrollEl=view$jscomp$0.getEl()),me.dragZone=new Ext.view.DragZone({view:view$jscomp$0,ddGroup:me.dragGroup||me.ddGroup,dragText:me.dragText,containerScroll:me.containerScroll,scrollEl:scrollEl,getDragData:function(e){var view=this.view,item=
e.getTarget(view.getItemSelector()),record=view.getRecord(item),cell=e.getTarget(view.getCellSelector());if(item)return item=document.createElement('div'),item.className='x-form-text',item.appendChild(document.createTextNode(cell.textContent||cell.innerText)),view=view.getHeaderByCell(cell),{event:new Ext.EventObjectImpl(e),ddel:item,item:e.target,columnName:view.dataIndex,record:record}},onInitDrag:function(x,y){var data=this.dragData,selectionModel=this.view.getSelectionModel(),record=data.record;
data=data.ddel;selectionModel.isSelected(record)||selectionModel.select(record,!0);Ext.fly(this.ddel).update(data.textContent||data.innerText);this.proxy.update(this.ddel);this.onStartDrag(x,y);return!0}}));me.enableDrop&&(me.dropZone=new Ext.dd.DropZone(view$jscomp$0.el,{view:view$jscomp$0,ddGroup:me.dropGroup||me.ddGroup,containerScroll:!0,getTargetFromEvent:function(e){var view=this.view;e=e.getTarget(view.cellSelector);if(e){var row=view.findItemByChild(e);var header=view.getHeaderByCell(e);if(row&&
header)return{node:e,record:view.getRecord(row),columnName:header.dataIndex}}},onNodeEnter:function(target,dd,e,dragData){dd=target.record.getField(target.columnName).type.toUpperCase();e=dragData.record.getField(dragData.columnName).type.toUpperCase();delete this.dropOK;if(target&&target.node!==dragData.item.parentNode){if(me.enforceType&&dd!==e)return this.dropOK=!1,me.noDropCls?Ext.fly(target.node).addCls(me.noDropCls):Ext.fly(target.node).applyStyles({backgroundColor:me.noDropBackgroundColor}),
!1;this.dropOK=!0;me.dropCls?Ext.fly(target.node).addCls(me.dropCls):Ext.fly(target.node).applyStyles({backgroundColor:me.dropBackgroundColor})}},onNodeOver:function(target,dd,e,dragData){return this.dropOK?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(target,dd,e,dragData){(dd=this.dropOK?me.dropCls:me.noDropCls)?Ext.fly(target.node).removeCls(dd):Ext.fly(target.node).applyStyles({backgroundColor:''})},onNodeDrop:function(target,dd,e,dragData){if(this.dropOK)return target.record.set(target.columnName,
dragData.record.get(dragData.columnName)),me.applyEmptyText&&dragData.record.set(dragData.columnName,me.emptyText),!0},onCellDrop:Ext.emptyFn}))}});
Ext.define('Ext.ux.DataTip',function(DataTip){function onHostRender(){var e=this.isXType('panel')?this.body:this.el;this.dataTip.renderToTarget&&this.dataTip.render(e);this.dataTip.setTarget(e)}function updateTip(tip,data){if(tip.rendered){if(!1===tip.host.fireEvent('beforeshowtip',tip.eventHost,tip,data))return!1;tip.update(data)}else Ext.isString(data)?tip.html=data:tip.data=data}function beforeViewTipShow(tip){var rec=this.view.getRecord(tip.triggerElement);return rec?(rec=tip.initialConfig.data?
Ext.apply(tip.initialConfig.data,rec.data):rec.data,updateTip(tip,rec)):!1}function beforeFormTipShow(tip){var field=Ext.getCmp(tip.triggerElement.id);return field&&(field.tooltip||tip.tpl)?updateTip(tip,field.tooltip||field):!1}return{extend:Ext.tip.ToolTip,mixins:{plugin:Ext.plugin.Abstract},alias:'plugin.datatip',lockableScope:'both',constructor:function(config){this.callParent([config]);this.mixins.plugin.constructor.call(this,config)},init:function(host){this.mixins.plugin.init.call(this,host);
host.dataTip=this;this.host=host;host.isXType('tablepanel')?(this.view=host.getView(),host.ownerLockable&&(this.host=host.ownerLockable),this.delegate=this.delegate||this.view.rowSelector,this.on('beforeshow',beforeViewTipShow)):host.isXType('dataview')?(this.view=this.host,this.delegate=this.delegate||host.itemSelector,this.on('beforeshow',beforeViewTipShow)):host.isXType('form')?(this.delegate='.'+Ext.form.Labelable.prototype.formItemCls,this.on('beforeshow',beforeFormTipShow)):host.isXType('combobox')&&
(this.view=host.getPicker(),this.delegate=this.delegate||this.view.getItemSelector(),this.on('beforeshow',beforeViewTipShow));host.rendered?onHostRender.call(host):host.onRender=Ext.Function.createSequence(host.onRender,onHostRender)}}});
Ext.define('Ext.ux.DataView.Animated',{alias:'plugin.ux-animated-dataview',defaults:{duration:750,idProperty:'id'},constructor:function(config){Ext.apply(this,config||{},this.defaults)},init:function(dataview){var me=this,store=dataview.store,items=dataview.all,task={interval:20},duration=me.duration;me.dataview=dataview;dataview.blockRefresh=!0;dataview.updateIndexes=Ext.Function.createSequence(dataview.updateIndexes,function(){this.getTargetEl().select(this.itemSelector).each(function(element,composite,
index){element.dom.id=Ext.util.Format.format('{0}-{1}',dataview.id,store.getAt(index).internalId)},this)},dataview);me.dataviewID=dataview.id;me.cachedStoreData={};me.cacheStoreData(store.data||store.snapshot);dataview.on('resize',function(){dataview.store.getCount()},this);dataview.store.on({datachanged:function(){var parentEl=dataview.getTargetEl(),parentElY=parentEl.getY(),parentElPaddingTop=parentEl.getPadding('t'),added=me.getAdded(store),removed=me.getRemoved(store),remaining=me.getRemaining(store),
i,itemFly=new Ext.dom.Fly,oldPos,styleSide=me.dataview.getInherited().rtl?'right':'left',newStyle={};if(parentEl){Ext.iterate(removed,function(recId,item){id$jscomp$0=me.dataviewID+'-'+recId;Ext.fx.Manager.stopAnimation(id$jscomp$0);item.dom=Ext.getDom(id$jscomp$0);item.dom||delete removed[recId]});me.cacheStoreData(store);var oldPositions={};var newPositions={};Ext.iterate(remaining,function(id,item){itemFly.attach(Ext.getDom(me.dataviewID+'-'+id))?(oldPos=oldPositions[id]={top:itemFly.getY()-parentElY-
itemFly.getMargin('t')-parentElPaddingTop},oldPos[styleSide]=me.getItemX(itemFly)):delete remaining[id]});dataview.refresh();Ext.iterate(removed,function(id,item){parentEl.dom.appendChild(item.dom);itemFly.attach(item.dom).animate({duration:duration,opacity:0,callback:function(anim){(anim=Ext.get(anim.target.id))&&anim.destroy()}});delete item.dom});if(store.getCount()){var itemArray=items.slice();for(i=itemArray.length-1;0<=i;i--){var id$jscomp$0=store.getAt(i).internalId;itemFly.attach(itemArray[i]);
newPositions[id$jscomp$0]={dom:itemFly.dom,top:itemFly.getY()-parentElY-itemFly.getMargin('t')-parentElPaddingTop};newPositions[id$jscomp$0][styleSide]=me.getItemX(itemFly);var newPos=oldPositions[id$jscomp$0]||newPositions[id$jscomp$0];newStyle.position='absolute';newStyle.top=newPos.top+'px';newStyle[styleSide]=newPos.left+'px';itemFly.applyStyles(newStyle)}Ext.iterate(added,function(id,item){itemFly.attach(Ext.getDom(me.dataviewID+'-'+id))&&(itemFly.setOpacity(0),itemFly.animate({duration:duration,
opacity:1}))});Ext.TaskManager.stop(task);task.run=function(){var fraction=(new Date-task.taskStartTime)/duration;if(1<=fraction){newStyle.position=newStyle.top=newStyle[styleSide]='';for(id$jscomp$0 in newPositions)itemFly.attach(newPositions[id$jscomp$0].dom).applyStyles(newStyle);Ext.TaskManager.stop(task)}else for(id$jscomp$0 in remaining){var oldPos=oldPositions[id$jscomp$0];var newPos=newPositions[id$jscomp$0];var oldTop=oldPos.top;var newTop=newPos.top;oldPos=oldPos[styleSide];var newLeft=
newPos[styleSide];var diffTop=fraction*Math.abs(oldTop-newTop);var diffLeft=fraction*Math.abs(oldPos-newLeft);oldTop=oldTop>newTop?oldTop-diffTop:oldTop+diffTop;newTop=oldPos>newLeft?oldPos-diffLeft:oldPos+diffLeft;newStyle.top=oldTop+'px';newStyle[styleSide]=newTop+'px';itemFly.attach(newPos.dom).applyStyles(newStyle)}};Ext.TaskManager.start(task);me.cacheStoreData(store)}}},scope:this,buffer:50})},getItemX:function(el){var rtl=this.dataview.getInherited().rtl,parentEl=el.up('');return rtl?parentEl.getViewRegion().right-
el.getRegion().right+el.getMargin('r'):el.getX()-parentEl.getX()-el.getMargin('l')-parentEl.getPadding('l')},cacheStoreData:function(store){var cachedStoreData=this.cachedStoreData={};store.each(function(record){cachedStoreData[record.internalId]=record})},getExisting:function(){return this.cachedStoreData},getExistingCount:function(){var count=0,items=this.getExisting(),k;for(k in items)count++;return count},getAdded:function(store){var cachedStoreData=this.cachedStoreData,added={};store.each(function(record){null==
cachedStoreData[record.internalId]&&(added[record.internalId]=record)});return added},getRemoved:function(store){var cachedStoreData=this.cachedStoreData,removed={},id;for(id in cachedStoreData)-1===store.findBy(function(record){return record.internalId===id})&&(removed[id]=cachedStoreData[id]);return removed},getRemaining:function(store){var cachedStoreData=this.cachedStoreData,remaining={};store.each(function(record){null!=cachedStoreData[record.internalId]&&(remaining[record.internalId]=record)});
return remaining}});
Ext.define('Ext.ux.DataView.DragSelector',{alias:'plugin.dataviewdragselector',init:function(dataview){var scroller=dataview.getScrollable();scroller&&(scroller.getX()||scroller.getY())&&(Ext.supports.PointerEvents||Ext.supports.MSPointerEvents)?Ext.log.warn('DragSelector not available on PointerEvent devices'):(this.dataview=dataview,dataview.mon(dataview,{beforecontainerclick:this.cancelClick,scope:this,render:{fn:this.onRender,scope:this,single:!0}}))},onRender:function(){this.tracker=Ext.create('Ext.dd.DragTracker',
{dataview:this.dataview,el:this.dataview.el,onBeforeStart:this.onBeforeStart,onStart:this.onStart.bind(this),onDrag:this.onDrag.bind(this),onEnd:Ext.Function.createDelayed(this.onEnd,100,this)});this.dragRegion=Ext.create('Ext.util.Region')},onBeforeStart:function(e){return e.target===this.dataview.getEl().dom},onStart:function(e){e=this.dataview;this.dragging=!0;this.fillRegions();this.getProxy().show();e.getSelectionModel().deselectAll()},cancelClick:function(){return!this.dragging},onDrag:function(e){e=
this.dataview.getSelectionModel();var dragRegion=this.dragRegion,bodyRegion=this.bodyRegion,proxy=this.getProxy(),regions=this.regions,length=regions.length,startXY=this.tracker.startXY,currentXY=this.tracker.getXY(),minX=Math.min(startXY[0],currentXY[0]),minY=Math.min(startXY[1],currentXY[1]);Ext.apply(dragRegion,{top:minY,left:minX,right:minX+Math.abs(startXY[0]-currentXY[0]),bottom:minY+Math.abs(startXY[1]-currentXY[1])});dragRegion.constrainTo(bodyRegion);proxy.setBox(dragRegion);for(bodyRegion=
0;bodyRegion<length;bodyRegion++)proxy=regions[bodyRegion],(proxy=dragRegion.intersect(proxy))?e.select(bodyRegion,!0):e.deselect(bodyRegion)},onEnd:function(e){this.dataview.getSelectionModel();this.dragging=!1;this.getProxy().hide()},getProxy:function(){this.proxy||(this.proxy=this.dataview.getEl().createChild({tag:'div',cls:'x-view-selector'}));return this.proxy},fillRegions:function(){var dataview=this.dataview,regions=this.regions=[];dataview.all.each(function(node){regions.push(node.getRegion())});
this.bodyRegion=dataview.getEl().getRegion()}});
Ext.define('Ext.ux.DataView.Draggable',{ghostCls:'x-dataview-draggable-ghost',ghostTpl:['\x3ctpl for\x3d"."\x3e','{title}','\x3c/tpl\x3e'],init:function(dataview,config){this.dataview=dataview;dataview.on('render',this.onRender,this);Ext.apply(this,{itemSelector:dataview.itemSelector,ghostConfig:{}},config||{});Ext.applyIf(this.ghostConfig,{itemSelector:'img',cls:this.ghostCls,tpl:this.ghostTpl})},onRender:function(){var config=Ext.apply({},this.ddConfig||{},{dvDraggable:this,dataview:this.dataview,
getDragData:this.getDragData,getTreeNode:this.getTreeNode,afterRepair:this.afterRepair,getRepairXY:this.getRepairXY});this.dragZone=Ext.create('Ext.dd.DragZone',this.dataview.getEl(),config);this.dataview.setItemsDraggable(!0)},getDragData:function(e){var draggable=this.dvDraggable,dataview=this.dataview,selModel=dataview.getSelectionModel(),target=e.getTarget(draggable.itemSelector);return target?(e.preventDefault(),dataview.isSelected(target)||selModel.select(dataview.getRecord(target)),e=dataview.getSelectedNodes(),
dataview={copy:!0,nodes:e,records:selModel.getSelection(),item:!0},1===e.length?(dataview.single=!0,dataview.ddel=target):(dataview.multi=!0,dataview.ddel=draggable.prepareGhost(selModel.getSelection())),dataview):!1},getTreeNode:function(){},afterRepair:function(){var nodes=this.dragData.nodes,length=nodes.length,i;this.dragging=!1;for(i=0;i<length;i++)Ext.get(nodes[i]).frame('#8db2e3',1)},getRepairXY:function(e){if(this.dragData.multi)return!1;e=Ext.get(this.dragData.ddel);var repairXY=e.getXY();
repairXY[0]+=e.getPadding('t')+e.getMargin('t');repairXY[1]+=e.getPadding('l')+e.getMargin('l');return repairXY},prepareGhost:function(records){return this.createGhost(records).getEl().dom},createGhost:function(records){var store;this.ghost?(store=this.ghost.store).loadRecords(records):(store=Ext.create('Ext.data.Store',{model:records[0].self}),store.loadRecords(records),this.ghost=Ext.create('Ext.view.View',Ext.apply({renderTo:document.createElement('div'),store:store},this.ghostConfig)),this.ghost.container.skipGarbageCollection=
this.ghost.el.skipGarbageCollection=!0);store.clearData();return this.ghost},destroy:function(){var ghost=this.ghost;ghost&&(ghost.container.destroy(),ghost.destroy());this.callParent()}});
Ext.define('Ext.ux.DataView.LabelEditor',{extend:Ext.Editor,alias:'plugin.dataviewlabeleditor',alignment:'tl-tl',completeOnEnter:!0,cancelOnEsc:!0,shim:!1,autoSize:{width:'boundEl',height:'field'},labelSelector:'x-editable',constructor:function(config){config.field=config.field||Ext.create('Ext.form.field.Text',{allowOnlyWhitespace:!1,selectOnFocus:!0});this.callParent([config])},init:function(view){this.view=view;this.mon(view,'afterrender',this.bindEvents,this);this.on('complete',this.onSave,this)},
bindEvents:function(){this.mon(this.view.getEl(),{click:{fn:this.onClick,scope:this}})},onClick:function(e,target){!Ext.fly(target).hasCls(this.labelSelector)||this.editing||e.ctrlKey||e.shiftKey?this.editing&&(this.field.blur(),e.preventDefault()):(e.stopEvent(),e=this.view.findItemByChild(target),e=this.view.store.getAt(this.view.indexOf(e)),this.startEdit(target,e.data[this.dataIndex]),this.activeRecord=e)},onSave:function(ed,value){this.activeRecord.set(this.dataIndex,value)}});
Ext.define('Ext.ux.Explorer',{extend:Ext.panel.Panel,xtype:'explorer',config:{breadcrumb:{dock:'top',xtype:'breadcrumb',reference:'breadcrumb'},contentView:{xtype:'dataview',reference:'contentView',region:'center',cls:Ext.baseCSSPrefix+'explorer-view',itemSelector:'.'+Ext.baseCSSPrefix+'explorer-item',tpl:'\x3ctpl for\x3d"."\x3e\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'explorer-item"\x3e\x3cdiv class\x3d"{iconCls}"\x3e\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'explorer-node-icon{[values.leaf ? " '+Ext.baseCSSPrefix+
'explorer-leaf-icon" : ""]}"\x3e\x3c/div\x3e\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'explorer-item-text"\x3e{text}\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3c/tpl\x3e'},store:null,tree:{xtype:'treepanel',reference:'tree',region:'west',width:200}},renderConfig:{selection:null},layout:'border',referenceHolder:!0,defaultListenerScope:!0,cls:Ext.baseCSSPrefix+'explorer',initComponent:function(){this.getStore()||Ext.raise('Ext.ux.Explorer requires a store.');this.dockedItems=[this.getBreadcrumb()];this.items=
[this.getTree(),this.getContentView()];this.callParent()},applyBreadcrumb:function(breadcrumb){var store=this.getStore();breadcrumb=Ext.create(Ext.apply({store:store,selection:store.getRoot()},breadcrumb));breadcrumb.on('selectionchange','_onBreadcrumbSelectionChange',this);return breadcrumb},applyContentView:function(contentView){var contentStore=this.contentStore=new Ext.data.Store({model:this.getStore().model});return contentView=Ext.create(Ext.apply({store:contentStore},contentView))},applyTree:function(tree){tree=
Ext.create(Ext.apply({store:this.getStore()},tree));tree.on('selectionchange','_onTreeSelectionChange',this);return tree},updateSelection:function(node){var refs=this.getReferences(),breadcrumb=refs.breadcrumb,tree=refs.tree,treeSelectionModel=tree.getSelectionModel();refs=this.contentStore;breadcrumb.getSelection()!==node&&breadcrumb.setSelection(node);treeSelectionModel.getSelection()[0]!==node&&(treeSelectionModel.select([node]),(breadcrumb=node.parentNode)&&breadcrumb.expand(),breadcrumb=tree.getView(),
breadcrumb.scrollRowIntoView(breadcrumb.getRow(node)));refs.removeAll();refs.add(node.hasChildNodes()?node.childNodes:[node])},updateStore:function(store){this.getBreadcrumb().setStore(store)},privates:{_onTreeSelectionChange:function(tree,selection){this.setSelection(selection[0])},_onBreadcrumbSelectionChange:function(breadcrumb,selection){this.setSelection(selection)}}});
Ext.define('Ext.ux.FieldReplicator',{alias:'plugin.fieldreplicator',init:function(field){field.replicatorId||(field.replicatorId=Ext.id());field.on('blur',this.onBlur,this)},onBlur:function(field){var ownerCt=field.ownerCt,replicatorId=field.replicatorId,isEmpty=Ext.isEmpty(field.getRawValue()),siblings=ownerCt.query('[replicatorId\x3d'+replicatorId+']');siblings=siblings[siblings.length-1]===field;if(isEmpty&&!siblings)Ext.defer(field.destroy,10,field);else if(!isEmpty&&siblings){if(field.onReplicate)field.onReplicate();
replicatorId=field.cloneConfig({replicatorId:replicatorId});field=ownerCt.items.indexOf(field);ownerCt.add(field+1,replicatorId)}}});
Ext.define('Ext.ux.GMapPanel',{extend:Ext.panel.Panel,alias:'widget.gmappanel',initComponent:function(){Ext.applyIf(this,{plain:!0,gmapType:'map',border:!1});this.callParent()},onBoxReady:function(){var center=this.center;this.callParent(arguments);center?center.geoCodeAddr?this.lookupCode(center.geoCodeAddr,center.marker):this.createMap(center):Ext.raise('center is required')},createMap:function(center,marker){var options=Ext.apply({},this.mapOptions);options=Ext.applyIf(options,{zoom:14,center:center,
mapTypeId:google.maps.MapTypeId.HYBRID});this.gmap=new google.maps.Map(this.body.dom,options);marker&&this.addMarker(Ext.applyIf(marker,{position:center}));Ext.each(this.markers,this.addMarker,this);this.fireEvent('mapready',this,this.gmap)},addMarker:function(marker){marker=Ext.apply({map:this.gmap},marker);marker.position||(marker.position=new google.maps.LatLng(marker.lat,marker.lng));var o=new google.maps.Marker(marker);Ext.Object.each(marker.listeners,function(name,fn){google.maps.event.addListener(o,
name,fn)});return o},lookupCode:function(addr,marker){this.geocoder=new google.maps.Geocoder;this.geocoder.geocode({address:addr},Ext.Function.bind(this.onLookupComplete,this,[marker],!0))},onLookupComplete:function(data,response,marker){'OK'!==response?Ext.MessageBox.alert('Error','An error occured: "'+response+'"'):this.createMap(data[0].geometry.location,marker)},afterComponentLayout:function(w,h){this.callParent(arguments);this.redraw()},redraw:function(){var map=this.gmap;map&&google.maps.event.trigger(map,
'resize')}});
Ext.define('Ext.ux.IFrame',{extend:Ext.Component,alias:'widget.uxiframe',loadMask:'Loading...',src:'about:blank',renderTpl:['\x3ciframe src\x3d"{src}" id\x3d"{id}-iframeEl" data-ref\x3d"iframeEl" name\x3d"{frameName}" width\x3d"100%" height\x3d"100%" frameborder\x3d"0"\x3e\x3c/iframe\x3e'],childEls:['iframeEl'],initComponent:function(){this.callParent();this.frameName=this.frameName||this.id+'-frame'},initEvents:function(){this.callParent();this.iframeEl.on('load',this.onLoad,this)},initRenderData:function(){return Ext.apply(this.callParent(),
{src:this.src,frameName:this.frameName})},getBody:function(){var doc=this.getDoc();return doc.body||doc.documentElement},getDoc:function(){try{return this.getWin().document}catch(ex){return null}},getWin:function(){var name=this.frameName;return Ext.isIE?this.iframeEl.dom.contentWindow:window.frames[name]},getFrame:function(){return this.iframeEl.dom},onLoad:function(){this.getDoc()?(this.el.unmask(),this.fireEvent('load',this)):this.src&&(this.el.unmask(),this.fireEvent('error',this))},load:function(src){var text=
this.loadMask,frame=this.getFrame();!1!==this.fireEvent('beforeload',this,src)&&(text&&this.el&&this.el.mask(text),frame.src=this.src=src||this.src)}});
Ext.define('Ext.ux.statusbar.StatusBar',{extend:Ext.toolbar.Toolbar,xtype:'statusbar',alternateClassName:'Ext.ux.StatusBar',cls:'x-statusbar',busyIconCls:'x-status-busy',busyText:'Loading...',autoClear:5E3,emptyText:'\x26#160;',activeThreadId:0,initComponent:function(){var right='right'===this.statusAlign;this.callParent(arguments);this.currIconCls=this.iconCls||this.defaultIconCls;this.statusEl=Ext.create('Ext.toolbar.TextItem',{cls:'x-status-text '+(this.currIconCls||''),text:this.text||this.defaultText||
''});right?(this.cls+=' x-status-right',this.add('-\x3e'),this.add(this.statusEl)):(this.insert(0,this.statusEl),this.insert(1,'-\x3e'))},setStatus:function(config){config=config||{};Ext.suspendLayouts();Ext.isString(config)&&(config={text:config});void 0!==config.text&&this.setText(config.text);void 0!==config.iconCls&&this.setIcon(config.iconCls);if(config.clear){config=config.clear;var wait=this.autoClear;var defaults={useDefaults:!0,anim:!0};Ext.isObject(config)?(config=Ext.applyIf(config,defaults),
config.wait&&(wait=config.wait)):Ext.isNumber(config)?(wait=config,config=defaults):Ext.isBoolean(config)&&(config=defaults);config.threadId=this.activeThreadId;Ext.defer(this.clearStatus,wait,this,[config])}Ext.resumeLayouts(!0);return this},clearStatus:function(config){var me=this,statusEl=me.statusEl;config=config||{};if(me.destroyed||config.threadId&&config.threadId!==me.activeThreadId)return me;var text=config.useDefaults?me.defaultText:me.emptyText;var iconCls=config.useDefaults?me.defaultIconCls?
me.defaultIconCls:'':'';config.anim?statusEl.el.puff({remove:!1,useDisplay:!0,callback:function(){statusEl.el.show();me.setStatus({text:text,iconCls:iconCls})}}):me.setStatus({text:text,iconCls:iconCls});return me},setText:function(text){this.activeThreadId++;this.text=text||'';this.rendered&&this.statusEl.setText(this.text);return this},getText:function(){return this.text},setIcon:function(cls){this.activeThreadId++;cls=cls||'';this.rendered?(this.currIconCls&&(this.statusEl.removeCls(this.currIconCls),
this.currIconCls=null),0<cls.length&&(this.statusEl.addCls(cls),this.currIconCls=cls)):this.currIconCls=cls;return this},showBusy:function(config){Ext.isString(config)&&(config={text:config});config=Ext.applyIf(config||{},{text:this.busyText,iconCls:this.busyIconCls});return this.setStatus(config)}});
Ext.define('Ext.ux.LiveSearchGridPanel',{extend:Ext.grid.Panel,searchValue:null,matches:[],currentIndex:null,searchRegExp:null,caseSensitive:!1,regExpMode:!1,matchCls:'x-livesearch-match',defaultStatusText:'Nothing Found',initComponent:function(){this.tbar=['Search',{xtype:'textfield',name:'searchField',hideLabel:!0,width:200,listeners:{change:{fn:this.onTextFieldChange,scope:this,buffer:500}}},{xtype:'button',text:'\x26lt;',tooltip:'Find Previous Row',handler:this.onPreviousClick,scope:this},{xtype:'button',
text:'\x26gt;',tooltip:'Find Next Row',handler:this.onNextClick,scope:this},'-',{xtype:'checkbox',hideLabel:!0,margin:'0 0 0 4px',handler:this.regExpToggle,scope:this},'Regular expression',{xtype:'checkbox',hideLabel:!0,margin:'0 0 0 4px',handler:this.caseSensitiveToggle,scope:this},'Case sensitive'];this.bbar=new Ext.ux.StatusBar({defaultText:this.defaultStatusText,name:'searchStatusBar'});this.callParent(arguments)},afterRender:function(){this.callParent(arguments);this.textField=this.down('textfield[name\x3dsearchField]');
this.statusBar=this.down('statusbar[name\x3dsearchStatusBar]');this.view.on('cellkeydown',this.focusTextField,this)},focusTextField:function(view,td,cellIndex,record,tr,rowIndex,e,eOpts){e.getKey()===e.S&&(e.preventDefault(),this.textField.focus())},tagsRe:/<[^>]*>/gm,tagsProtect:'',getSearchValue:function(){var value=this.textField.getValue();if(''===value)return null;if(this.regExpMode){try{new RegExp(value)}catch(error){return this.statusBar.setStatus({text:error.message,iconCls:'x-status-error'}),
null}if('^'===value||'$'===value)return null}else value=Ext.String.escapeRegex(value);return value},onTextFieldChange:function(){var me=this,count=0,view=me.view,columns=me.visibleColumnManager.getColumns();view.refresh();me.statusBar.setStatus({text:me.defaultStatusText,iconCls:''});me.searchValue=me.getSearchValue();me.matches=[];me.currentIndex=null;null!==me.searchValue&&(me.searchRegExp=new RegExp(me.getSearchValue(),'g'+(me.caseSensitive?'':'i')),me.store.each(function(record,idx){var node=
view.getNode(record);node&&Ext.Array.forEach(columns,function(column){var cell=Ext.fly(node).down(column.getCellInnerSelector(),!0),seen;if(cell){var matches=cell.innerHTML.match(me.tagsRe);var cellHTML=cell.innerHTML.replace(me.tagsRe,me.tagsProtect);cellHTML=cellHTML.replace(me.searchRegExp,function(m){++count;seen||(me.matches.push({record:record,column:column}),seen=!0);return'\x3cspan class\x3d"'+me.matchCls+'"\x3e'+m+'\x3c/span\x3e'},me);Ext.each(matches,function(match){cellHTML=cellHTML.replace(me.tagsProtect,
match)});cell.innerHTML=cellHTML}})},me),count&&(me.currentIndex=0,me.gotoCurrent(),me.statusBar.setStatus({text:Ext.String.format('{0} match{1} found.',count,1===count?'es':''),iconCls:'x-status-valid'})));null===me.currentIndex&&(me.getSelectionModel().deselectAll(),me.textField.focus())},onPreviousClick:function(){var len=this.matches.length,idx=this.currentIndex;len&&(this.currentIndex=0===idx?len-1:idx-1,this.gotoCurrent())},onNextClick:function(){var len=this.matches.length,idx=this.currentIndex;
len&&(this.currentIndex=idx===len-1?0:idx+1,this.gotoCurrent())},caseSensitiveToggle:function(checkbox,checked){this.caseSensitive=checked;this.onTextFieldChange()},regExpToggle:function(checkbox,checked){this.regExpMode=checked;this.onTextFieldChange()},privates:{gotoCurrent:function(){var pos=this.matches[this.currentIndex];this.getNavigationModel().setPosition(pos.record,pos.column);this.getSelectionModel().select(pos.record)}}});
Ext.define('Ext.ux.PreviewPlugin',{extend:Ext.plugin.Abstract,alias:'plugin.preview',hideBodyCls:'x-grid-row-body-hidden',bodyField:'',previewExpanded:!0,setCmp:function(target){this.callParent(arguments);var me=this,grid=me.cmp=target.isXType('gridview')?target.grid:target,bodyField=me.bodyField,hideBodyCls=me.hideBodyCls,feature=Ext.create('Ext.grid.feature.RowBody',{grid:grid,getAdditionalData:function(data,idx,model,rowValues){var getAdditionalData=Ext.grid.feature.RowBody.prototype.getAdditionalData,
additionalData={rowBody:data[bodyField],rowBodyCls:grid.getView().previewExpanded?'':hideBodyCls};Ext.isFunction(getAdditionalData)&&Ext.apply(additionalData,getAdditionalData.apply(this,arguments));return additionalData}}),initFeature=function(grid,view){view.previewExpanded=me.previewExpanded;view.featuresMC.add(feature);feature.init(grid)};if(grid.view)initFeature(grid,grid.view);else grid.on({viewcreated:initFeature,single:!0})},toggleExpanded:function(expanded){var grid=this.getCmp(),view=grid&&
grid.getView(),bufferedRenderer=view.bufferedRenderer,scrollManager=view.scrollManager;grid&&view&&expanded!==view.previewExpanded&&(this.previewExpanded=view.previewExpanded=!!expanded,view.refreshView(),scrollManager&&(bufferedRenderer?bufferedRenderer.stretchView(view,bufferedRenderer.getScrollHeight(!0)):scrollManager.refresh(!0)))}});
Ext.define('Ext.ux.ProgressBarPager',{alias:'plugin.ux-progressbarpager',width:225,defaultText:'Loading...',defaultAnimCfg:{duration:1E3,easing:'bounceOut'},constructor:function(config){config&&Ext.apply(this,config)},init:function(parent){var displayItem;parent.displayInfo&&(this.parent=parent,(displayItem=parent.child('#displayItem'))&&parent.remove(displayItem,!0),this.progressBar=Ext.create('Ext.ProgressBar',{text:this.defaultText,width:this.width,animate:this.defaultAnimCfg,style:{cursor:'pointer'},
listeners:{el:{scope:this,click:this.handleProgressBarClick}}}),parent.displayItem=this.progressBar,parent.add(parent.displayItem),Ext.apply(parent,this.parentOverrides))},handleProgressBarClick:function(e){var parent=this.parent,displayItem=parent.displayItem,box=this.progressBar.getBox();e=e.getXY()[0]-box.x;box=parent.store;parent=parent.pageSize||box.pageSize;parent=Math.ceil(box.getTotalCount()/parent);box.loadPage(Math.max(Math.ceil(e/(displayItem.width/parent)),1))},parentOverrides:{updateInfo:function(){if(this.displayItem){var count=
this.store.getCount(),pageData=this.getPageData();count=0===count?this.emptyMsg:Ext.String.format(this.displayMsg,pageData.fromRecord,pageData.toRecord,this.store.getTotalCount());this.displayItem.updateProgress(0<pageData.pageCount?pageData.currentPage/pageData.pageCount:0,count,this.animate||this.defaultAnimConfig)}}}});Ext.define('Ext.ux.RowExpander',{extend:Ext.grid.plugin.RowExpander});
Ext.define('Ext.ux.SlidingPager',{alias:'plugin.ux-slidingpager',constructor:function(config){config&&Ext.apply(this,config)},init:function(pbar){var idx=pbar.items.indexOf(pbar.child('#inputItem'));Ext.each(pbar.items.getRange(idx-2,idx+2),function(c){c.hide()});var slider=Ext.create('Ext.slider.Single',{width:114,minValue:1,maxValue:1,hideLabel:!0,tipText:function(thumb){return Ext.String.format('Page \x3cb\x3e{0}\x3c/b\x3e of \x3cb\x3e{1}\x3c/b\x3e',thumb.value,thumb.slider.maxValue)},listeners:{changecomplete:function(s,
v){pbar.store.loadPage(v)}}});pbar.insert(idx+1,slider);pbar.on({change:function(pb,data){slider.setMaxValue(data.pageCount);slider.setValue(data.currentPage)}})}});
Ext.define('Ext.ux.Spotlight',{baseCls:'x-spotlight',animate:!0,duration:250,easing:null,active:!1,constructor:function(config){Ext.apply(this,config)},createElements:function(){var baseCls=this.baseCls,body=Ext.getBody();this.right=body.createChild({cls:baseCls});this.left=body.createChild({cls:baseCls});this.top=body.createChild({cls:baseCls});this.bottom=body.createChild({cls:baseCls});this.all=Ext.create('Ext.CompositeElement',[this.right,this.left,this.top,this.bottom])},show:function(el,callback,
scope){this.el=Ext.get(el);this.right||this.createElements();this.active?this.applyBounds(!1,!1):(this.all.setDisplayed(''),this.active=!0,Ext.on('resize',this.syncSize,this),this.applyBounds(this.animate,!1))},hide:function(callback,scope){Ext.un('resize',this.syncSize,this);this.applyBounds(this.animate,!0)},syncSize:function(){this.applyBounds(!1,!1)},applyBounds:function(animate,reverse){var me=this,box=me.el.getBox(),viewWidth=Ext.Element.getViewportWidth(),viewHeight=Ext.Element.getViewportHeight();
var from={right:{x:box.right,y:viewHeight,width:viewWidth-box.right,height:0},left:{x:0,y:0,width:box.x,height:0},top:{x:viewWidth,y:0,width:0,height:box.y},bottom:{x:0,y:box.y+box.height,width:0,height:viewHeight-(box.y+box.height)+'px'}};var to={right:{x:box.right,y:box.y,width:viewWidth-box.right+'px',height:viewHeight-box.y+'px'},left:{x:0,y:0,width:box.x+'px',height:box.y+box.height+'px'},top:{x:box.x,y:0,width:viewWidth-box.x+'px',height:box.y+'px'},bottom:{x:0,y:box.y+box.height,width:box.x+
box.width+'px',height:viewHeight-(box.y+box.height)+'px'}};reverse&&(reverse=Ext.clone(from),from=to,to=reverse);animate?Ext.Array.forEach(['right','left','top','bottom'],function(side){me[side].setBox(from[side]);me[side].animate({duration:me.duration,easing:me.easing,to:to[side]})},this):Ext.Array.forEach(['right','left','top','bottom'],function(side){me[side].setBox(Ext.apply(from[side],to[side]));me[side].repaint()},this)},destroy:function(){Ext.destroy(this.right,this.left,this.top,this.bottom);
delete this.el;delete this.all;this.callParent()}});
Ext.define('Ext.ux.TabCloseMenu',{extend:Ext.plugin.Abstract,alias:'plugin.tabclosemenu',mixins:{observable:Ext.util.Observable},closeTabText:'Close Tab',showCloseOthers:!0,closeOtherTabsText:'Close Other Tabs',showCloseAll:!0,closeAllTabsText:'Close All Tabs',extraItemsHead:null,extraItemsTail:null,constructor:function(config){this.callParent([config]);this.mixins.observable.constructor.call(this,config)},init:function(tabpanel){this.tabPanel=tabpanel;this.tabBar=tabpanel.down('tabbar');this.mon(this.tabPanel,
{scope:this,afterlayout:this.onAfterLayout,single:!0})},onAfterLayout:function(){this.mon(this.tabBar.el,{scope:this,contextmenu:this.onContextMenu,delegate:'.x-tab'})},destroy:function(){Ext.destroy(this.menu);this.callParent()},onContextMenu:function(event,target){var me=this,menu=me.createMenu(),disableAll=!0,disableOthers=!0;target=me.tabBar.getChildByElement(target);target=me.tabBar.items.indexOf(target);me.item=me.tabPanel.getComponent(target);menu.child('#close').setDisabled(!me.item.closable);
if(me.showCloseAll||me.showCloseOthers)me.tabPanel.items.each(function(item){return item.closable&&(disableAll=!1,item!==me.item)?disableOthers=!1:!0}),me.showCloseAll&&menu.child('#closeAll').setDisabled(disableAll),me.showCloseOthers&&menu.child('#closeOthers').setDisabled(disableOthers);event.preventDefault();me.fireEvent('beforemenu',menu,me.item,me);menu.showAt(event.getXY())},createMenu:function(){if(!this.menu){var items=[{itemId:'close',text:this.closeTabText,scope:this,handler:this.onClose}];
(this.showCloseAll||this.showCloseOthers)&&items.push('-');this.showCloseOthers&&items.push({itemId:'closeOthers',text:this.closeOtherTabsText,scope:this,handler:this.onCloseOthers});this.showCloseAll&&items.push({itemId:'closeAll',text:this.closeAllTabsText,scope:this,handler:this.onCloseAll});this.extraItemsHead&&(items=this.extraItemsHead.concat(items));this.extraItemsTail&&(items=items.concat(this.extraItemsTail));this.menu=Ext.create('Ext.menu.Menu',{items:items,listeners:{hide:this.onHideMenu,
scope:this}})}return this.menu},onHideMenu:function(){this.fireEvent('aftermenu',this.menu,this)},onClose:function(){this.tabPanel.remove(this.item)},onCloseOthers:function(){this.doClose(!0)},onCloseAll:function(){this.doClose(!1)},doClose:function(excludeActive){var items=[];this.tabPanel.items.each(function(item){item.closable&&(excludeActive&&item===this.item||items.push(item))},this);Ext.suspendLayouts();Ext.Array.forEach(items,function(item){this.tabPanel.remove(item)},this);Ext.resumeLayouts(!0)}});
Ext.define('Ext.ux.TabReorderer',{extend:Ext.ux.BoxReorderer,alias:'plugin.tabreorderer',itemSelector:'.'+Ext.baseCSSPrefix+'tab',init:function(tabPanel){this.callParent([tabPanel.getTabBar()]);tabPanel.onAdd=Ext.Function.createSequence(tabPanel.onAdd,this.onAdd)},onBoxReady:function(){var len,i=0;this.callParent(arguments);var tabs=this.container.items.items;for(len=tabs.length;i<len;i++){var tab=tabs[i];tab.card&&(tab.reorderable=tab.card.reorderable)}},onAdd:function(card,index){card.tab.reorderable=
card.reorderable},afterBoxReflow:function(){Ext.ux.BoxReorderer.prototype.afterBoxReflow.apply(this,arguments);this.dragCmp&&(this.container.tabPanel.setActiveTab(this.dragCmp.card),this.container.tabPanel.move(this.dragCmp.card,this.curIndex))}});Ext.ns('Ext.ux');
Ext.define('Ext.ux.TabScrollerMenu',{alias:'plugin.tabscrollermenu',pageSize:10,maxText:15,menuPrefixText:'Items',constructor:function(config){Ext.apply(this,config)},init:function(tabPanel){var me=this;me.tabPanel=tabPanel;tabPanel.on({render:function(){me.tabBar=tabPanel.tabBar;me.layout=me.tabBar.layout;me.layout.overflowHandler.handleOverflow=me.showButton.bind(me);me.layout.overflowHandler.clearOverflow=Ext.Function.createSequence(me.layout.overflowHandler.clearOverflow,me.hideButton,me)},destroy:me.destroy,
scope:me,single:!0})},showButton:function(){var result=Ext.getClass(this.layout.overflowHandler).prototype.handleOverflow.apply(this.layout.overflowHandler,arguments);var button=this.menuButton;1<this.tabPanel.items.getCount()?(button||(button=this.menuButton=this.tabBar.body.createChild({cls:Ext.baseCSSPrefix+'tab-tabmenu-right'},this.tabBar.body.child('.'+Ext.baseCSSPrefix+'box-scroller-right')),button.addClsOnOver(Ext.baseCSSPrefix+'tab-tabmenu-over'),button.on('click',this.showTabsMenu,this)),
button.setVisibilityMode(Ext.dom.Element.DISPLAY),button.show(),result.reservedSpace+=button.getWidth()):this.hideButton();return result},hideButton:function(){this.menuButton&&this.menuButton.hide()},getPageSize:function(){return this.pageSize},setPageSize:function(pageSize){this.pageSize=pageSize},getMaxText:function(){return this.maxText},setMaxText:function(t){this.maxText=t},getMenuPrefixText:function(){return this.menuPrefixText},setMenuPrefixText:function(t){this.menuPrefixText=t},showTabsMenu:function(e){this.tabsMenu?
this.tabsMenu.removeAll():this.tabsMenu=new Ext.menu.Menu;this.generateTabMenuItems();e=Ext.get(e.getTarget()).getXY();e[1]+=24;this.tabsMenu.showAt(e)},generateTabMenuItems:function(){var tabPanel=this.tabPanel,curActive=tabPanel.getActiveTab();tabPanel=tabPanel.items.getRange();var pageSize=this.getPageSize(),tabsMenu=this.tabsMenu,i,x;tabsMenu.suspendLayouts();tabPanel=Ext.Array.filter(tabPanel,function(item){return item.id===curActive.id?!1:item.hidden?!!item.hiddenByLayout:!0});var totalItems=
tabPanel.length;var numSubMenus=Math.floor(totalItems/pageSize);var remainder=totalItems%pageSize;if(totalItems>pageSize){for(i=0;i<numSubMenus;i++){var curPage=(i+1)*pageSize;var menuItems=[];for(x=0;x<pageSize;x++){var item$jscomp$0=x+curPage-pageSize;item$jscomp$0=tabPanel[item$jscomp$0];menuItems.push(this.autoGenMenuItem(item$jscomp$0))}tabsMenu.add({text:this.getMenuPrefixText()+' '+(curPage-pageSize+1)+' - '+curPage,menu:menuItems})}if(0<remainder){pageSize*=numSubMenus;menuItems=[];for(i=
pageSize;i<totalItems;i++)item$jscomp$0=tabPanel[i],menuItems.push(this.autoGenMenuItem(item$jscomp$0));this.tabsMenu.add({text:this.menuPrefixText+' '+(pageSize+1)+' - '+(pageSize+menuItems.length),menu:menuItems})}}else for(i=0;i<totalItems;++i)tabsMenu.add(this.autoGenMenuItem(tabPanel[i]));tabsMenu.resumeLayouts(!0)},autoGenMenuItem:function(item){var maxText=this.getMaxText();return{text:Ext.util.Format.ellipsis(item.title,maxText),handler:this.showTabFromMenu,scope:this,disabled:item.disabled,
tabToShow:item,iconCls:item.iconCls}},showTabFromMenu:function(menuItem){this.tabPanel.setActiveTab(menuItem.tabToShow)},destroy:function(){Ext.destroy(this.tabsMenu,this.menuButton);this.callParent()}});
Ext.define('Ext.ux.ToolbarDroppable',{constructor:function(config){Ext.apply(this,config)},init:function(toolbar){this.toolbar=toolbar;this.toolbar.on({scope:this,render:this.createDropTarget})},createDropTarget:function(){this.dropTarget=Ext.create('Ext.dd.DropTarget',this.toolbar.getEl(),{notifyOver:this.notifyOver.bind(this),notifyDrop:this.notifyDrop.bind(this)})},addDDGroup:function(ddGroup){this.dropTarget.addToGroup(ddGroup)},calculateEntryIndex:function(e){var entryIndex=0,items=this.toolbar.items.items,
count=items.length;e=e.getXY()[0];for(var index=0,el;index<count;index++)if(el=items[index].getEl(),entryIndex=el.getXY()[0],el=el.getWidth(),entryIndex+=el/2,e<entryIndex){entryIndex=index;break}else entryIndex=index+1;return entryIndex},canDrop:function(data){return!0},notifyOver:function(dragSource,event,data){return this.canDrop.apply(this,arguments)?this.dropTarget.dropAllowed:this.dropTarget.dropNotAllowed},notifyDrop:function(dragSource,event,data){dragSource=this.canDrop(dragSource,event,
data);var tbar=this.toolbar;dragSource&&(event=this.calculateEntryIndex(event),tbar.insert(event,this.createItem(data)),this.afterLayout());return dragSource},createItem:function(data){Ext.raise('The createItem method must be implemented in the ToolbarDroppable plugin')},afterLayout:Ext.emptyFn});
Ext.define('Ext.ux.TreePicker',{extend:Ext.form.field.Picker,xtype:'treepicker',triggerCls:Ext.baseCSSPrefix+'form-arrow-trigger',config:{store:null,displayField:null,columns:null,selectOnTab:!0,maxPickerHeight:300,minPickerHeight:100},editable:!1,initComponent:function(){this.callParent(arguments);this.mon(this.store,{scope:this,load:this.onLoad,update:this.onUpdate})},createPicker:function(){var picker=new Ext.tree.Panel({baseCls:Ext.baseCSSPrefix+'boundlist',shrinkWrapDock:2,store:this.store,floating:!0,
displayField:this.displayField,columns:this.columns,minHeight:this.minPickerHeight,maxHeight:this.maxPickerHeight,manageHeight:!1,shadow:!1,listeners:{scope:this,itemclick:this.onItemClick,itemkeydown:this.onPickerKeyDown}}),view=picker.getView();if(Ext.isIE9&&Ext.isStrict)view.on({scope:this,highlightitem:this.repaintPickerView,unhighlightitem:this.repaintPickerView,afteritemexpand:this.repaintPickerView,afteritemcollapse:this.repaintPickerView});return picker},repaintPickerView:function(){var style=
this.picker.getView().getEl().dom.style;style.display=style.display},onItemClick:function(view,record,node,rowIndex,e){this.selectItem(record)},onPickerKeyDown:function(treeView,record,item,index,e){treeView=e.getKey();(treeView===e.ENTER||treeView===e.TAB&&this.selectOnTab)&&this.selectItem(record)},selectItem:function(record){this.setValue(record.getId());this.fireEvent('select',this,record);this.collapse()},onExpand:function(){var picker=this.picker,store=picker.store,value=this.value,node;value&&
(node=store.getNodeById(value));node||(node=store.getRoot());picker.ensureVisible(node,{select:!0,focus:!0})},setValue:function(value){this.value=value;if(this.store.loading)return this;value?this.store.getNodeById(value):this.store.getRoot();void 0===value?(value=this.store.getRoot(),this.value=value.getId()):value=this.store.getNodeById(value);this.setRawValue(value?value.get(this.displayField):'');return this},getSubmitValue:function(){return this.value},getValue:function(){return this.value},
onLoad:function(){var value=this.value;value&&this.setValue(value)},onUpdate:function(store,rec,type,modifiedFieldNames){store=this.displayField;'edit'===type&&modifiedFieldNames&&Ext.Array.contains(modifiedFieldNames,store)&&this.value===rec.getId()&&this.setRawValue(rec.get(store))}});
Ext.define('Ext.ux.colorpick.Selection',{mixinId:'colorselection',config:{format:'hex6',value:'FF0000',color:null,previousColor:null,alphaDecimalFormat:'#.##'},applyColor:function(color){var c=color;Ext.isString(c)&&(c=Ext.ux.colorpick.ColorUtils.parseColor(color,this.getAlphaDecimalFormat()));return c},applyFormat:function(format){if(Ext.ux.colorpick.ColorUtils.formats.hasOwnProperty(format))return format;Ext.raise('The specified format "'+format+'" is invalid.')},applyValue:function(color){color=
Ext.ux.colorpick.ColorUtils.parseColor(color||'#000000',this.getAlphaDecimalFormat());return this.formatColor(color)},formatColor:function(color){return Ext.ux.colorpick.ColorUtils.formats[this.getFormat()](color)},updateColor:function(color){this.syncing||(this.syncing=!0,this.setValue(this.formatColor(color)),this.syncing=!1)},updateValue:function(value,oldValue){this.syncing||(this.syncing=!0,this.setColor(value),this.syncing=!1);this.fireEvent('change',this,value,oldValue)}});
Ext.define('Ext.ux.colorpick.ColorUtils',function(ColorUtils){var oldIE=Ext.isIE&&10>Ext.ieVersion;return{singleton:!0,constructor:function(){ColorUtils=this},backgroundTpl:oldIE?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType\x3d0, startColorstr\x3d'#{alpha}{hex}', endColorstr\x3d'#{alpha}{hex}');":'background: {rgba};',setBackground:oldIE?function(el,color){if(el){var tpl=Ext.XTemplate.getTpl(ColorUtils,'backgroundTpl');color={hex:ColorUtils.rgb2hex(color.r,color.g,color.b),alpha:Math.floor(255*
color.a).toString(16)};tpl=tpl.apply(color);el.applyStyles(tpl)}}:function(el,color){if(el){var tpl=Ext.XTemplate.getTpl(ColorUtils,'backgroundTpl');color={rgba:ColorUtils.getRGBAString(color)};tpl=tpl.apply(color);el.applyStyles(tpl)}},formats:{RGB:function(colorO){return ColorUtils.getRGBString(colorO).toUpperCase()},RGBA:function(colorO){return ColorUtils.getRGBAString(colorO).toUpperCase()},HEX6:function(colorO){return ColorUtils.rgb2hex(colorO.r,colorO.g,colorO.b)},HEX8:function(colorO){var hex=
ColorUtils.rgb2hex(colorO.r,colorO.g,colorO.b);colorO=Math.round(255*colorO.a).toString(16);2>colorO.length&&(hex+='0');return hex+=colorO.toUpperCase()}},hexRe:/^#?(([0-9a-f]{8})|((?:[0-9a-f]{3}){1,2}))$/i,rgbaAltRe:/^rgba\(\s*([\w#\d]+)\s*,\s*([\d\.]+)\s*\)$/i,rgbaRe:/^rgba\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)$/i,rgbRe:/^rgb\(\s*([\d\.]+)\s*,\s*([\d\.]+)\s*,\s*([\d\.]+)\s*\)$/i,parseColor:function(color,alphaFormat){if(!color)return null;var rgb=this.colorMap[color];
if(rgb)color={r:rgb[0],g:rgb[1],b:rgb[2],a:1};else if('transparent'===color)color={r:0,g:0,b:0,a:0};else if(rgb=this.hexRe.exec(color))switch(rgb=rgb[1],rgb.length){default:return null;case 3:color={r:parseInt(rgb[0]+rgb[0],16),g:parseInt(rgb[1]+rgb[1],16),b:parseInt(rgb[2]+rgb[2],16),a:1};break;case 6:case 8:color={r:parseInt(rgb.substr(0,2),16),g:parseInt(rgb.substr(2,2),16),b:parseInt(rgb.substr(4,2),16),a:parseInt(rgb.substr(6,2)||'ff',16)/255}}else if(rgb=this.rgbaRe.exec(color))color={r:parseFloat(rgb[1]),
g:parseFloat(rgb[2]),b:parseFloat(rgb[3]),a:parseFloat(rgb[4])};else{if(rgb=this.rgbaAltRe.exec(color))return color=this.parseColor(rgb[1]),color.a=parseFloat(rgb[2]),color;if(rgb=this.rgbRe.exec(color))color={r:parseFloat(rgb[1]),g:parseFloat(rgb[2]),b:parseFloat(rgb[3]),a:1};else return null}alphaFormat&&(color.a=Ext.util.Format.number(color.a,alphaFormat));alphaFormat=this.rgb2hsv(color.r,color.g,color.b);return Ext.apply(color,alphaFormat)},isValid:function(color){return null!==ColorUtils.parseColor(color)},
getRGBAString:function(rgba){return'rgba('+rgba.r+','+rgba.g+','+rgba.b+','+rgba.a+')'},getRGBString:function(rgb){return'rgb('+rgb.r+','+rgb.g+','+rgb.b+')'},hsv2rgb:function(h,s,v){h*=360;360===h&&(h=0);var c=v*s,hprime=h/60,x=c*(1-Math.abs(hprime%2-1)),rgb=[0,0,0];switch(Math.floor(hprime)){case 0:rgb=[c,x,0];break;case 1:rgb=[x,c,0];break;case 2:rgb=[0,c,x];break;case 3:rgb=[0,x,c];break;case 4:rgb=[x,0,c];break;case 5:rgb=[c,0,x];break;default:console.error('unknown color '+h+' '+s+' '+v)}h=
v-c;rgb[0]+=h;rgb[1]+=h;rgb[2]+=h;rgb[0]=Math.round(255*rgb[0]);rgb[1]=Math.round(255*rgb[1]);rgb[2]=Math.round(255*rgb[2]);return{r:rgb[0],g:rgb[1],b:rgb[2]}},rgb2hsv:function(r,g,b){r/=255;g/=255;b/=255;var M=Math.max(r,g,b),c=M-Math.min(r,g,b),hprime=0,s=0;0!==c&&(M===r?hprime=(g-b)/c%6:M===g?hprime=(b-r)/c+2:M===b&&(hprime=(r-g)/c+4));r=60*hprime;360===r&&(r=0);0!==c&&(s=c/M);r/=360;0>r&&(r+=1);return{h:r,s:s,v:M}},rgb2hex:function(r,g,b){r=r.toString(16);g=g.toString(16);b=b.toString(16);2>r.length&&
(r='0'+r);2>g.length&&(g='0'+g);2>b.length&&(b='0'+b);return(r+g+b).toUpperCase()},colorMap:{aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,
248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,132,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,
20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,255,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,
250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,
205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,
142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,203],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,
82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[119,128,144],slategrey:[119,128,144],snow:[255,255,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,5]}}},function(ColorUtils){var formats=ColorUtils.formats,lowerized={};formats['#HEX6']=function(color){return'#'+
formats.HEX6(color)};formats['#HEX8']=function(color){return'#'+formats.HEX8(color)};Ext.Object.each(formats,function(name,fn){lowerized[name.toLowerCase()]=function(color){return fn(color).toLowerCase()}});Ext.apply(formats,lowerized)});
Ext.define('Ext.ux.colorpick.ColorMapController',{extend:Ext.app.ViewController,alias:'controller.colorpickercolormapcontroller',onFirstBoxReady:function(){var colorMap=this.getView(),dd=colorMap.down('#dragHandle').dd;dd.constrain=!0;dd.constrainTo=colorMap.getEl();dd.initialConstrainTo=dd.constrainTo;dd.on('drag',Ext.bind(this.onHandleDrag,this));this.mon(colorMap.getEl(),{mousedown:this.onMouseDown,dragstart:this.onDragStart,scope:this})},onHandleDrag:function(componentDragger,e){componentDragger=
this.getView();var dragHandle=componentDragger.down('#dragHandle');e=dragHandle.getX()-componentDragger.getX();dragHandle=dragHandle.getY()-componentDragger.getY();var containerEl=componentDragger.getEl(),containerWidth=containerEl.getWidth();containerEl=containerEl.getHeight();e/=containerWidth;dragHandle/=containerEl;.99<e&&(e=1);.99<dragHandle&&(dragHandle=1);componentDragger.fireEvent('handledrag',e,dragHandle)},onMouseDown:function(e){var dragHandle=this.getView().down('#dragHandle');dragHandle.setY(e.getY());
dragHandle.setX(e.getX());this.onHandleDrag();dragHandle.dd.onMouseDown(e,dragHandle.dd.el)},onDragStart:function(e){var dragHandle=this.getView().down('#dragHandle');dragHandle.dd.onDragStart(e,dragHandle.dd.el)},onMapClick:function(e){var container=this.getView(),dragHandle=container.down('#dragHandle');container=container.getXY();var eXY=e.getXY();e=eXY[0]-container[0];container=eXY[1]-container[1];dragHandle.getEl().setStyle({left:e+'px',top:container+'px'});this.onHandleDrag()},onColorBindingChanged:function(selectedColor){var rgba=
this.getViewModel().get('selectedColor'),container=this.getView();selectedColor=container.down('#dragHandle');var containerEl=container.getEl();container=containerEl.getWidth();containerEl=containerEl.getHeight();rgba=Ext.ux.colorpick.ColorUtils.rgb2hsv(rgba.r,rgba.g,rgba.b);container*=rgba.s;rgba=containerEl*(1-rgba.v);selectedColor.getEl().setStyle({left:container+'px',top:rgba+'px'})},onHueBindingChanged:function(hue){hue=Ext.ux.colorpick.ColorUtils.hsv2rgb(hue,1,1);hue=Ext.ux.colorpick.ColorUtils.rgb2hex(hue.r,
hue.g,hue.b);this.getView().getEl().applyStyles({'background-color':'#'+hue})}});
Ext.define('Ext.ux.colorpick.ColorMap',{extend:Ext.container.Container,alias:'widget.colorpickercolormap',controller:'colorpickercolormapcontroller',cls:Ext.baseCSSPrefix+'colorpicker-colormap',items:[{xtype:'component',cls:Ext.baseCSSPrefix+'colorpicker-colormap-draghandle-container',itemId:'dragHandle',width:1,height:1,draggable:!0,html:'\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'colorpicker-colormap-draghandle"\x3e\x3c/div\x3e'}],listeners:{boxready:{single:!0,fn:'onFirstBoxReady',scope:'controller'},
colorbindingchanged:{fn:'onColorBindingChanged',scope:'controller'},huebindingchanged:{fn:'onHueBindingChanged',scope:'controller'}},afterRender:function(){var src=this.mapGradientUrl,el=this.el;this.callParent();src||(src=el.getStyle('background-image'),src=src.substring(4,src.length-1),0===src.indexOf('"')&&(src=src.substring(1,src.length-1)),Ext.ux.colorpick.ColorMap.prototype.mapGradientUrl=src);el.setStyle('background-image','none');el=this.layout.getElementTarget();el.createChild({tag:'img',
cls:Ext.baseCSSPrefix+'colorpicker-colormap-blender',src:src})},setPosition:function(data){var dragHandle=this.down('#dragHandle');dragHandle.dd&&dragHandle.dd.constrain&&('undefined'===typeof dragHandle.dd.dragEnded||dragHandle.dd.dragEnded)&&this.fireEvent('colorbindingchanged',data)},setHue:function(hue){this.getEl()&&this.fireEvent('huebindingchanged',hue)}});
Ext.define('Ext.ux.colorpick.SelectorModel',{extend:Ext.app.ViewModel,alias:'viewmodel.colorpick-selectormodel',data:{selectedColor:{r:255,g:255,b:255,h:0,s:1,v:1,a:1},previousColor:{r:0,g:0,b:0,h:0,s:1,v:1,a:1}},formulas:{hex:{get:function(get){var r=get('selectedColor.r').toString(16),g=get('selectedColor.g').toString(16);get=get('selectedColor.b').toString(16);return'#'+Ext.ux.colorpick.ColorUtils.rgb2hex(r,g,get)},set:function(hex){hex=Ext.ux.colorpick.ColorUtils.parseColor(hex);this.changeRGB(hex)}},
red:{get:function(get){return get('selectedColor.r')},set:function(r){this.changeRGB({r:r})}},green:{get:function(get){return get('selectedColor.g')},set:function(g){this.changeRGB({g:g})}},blue:{get:function(get){return get('selectedColor.b')},set:function(b){this.changeRGB({b:b})}},hue:{get:function(get){return 360*get('selectedColor.h')},set:function(hue){this.changeHSV({h:hue/360})}},saturation:{get:function(get){return 100*get('selectedColor.s')},set:function(saturation){this.changeHSV({s:saturation/
100})}},value:{get:function(get){return 100*get('selectedColor.v')},set:function(value){this.changeHSV({v:value/100})}},alpha:{get:function(data){return 100*data('selectedColor.a')},set:function(alpha){this.set('selectedColor',Ext.applyIf({a:alpha/100},this.data.selectedColor))}}},changeHSV:function(hsv){Ext.applyIf(hsv,this.data.selectedColor);var rgb=Ext.ux.colorpick.ColorUtils.hsv2rgb(hsv.h,hsv.s,hsv.v);hsv.r=rgb.r;hsv.g=rgb.g;hsv.b=rgb.b;this.set('selectedColor',hsv)},changeRGB:function(rgb){Ext.applyIf(rgb,
this.data.selectedColor);var hsv=Ext.ux.colorpick.ColorUtils.rgb2hsv(rgb.r,rgb.g,rgb.b);rgb.h=hsv.h;rgb.s=hsv.s;rgb.v=hsv.v;this.set('selectedColor',rgb)}});
Ext.define('Ext.ux.colorpick.SelectorController',{extend:Ext.app.ViewController,alias:'controller.colorpick-selectorcontroller',destroy:function(){var view=this.getView(),childViewModel=view.childViewModel;childViewModel&&(childViewModel.destroy(),view.childViewModel=null);this.callParent()},changeHSV:function(hsv){var view=this.getView(),color=view.getColor();Ext.applyIf(hsv,color);color=Ext.ux.colorpick.ColorUtils.hsv2rgb(hsv.h,hsv.s,hsv.v);Ext.apply(hsv,color);view.setColor(hsv)},onColorMapHandleDrag:function(xPercent,
yPercent){this.changeHSV({s:xPercent,v:1-yPercent})},onValueSliderHandleDrag:function(yPercent){this.changeHSV({v:1-yPercent})},onSaturationSliderHandleDrag:function(yPercent){this.changeHSV({s:1-yPercent})},onHueSliderHandleDrag:function(yPercent){this.changeHSV({h:1-yPercent})},onAlphaSliderHandleDrag:function(yPercent){var view=this.getView(),color=view.getColor();yPercent=Ext.applyIf({a:1-yPercent},color);view.setColor(yPercent);view.el.repaint()},onPreviousColorSelected:function(comp,color){this.getView().setColor(color)},
onOK:function(){var view=this.getView();view.fireEvent('ok',view,view.getValue())},onCancel:function(){this.fireViewEvent('cancel',this.getView())},onResize:function(){var vm=this.getView().childViewModel,refs=this.getReferences();if(this.hasResizedOnce){var h=vm.get('hue');var s=vm.get('saturation');var v=vm.get('value');var a=vm.get('alpha');refs.colorMap.setPosition(vm.getData());refs.hueSlider.setHue(h);refs.satSlider.setSaturation(s);refs.valueSlider.setValue(v);refs.alphaSlider.setAlpha(a)}else this.hasResizedOnce=
!0}});
Ext.define('Ext.ux.colorpick.ColorPreview',{extend:Ext.Component,alias:'widget.colorpickercolorpreview',style:'position: relative',html:'\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'colorpreview-filter" style\x3d"height:100%; width:100%; position: absolute;"\x3e\x3c/div\x3e\x3ca class\x3d"btn" style\x3d"height:100%; width:100%; position: absolute;"\x3e\x3c/a\x3e',cls:Ext.baseCSSPrefix+'colorpreview',height:256,onRender:function(){this.callParent(arguments);this.mon(this.el.down('.btn'),'click',this.onClick,this)},
onClick:function(){this.fireEvent('click',this,this.color)},setColor:function(color){this.getEl()&&(this.color=color,this.applyBgStyle(color))},bgStyleTpl:Ext.create('Ext.XTemplate',Ext.isIE&&10>Ext.ieVersion?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType\x3d0, startColorstr\x3d'#{hexAlpha}{hex}', endColorstr\x3d'#{hexAlpha}{hex}');":'background: {rgba};'),applyBgStyle:function(color){var colorUtils=Ext.ux.colorpick.ColorUtils,filterSelector='.'+Ext.baseCSSPrefix+'colorpreview-filter';
filterSelector=this.getEl().down(filterSelector);var hex=colorUtils.rgb2hex(color.r,color.g,color.b);var alpha=Ext.util.Format.hex(Math.floor(255*color.a),2);color=colorUtils.getRGBAString(color);color=this.bgStyleTpl.apply({hex:hex,hexAlpha:alpha,rgba:color});filterSelector.applyStyles(color)}});
Ext.define('Ext.ux.colorpick.SliderController',{extend:Ext.app.ViewController,alias:'controller.colorpick-slidercontroller',boxReady:function(view){view=this.getDragContainer();var dd=this.getDragHandle().dd;dd.constrain=!0;dd.constrainTo=view.getEl();dd.initialConstrainTo=dd.constrainTo;dd.on('drag',this.onHandleDrag,this)},getDragHandle:function(){return this.view.lookupReference('dragHandle')},getDragContainer:function(){return this.view.lookupReference('dragHandleContainer')},onHandleDrag:function(e){e=
this.getView();var container=this.getDragContainer(),y=this.getDragHandle().getY()-container.getY();container=container.getEl().getHeight();y/=container;.99<y&&(y=1);e.fireEvent('handledrag',y)},onMouseDown:function(e){var dragHandle=this.getDragHandle(),y=e.getY();dragHandle.setY(y);this.onHandleDrag();dragHandle.el.repaint();dragHandle.dd.onMouseDown(e,dragHandle.dd.el)},onDragStart:function(e){var dragHandle=this.getDragHandle();dragHandle.dd.onDragStart(e,dragHandle.dd.el)},onMouseUp:function(){this.getDragHandle().dd.dragEnded=
!0}});
Ext.define('Ext.ux.colorpick.Slider',{extend:Ext.container.Container,xtype:'colorpickerslider',controller:'colorpick-slidercontroller',afterRender:function(){this.callParent(arguments);var width=this.width;var dragCt=this.lookupReference('dragHandleContainer');var dragWidth=dragCt.getWidth();dragCt.el.setStyle('left',(width-dragWidth)/2+'px')},baseCls:Ext.baseCSSPrefix+'colorpicker-slider',referenceHolder:!0,listeners:{element:'el',mousedown:'onMouseDown',mouseup:'onMouseUp',dragstart:'onDragStart'},items:{xtype:'container',
cls:Ext.baseCSSPrefix+'colorpicker-draghandle-container',reference:'dragHandleContainer',height:'100%',items:{xtype:'component',cls:Ext.baseCSSPrefix+'colorpicker-draghandle-outer',reference:'dragHandle',width:'100%',height:1,draggable:!0,html:'\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'colorpicker-draghandle"\x3e\x3c/div\x3e'}},setHue:function(){Ext.raise('Must implement setHue() in a child class!')},getDragHandle:function(){return this.lookupReference('dragHandle')},getDragContainer:function(){return this.lookupReference('dragHandleContainer')}});
Ext.define('Ext.ux.colorpick.SliderAlpha',{extend:Ext.ux.colorpick.Slider,alias:'widget.colorpickerslideralpha',cls:Ext.baseCSSPrefix+'colorpicker-alpha',gradientStyleTpl:Ext.create('Ext.XTemplate',Ext.isIE&&10>Ext.ieVersion?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType\x3d0, startColorstr\x3d'#FF{hex}', endColorstr\x3d'#00{hex}');":'background: -moz-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -webkit-linear-gradient(top,rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -o-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: -ms-linear-gradient(top, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);background: linear-gradient(to bottom, rgba({r}, {g}, {b}, 1) 0%, rgba({r}, {g}, {b}, 0) 100%);'),
setAlpha:function(value){var container=this.getDragContainer(),dragHandle=this.getDragHandle();container=container.getEl().getHeight();dragHandle.dd&&dragHandle.dd.constrain&&('undefined'===typeof dragHandle.dd.dragEnded||dragHandle.dd.dragEnded)&&(value=container*(1-value/100),dragHandle.getEl().setStyle({top:value+'px'}))},setColor:function(color){var container=this.getDragContainer();if(this.getEl()){var hex=Ext.ux.colorpick.ColorUtils.rgb2hex(color.r,color.g,color.b);container.getEl().first().applyStyles(this.gradientStyleTpl.apply({hex:hex,
r:color.r,g:color.g,b:color.b}))}}});
Ext.define('Ext.ux.colorpick.SliderSaturation',{extend:Ext.ux.colorpick.Slider,alias:'widget.colorpickerslidersaturation',cls:Ext.baseCSSPrefix+'colorpicker-saturation',gradientStyleTpl:Ext.create('Ext.XTemplate',Ext.isIE&&10>Ext.ieVersion?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType\x3d0, startColorstr\x3d'#{hex}', endColorstr\x3d'#ffffff');":'background: -mox-linear-gradient(top, #{hex} 0%, #ffffff 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -o-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: -ms-linear-gradient(top, #{hex} 0%,#ffffff 100%);background: linear-gradient(to bottom, #{hex} 0%,#ffffff 100%);'),setSaturation:function(saturation){var container=
this.getDragContainer(),dragHandle=this.getDragHandle();container=container.getEl().getHeight();dragHandle.dd&&dragHandle.dd.constrain&&('undefined'===typeof dragHandle.dd.dragEnded||dragHandle.dd.dragEnded)&&(saturation=container*(1-saturation/100),dragHandle.getEl().setStyle({top:saturation+'px'}))},setHue:function(hue){var container=this.getDragContainer();this.getEl()&&(hue=Ext.ux.colorpick.ColorUtils.hsv2rgb(hue,1,1),hue=Ext.ux.colorpick.ColorUtils.rgb2hex(hue.r,hue.g,hue.b),container.getEl().applyStyles(this.gradientStyleTpl.apply({hex:hue})))}});
Ext.define('Ext.ux.colorpick.SliderValue',{extend:Ext.ux.colorpick.Slider,alias:'widget.colorpickerslidervalue',cls:Ext.baseCSSPrefix+'colorpicker-value',gradientStyleTpl:Ext.create('Ext.XTemplate',Ext.isIE&&10>Ext.ieVersion?"filter: progid:DXImageTransform.Microsoft.gradient(GradientType\x3d0, startColorstr\x3d'#{hex}', endColorstr\x3d'#000000');":'background: -mox-linear-gradient(top, #{hex} 0%, #000000 100%);background: -webkit-linear-gradient(top, #{hex} 0%,#000000 100%);background: -o-linear-gradient(top, #{hex} 0%,#000000 100%);background: -ms-linear-gradient(top, #{hex} 0%,#000000 100%);background: linear-gradient(to bottom, #{hex} 0%,#000000 100%);'),
setValue:function(value){var container=this.getDragContainer(),dragHandle=this.getDragHandle();container=container.getEl().getHeight();dragHandle.dd&&dragHandle.dd.constrain&&('undefined'===typeof dragHandle.dd.dragEnded||dragHandle.dd.dragEnded)&&(value=container*(1-value/100),dragHandle.getEl().setStyle({top:value+'px'}))},setHue:function(hue){var container=this.getDragContainer();this.getEl()&&(hue=Ext.ux.colorpick.ColorUtils.hsv2rgb(hue,1,1),hue=Ext.ux.colorpick.ColorUtils.rgb2hex(hue.r,hue.g,
hue.b),container.getEl().applyStyles(this.gradientStyleTpl.apply({hex:hue})))}});
Ext.define('Ext.ux.colorpick.SliderHue',{extend:Ext.ux.colorpick.Slider,alias:'widget.colorpickersliderhue',cls:Ext.baseCSSPrefix+'colorpicker-hue',afterRender:function(){var src=this.gradientUrl,el=this.el;this.callParent();src||(src=el.getStyle('background-image'),src=src.substring(4,src.length-1),0===src.indexOf('"')&&(src=src.substring(1,src.length-1)),Ext.ux.colorpick.SliderHue.prototype.gradientUrl=src);el.setStyle('background-image','none');el=this.getDragContainer().layout.getElementTarget();
el.createChild({tag:'img',cls:Ext.baseCSSPrefix+'colorpicker-hue-gradient',src:src})},setHue:function(hue){var container=this.getDragContainer(),dragHandle=this.getDragHandle();container=container.getEl().getHeight();dragHandle.dd&&dragHandle.dd.constrain&&('undefined'===typeof dragHandle.dd.dragEnded||dragHandle.dd.dragEnded)&&(hue=container*(1-hue),dragHandle.getEl().setStyle({top:hue+'px'}))}});
Ext.define('Ext.ux.colorpick.Selector',{extend:Ext.container.Container,xtype:'colorselector',mixins:[Ext.ux.colorpick.Selection],controller:'colorpick-selectorcontroller',config:{hexReadOnly:!0},width:580,height:337,cls:Ext.baseCSSPrefix+'colorpicker',padding:10,layout:{type:'hbox',align:'stretch'},defaultBindProperty:'value',twoWayBindable:['value'],fieldWidth:50,fieldPad:5,showPreviousColor:!1,showOkCancelButtons:!1,listeners:{resize:'onResize'},constructor:function(config){var me=this,childViewModel=
Ext.Factory.viewModel('colorpick-selectormodel');me.childViewModel=childViewModel;me.items=[me.getMapAndHexRGBFields(childViewModel),me.getSliderAndHField(childViewModel),me.getSliderAndSField(childViewModel),me.getSliderAndVField(childViewModel),me.getSliderAndAField(childViewModel),me.getPreviewAndButtons(childViewModel,config)];me.childViewModel.bind('{selectedColor}',function(color){me.setColor(color)});me.callParent([config])},updateColor:function(color){this.mixins.colorselection.updateColor.call(this,
color);this.childViewModel.set('selectedColor',color)},updatePreviousColor:function(color){this.childViewModel.set('previousColor',color)},getMapAndHexRGBFields:function(childViewModel){var fieldMargin={top:0,right:this.fieldPad,bottom:0,left:0},fieldWidth=this.fieldWidth;return{xtype:'container',viewModel:childViewModel,cls:Ext.baseCSSPrefix+'colorpicker-escape-overflow',flex:1,layout:{type:'vbox',align:'stretch'},margin:'0 10 0 0',items:[{xtype:'colorpickercolormap',reference:'colorMap',flex:1,
bind:{position:{bindTo:'{selectedColor}',deep:!0},hue:'{selectedColor.h}'},listeners:{handledrag:'onColorMapHandleDrag'}},{xtype:'container',layout:'hbox',defaults:{labelAlign:'top',labelSeparator:'',allowBlank:!1,onChange:function(){this.isValid()&&Ext.form.field.Base.prototype.onChange.apply(this,arguments)}},items:[{xtype:'textfield',fieldLabel:'HEX',flex:1,bind:'{hex}',margin:fieldMargin,regex:/^#[0-9a-f]{6}$/i,readonly:this.getHexReadOnly()},{xtype:'numberfield',fieldLabel:'R',bind:'{red}',width:fieldWidth,
hideTrigger:!0,maxValue:255,minValue:0,margin:fieldMargin},{xtype:'numberfield',fieldLabel:'G',bind:'{green}',width:fieldWidth,hideTrigger:!0,maxValue:255,minValue:0,margin:fieldMargin},{xtype:'numberfield',fieldLabel:'B',bind:'{blue}',width:fieldWidth,hideTrigger:!0,maxValue:255,minValue:0,margin:0}]}]}},getSliderAndHField:function(childViewModel){var fieldWidth=this.fieldWidth;return{xtype:'container',viewModel:childViewModel,cls:Ext.baseCSSPrefix+'colorpicker-escape-overflow',width:fieldWidth,
layout:{type:'vbox',align:'stretch'},items:[{xtype:'colorpickersliderhue',reference:'hueSlider',flex:1,bind:{hue:'{selectedColor.h}'},width:fieldWidth,listeners:{handledrag:'onHueSliderHandleDrag'}},{xtype:'numberfield',fieldLabel:'H',labelAlign:'top',labelSeparator:'',bind:'{hue}',hideTrigger:!0,maxValue:360,minValue:0,allowBlank:!1,margin:0}]}},getSliderAndSField:function(childViewModel){var fieldWidth=this.fieldWidth;return{xtype:'container',viewModel:childViewModel,cls:Ext.baseCSSPrefix+'colorpicker-escape-overflow',
width:fieldWidth,layout:{type:'vbox',align:'stretch'},margin:{right:this.fieldPad,left:this.fieldPad},items:[{xtype:'colorpickerslidersaturation',reference:'satSlider',flex:1,bind:{saturation:'{saturation}',hue:'{selectedColor.h}'},width:fieldWidth,listeners:{handledrag:'onSaturationSliderHandleDrag'}},{xtype:'numberfield',fieldLabel:'S',labelAlign:'top',labelSeparator:'',bind:'{saturation}',hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},getSliderAndVField:function(childViewModel){var fieldWidth=
this.fieldWidth;return{xtype:'container',viewModel:childViewModel,cls:Ext.baseCSSPrefix+'colorpicker-escape-overflow',width:fieldWidth,layout:{type:'vbox',align:'stretch'},items:[{xtype:'colorpickerslidervalue',reference:'valueSlider',flex:1,bind:{value:'{value}',hue:'{selectedColor.h}'},width:fieldWidth,listeners:{handledrag:'onValueSliderHandleDrag'}},{xtype:'numberfield',fieldLabel:'V',labelAlign:'top',labelSeparator:'',bind:'{value}',hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},
getSliderAndAField:function(childViewModel){var fieldWidth=this.fieldWidth;return{xtype:'container',viewModel:childViewModel,cls:Ext.baseCSSPrefix+'colorpicker-escape-overflow',width:fieldWidth,layout:{type:'vbox',align:'stretch'},margin:{left:this.fieldPad},items:[{xtype:'colorpickerslideralpha',reference:'alphaSlider',flex:1,bind:{alpha:'{alpha}',color:{bindTo:'{selectedColor}',deep:!0}},width:fieldWidth,listeners:{handledrag:'onAlphaSliderHandleDrag'}},{xtype:'numberfield',fieldLabel:'A',labelAlign:'top',
labelSeparator:'',bind:'{alpha}',hideTrigger:!0,maxValue:100,minValue:0,allowBlank:!1,margin:0}]}},getPreviewAndButtons:function(childViewModel,config){var items=[{xtype:'colorpickercolorpreview',flex:1,bind:{color:{bindTo:'{selectedColor}',deep:!0}}}];config.showPreviousColor&&items.push({xtype:'colorpickercolorpreview',flex:1,bind:{color:{bindTo:'{previousColor}',deep:!0}},listeners:{click:'onPreviousColorSelected'}});config.showOkCancelButtons&&items.push({xtype:'button',text:'OK',margin:'10 0 0 0',
padding:'10 0 10 0',handler:'onOK'},{xtype:'button',text:'Cancel',margin:'10 0 0 0',padding:'10 0 10 0',handler:'onCancel'});return{xtype:'container',viewModel:childViewModel,width:70,margin:'0 0 0 10',items:items,layout:{type:'vbox',align:'stretch'}}}});
Ext.define('Ext.ux.colorpick.ButtonController',{extend:Ext.app.ViewController,alias:'controller.colorpick-buttoncontroller',afterRender:function(view){view.updateColor(view.getColor())},destroy:function(){var view=this.getView(),colorPickerWindow=view.colorPickerWindow;colorPickerWindow&&(colorPickerWindow.destroy(),view.colorPickerWindow=view.colorPicker=null);this.callParent()},getPopup:function(){var view=this.getView(),popup=view.colorPickerWindow,selector;popup||(popup=Ext.create(view.getPopup()),
view.colorPickerWindow=popup,popup.colorPicker=view.colorPicker=selector=popup.lookupReference('selector'),selector.setFormat(view.getFormat()),selector.on({ok:'onColorPickerOK',cancel:'onColorPickerCancel',scope:this}),popup.on({close:'onColorPickerCancel',scope:this}));return popup},onClick:function(){var view=this.getView(),color=view.getColor(),popup=this.getPopup(),colorPicker=popup.colorPicker;colorPicker.setColor(color);colorPicker.setPreviousColor(color);popup.showBy(view,'tl-br?')},onColorPickerOK:function(picker){var view=
this.getView();picker=picker.getColor();view.colorPickerWindow.hide();view.setColor(picker)},onColorPickerCancel:function(){this.getView().colorPickerWindow.hide()},syncColor:function(color){var view=this.getView();Ext.ux.colorpick.ColorUtils.setBackground(view.filterEl,color)}});
Ext.define('Ext.ux.colorpick.Button',{extend:Ext.Component,xtype:'colorbutton',controller:'colorpick-buttoncontroller',mixins:[Ext.ux.colorpick.Selection],baseCls:Ext.baseCSSPrefix+'colorpicker-button',width:20,height:20,childEls:['btnEl','filterEl'],config:{popup:{lazy:!0,$value:{xtype:'window',closeAction:'hide',referenceHolder:!0,minWidth:540,minHeight:200,layout:'fit',header:!1,resizable:!0,items:{xtype:'colorselector',reference:'selector',showPreviousColor:!0,showOkCancelButtons:!0}}}},defaultBindProperty:'value',
twoWayBindable:'value',renderTpl:'\x3cdiv id\x3d"{id}-filterEl" data-ref\x3d"filterEl" style\x3d"height:100%; width:100%; position: absolute;"\x3e\x3c/div\x3e\x3ca id\x3d"{id}-btnEl" data-ref\x3d"btnEl" style\x3d"height:100%; width:100%; position: absolute;"\x3e\x3c/a\x3e',listeners:{click:'onClick',element:'btnEl'},updateColor:function(color){var cp=this.colorPicker;this.mixins.colorselection.updateColor.call(this,color);Ext.ux.colorpick.ColorUtils.setBackground(this.filterEl,color);cp&&cp.setColor(color)},
updateFormat:function(format){var cp=this.colorPicker;cp&&cp.setFormat(format)}});
Ext.define('Ext.ux.colorpick.Field',{extend:Ext.form.field.Picker,xtype:'colorfield',mixins:[Ext.ux.colorpick.Selection],editable:!1,matchFieldWidth:!1,beforeBodyEl:['\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'colorpicker-field-swatch"\x3e\x3cdiv id\x3d"{id}-swatchEl" data-ref\x3d"swatchEl" class\x3d"'+Ext.baseCSSPrefix+'colorpicker-field-swatch-inner"\x3e\x3c/div\x3e\x3c/div\x3e'],cls:Ext.baseCSSPrefix+'colorpicker-field',childEls:['swatchEl'],checkChangeEvents:['change'],config:{popup:{lazy:!0,$value:{xtype:'window',
closeAction:'hide',referenceHolder:!0,minWidth:540,minHeight:200,layout:'fit',header:!1,resizable:!0,items:{xtype:'colorselector',reference:'selector',showPreviousColor:!0,showOkCancelButtons:!0}}}},initComponent:function(){this.callParent();this.on('change',this.onHexChange)},afterRender:function(){this.callParent();this.updateValue(this.value)},createPicker:function(){var popup=this.getPopup(),picker;this.colorPickerWindow=popup=Ext.create(popup);this.colorPicker=picker=popup.lookupReference('selector');
picker.setFormat(this.getFormat());picker.setColor(this.getColor());picker.setHexReadOnly(!this.editable);picker.on({ok:'onColorPickerOK',cancel:'onColorPickerCancel',scope:this});popup.on({close:'onColorPickerCancel',scope:this});return this.colorPickerWindow},onColorPickerOK:function(colorPicker){this.setColor(colorPicker.getColor());this.collapse()},onColorPickerCancel:function(){this.collapse()},onExpand:function(){var color=this.getColor();this.colorPicker.setPreviousColor(color)},onHexChange:function(field){field.validate()&&
this.setValue(field.getValue())},setValue:function(color){Ext.ux.colorpick.ColorUtils.isValid(color)&&(color=this.applyValue(color),this.callParent([color]),this.updateValue(color))},updateFormat:function(format){var cp=this.colorPicker;cp&&cp.setFormat(format)},updateValue:function(color){this.syncing||(this.syncing=!0,this.setColor(color),this.syncing=!1);if(color=this.getColor())Ext.ux.colorpick.ColorUtils.setBackground(this.swatchEl,color),this.colorPicker&&this.colorPicker.setColor(color)},validator:function(val){return Ext.ux.colorpick.ColorUtils.isValid(val)?
!0:this.invalidText}});
Ext.define('Ext.ux.data.PagingMemoryProxy',{extend:Ext.data.proxy.Memory,alias:'proxy.pagingmemory',alternateClassName:'Ext.data.PagingMemoryProxy',constructor:function(){Ext.log.warn('Ext.ux.data.PagingMemoryProxy functionality has been merged into Ext.data.proxy.Memory by using the enablePaging flag.');this.callParent(arguments)},read:function(operation,callback,scope){var result$jscomp$0=this.getReader().read(this.data);scope=scope||this;var filters=operation.filters;if(0<filters.length){var records=
[];Ext.each(result$jscomp$0.records,function(record){var isMatch=!0,length=filters.length,i;for(i=0;i<length;i++){var filter=filters[i];var fn=filter.filterFn;filter=filter.scope;isMatch=isMatch&&fn.call(filter,record)}isMatch&&records.push(record)},this);result$jscomp$0.records=records;result$jscomp$0.totalRecords=result$jscomp$0.total=records.length}var sorters=operation.sorters;if(0<sorters.length){var sorterFn=function(r1,r2){var result=sorters[0].sort(r1,r2),length=sorters.length,i;for(i=1;i<
length;i++)result=result||sorters[i].sort.call(this,r1,r2);return result};result$jscomp$0.records.sort(sorterFn)}void 0!==operation.start&&void 0!==operation.limit&&(result$jscomp$0.records=result$jscomp$0.records.slice(operation.start,operation.start+operation.limit),result$jscomp$0.count=result$jscomp$0.records.length);Ext.apply(operation,{resultSet:result$jscomp$0});operation.setCompleted();operation.setSuccessful();Ext.defer(function(){Ext.callback(callback,scope,[operation])},10)}});
Ext.define('Ext.ux.dd.CellFieldDropZone',{extend:Ext.dd.DropZone,alias:'plugin.ux-cellfielddropzone',containerScroll:!0,onCellDrop:Ext.emptyFn,constructor:function(cfg){if(cfg){var ddGroup=cfg.ddGroup;if(cfg=cfg.onCellDrop)'string'===typeof cfg?(this.onCellDropFn=cfg,this.onCellDrop=this.callCellDrop):this.onCellDrop=cfg;ddGroup&&(this.ddGroup=ddGroup)}},init:function(grid){var me=this;if(grid.rendered)me.grid=grid,grid.getView().on({render:function(v){me.view=v;Ext.ux.dd.CellFieldDropZone.superclass.constructor.call(me,
me.view.el)},single:!0});else grid.on('render',me.init,me,{single:!0})},getTargetFromEvent:function(e){var v=this.view;if(e=e.getTarget(v.getCellSelector())){var row=v.findItemByChild(e),columnIndex=e.cellIndex;if(row&&Ext.isDefined(columnIndex))return{node:e,record:v.getRecord(row),fieldName:this.grid.getVisibleColumnManager().getColumns()[columnIndex].dataIndex}}},onNodeEnter:function(target,dd,e,dragData){delete this.dropOK;if(target&&(dd=dragData.field)){e=target.record.fieldsMap[target.fieldName];
if(e.isNumeric){if(!dd.isXType('numberfield'))return}else if(e.isDateField){if(!dd.isXType('datefield'))return}else if(e.isBooleanField&&!dd.isXType('checkbox'))return;this.dropOK=!0;Ext.fly(target.node).addCls('x-drop-target-active')}},onNodeOver:function(target,dd,e,dragData){return this.dropOK?this.dropAllowed:this.dropNotAllowed},onNodeOut:function(target,dd,e,dragData){Ext.fly(target.node).removeCls('x-drop-target-active')},onNodeDrop:function(target,dd,e,dragData){if(this.dropOK)return dd=dragData.field.getValue(),
target.record.set(target.fieldName,dd),this.onCellDrop(target.fieldName,dd),!0},callCellDrop:function(fieldName,value){Ext.callback(this.onCellDropFn,null,[fieldName,value],0,this.grid)}});
Ext.define('Ext.ux.dd.PanelFieldDragZone',{extend:Ext.dd.DragZone,alias:'plugin.ux-panelfielddragzone',scroll:!1,constructor:function(cfg){cfg&&cfg.ddGroup&&(this.ddGroup=cfg.ddGroup)},init:function(panel){if(panel.nodeType)Ext.ux.dd.PanelFieldDragZone.superclass.init.apply(this,arguments);else if(panel.rendered){var el=panel.getEl();el.unselectable();Ext.ux.dd.PanelFieldDragZone.superclass.constructor.call(this,el)}else panel.on('afterrender',this.init,this,{single:!0})},getDragData:function(e){var targetLabel=
e.getTarget('label',null,!0);if(targetLabel){targetLabel=Ext.getCmp(targetLabel.up('.'+Ext.form.Labelable.prototype.formItemCls).id);var oldMark=targetLabel.preventMark;targetLabel.preventMark=!0;if(targetLabel.isValid())return targetLabel.preventMark=oldMark,oldMark=document.createElement('div'),oldMark.className=Ext.baseCSSPrefix+'form-text',e=targetLabel.getRawValue(),oldMark.innerHTML=Ext.isEmpty(e)?'\x26#160;':e,Ext.fly(oldMark).setWidth(targetLabel.getEl().getWidth()),{field:targetLabel,ddel:oldMark};
e.stopEvent();targetLabel.preventMark=oldMark}},getRepairXY:function(){return this.dragData.field.getEl().getXY()}});
Ext.define('Ext.ux.desktop.Desktop',{extend:Ext.panel.Panel,alias:'widget.desktop',activeWindowCls:'ux-desktop-active-win',inactiveWindowCls:'ux-desktop-inactive-win',lastActiveWindow:null,border:!1,html:'\x26#160;',layout:'fit',xTickSize:1,yTickSize:1,app:null,shortcuts:null,shortcutItemSelector:'div.ux-desktop-shortcut',shortcutTpl:['\x3ctpl for\x3d"."\x3e','\x3cdiv class\x3d"ux-desktop-shortcut" id\x3d"{name}-shortcut"\x3e','\x3cdiv class\x3d"ux-desktop-shortcut-icon {iconCls}"\x3e','\x3cimg src\x3d"',
Ext.BLANK_IMAGE_URL,'" title\x3d"{name}"\x3e','\x3c/div\x3e','\x3cspan class\x3d"ux-desktop-shortcut-text"\x3e{name}\x3c/span\x3e','\x3c/div\x3e','\x3c/tpl\x3e','\x3cdiv class\x3d"x-clear"\x3e\x3c/div\x3e'],taskbarConfig:null,windowMenu:null,initComponent:function(){this.windowMenu=new Ext.menu.Menu(this.createWindowMenu());this.bbar=this.taskbar=new Ext.ux.desktop.TaskBar(this.taskbarConfig);this.taskbar.windowMenu=this.windowMenu;this.windows=new Ext.util.MixedCollection;this.contextMenu=new Ext.menu.Menu(this.createDesktopMenu());
this.items=[{xtype:'wallpaper',id:this.id+'_wallpaper'},this.createDataView()];this.callParent();this.shortcutsView=this.items.getAt(1);this.shortcutsView.on('itemclick',this.onShortcutItemClick,this);var wallpaper=this.wallpaper;this.wallpaper=this.items.getAt(0);wallpaper&&this.setWallpaper(wallpaper,this.wallpaperStretch)},afterRender:function(){this.callParent();this.el.on('contextmenu',this.onDesktopMenu,this)},createDataView:function(){return{xtype:'dataview',overItemCls:'x-view-over',trackOver:!0,
itemSelector:this.shortcutItemSelector,store:this.shortcuts,style:{position:'absolute'},x:0,y:0,tpl:new Ext.XTemplate(this.shortcutTpl)}},createDesktopMenu:function(){var ret={items:this.contextMenuItems||[]};ret.items.length&&ret.items.push('-');ret.items.push({text:'Tile',handler:this.tileWindows,scope:this,minWindows:1},{text:'Cascade',handler:this.cascadeWindows,scope:this,minWindows:1});return ret},createWindowMenu:function(){return{defaultAlign:'br-tr',items:[{text:'Restore',handler:this.onWindowMenuRestore,
scope:this},{text:'Minimize',handler:this.onWindowMenuMinimize,scope:this},{text:'Maximize',handler:this.onWindowMenuMaximize,scope:this},'-',{text:'Close',handler:this.onWindowMenuClose,scope:this}],listeners:{beforeshow:this.onWindowMenuBeforeShow,hide:this.onWindowMenuHide,scope:this}}},onDesktopMenu:function(e){var menu=this.contextMenu;e.stopEvent();if(!menu.rendered)menu.on('beforeshow',this.onDesktopMenuBeforeShow,this);menu.showAt(e.getXY());menu.doConstrain()},onDesktopMenuBeforeShow:function(menu){var count=
this.windows.getCount();menu.items.each(function(item){item.setDisabled(count<(item.minWindows||0))})},onShortcutItemClick:function(dataView,record){(dataView=(dataView=this.app.getModule(record.data.module))&&dataView.createWindow())&&this.restoreWindow(dataView)},onWindowClose:function(win){this.windows.remove(win);this.taskbar.removeTaskButton(win.taskButton);this.updateActiveWindow()},onWindowMenuBeforeShow:function(menu){var items=menu.items.items;menu=menu.theWin;items[0].setDisabled(!0!==menu.maximized&&
!0!==menu.hidden);items[1].setDisabled(!0===menu.minimized);items[2].setDisabled(!0===menu.maximized||!0===menu.hidden)},onWindowMenuClose:function(){this.windowMenu.theWin.close()},onWindowMenuHide:function(menu){Ext.defer(function(){menu.theWin=null},1)},onWindowMenuMaximize:function(){var win=this.windowMenu.theWin;win.maximize();win.toFront()},onWindowMenuMinimize:function(){this.windowMenu.theWin.minimize()},onWindowMenuRestore:function(){this.restoreWindow(this.windowMenu.theWin)},getWallpaper:function(){return this.wallpaper.wallpaper},
setTickSize:function(xTickSize,yTickSize){var xt=this.xTickSize=xTickSize,yt=this.yTickSize=1<arguments.length?yTickSize:xt;this.windows.each(function(win){var dd=win.dd;win=win.resizer;dd.xTickSize=xt;dd.yTickSize=yt;win.widthIncrement=xt;win.heightIncrement=yt})},setWallpaper:function(wallpaper,stretch){this.wallpaper.setWallpaper(wallpaper,stretch);return this},cascadeWindows:function(){var x=0,y=0;this.getDesktopZIndexManager().eachBottomUp(function(win){win.isWindow&&win.isVisible()&&!win.maximized&&
(win.setPosition(x,y),x+=20,y+=20)})},createWindow:function(config,cls){var me=this;config=Ext.applyIf(config||{},{stateful:!1,isWindow:!0,constrainHeader:!0,minimizable:!0,maximizable:!0});cls=cls||Ext.window.Window;var win=me.add(new cls(config));me.windows.add(win);win.taskButton=me.taskbar.addTaskButton(win);win.animateTarget=win.taskButton.el;win.on({activate:me.updateActiveWindow,beforeshow:me.updateActiveWindow,deactivate:me.updateActiveWindow,minimize:me.minimizeWindow,destroy:me.onWindowClose,
scope:me});win.on({boxready:function(){win.dd.xTickSize=me.xTickSize;win.dd.yTickSize=me.yTickSize;win.resizer&&(win.resizer.widthIncrement=me.xTickSize,win.resizer.heightIncrement=me.yTickSize)},single:!0});win.doClose=function(){win.doClose=Ext.emptyFn;win.el.disableShadow();win.el.fadeOut({listeners:{afteranimate:function(){win.destroy()}}})};return win},getActiveWindow:function(){var win=null,zmgr=this.getDesktopZIndexManager();zmgr&&zmgr.eachTopDown(function(comp){return comp.isWindow&&!comp.hidden?
(win=comp,!1):!0});return win},getDesktopZIndexManager:function(){var windows=this.windows;return windows.getCount()&&windows.getAt(0).zIndexManager||null},getWindow:function(id){return this.windows.get(id)},minimizeWindow:function(win){win.minimized=!0;win.hide()},restoreWindow:function(win){win.isVisible()?(win.restore(),win.toFront()):win.show();return win},tileWindows:function(){var me=this,availWidth=me.body.getWidth(!0),x=me.xTickSize,y=me.yTickSize,nextY=y;me.windows.each(function(win){if(win.isVisible()&&
!win.maximized){var w=win.el.getWidth();x>me.xTickSize&&x+w>availWidth&&(x=me.xTickSize,y=nextY);win.setPosition(x,y);x+=w+me.xTickSize;nextY=Math.max(nextY,y+win.el.getHeight()+me.yTickSize)}})},updateActiveWindow:function(){var activeWindow=this.getActiveWindow(),last=this.lastActiveWindow;if(last&&last.destroyed)this.lastActiveWindow=null;else if(activeWindow!==last){last&&(last.el.dom&&(last.addCls(this.inactiveWindowCls),last.removeCls(this.activeWindowCls)),last.active=!1);if(this.lastActiveWindow=
activeWindow)activeWindow.addCls(this.activeWindowCls),activeWindow.removeCls(this.inactiveWindowCls),activeWindow.minimized=!1,activeWindow.active=!0;this.taskbar.setActiveButton(activeWindow&&activeWindow.taskButton)}}});
Ext.define('Ext.ux.desktop.App',{mixins:{observable:Ext.util.Observable},isReady:!1,modules:null,useQuickTips:!0,constructor:function(config){this.mixins.observable.constructor.call(this,config);if(Ext.isReady)Ext.defer(this.init,10,this);else Ext.onReady(this.init,this)},init:function(){this.useQuickTips&&Ext.QuickTips.init();(this.modules=this.getModules())&&this.initModules(this.modules);var desktopCfg=this.getDesktopConfig();this.desktop=new Ext.ux.desktop.Desktop(desktopCfg);this.viewport=new Ext.container.Viewport({layout:'fit',
items:[this.desktop]});Ext.getWin().on('beforeunload',this.onUnload,this);this.isReady=!0;this.fireEvent('ready',this)},getDesktopConfig:function(){var cfg={app:this,taskbarConfig:this.getTaskbarConfig()};Ext.apply(cfg,this.desktopConfig);return cfg},getModules:Ext.emptyFn,getStartConfig:function(){var me=this,cfg={app:me,menu:[]},launcher;Ext.apply(cfg,me.startConfig);Ext.each(me.modules,function(module){if(launcher=module.launcher)launcher.handler=launcher.handler||Ext.bind(me.createWindow,me,[module]),
cfg.menu.push(module.launcher)});return cfg},createWindow:function(module){module.createWindow().show()},getTaskbarConfig:function(){var cfg={app:this,startConfig:this.getStartConfig()};Ext.apply(cfg,this.taskbarConfig);return cfg},initModules:function(modules){var me=this;Ext.each(modules,function(module){module.app=me})},getModule:function(name){var ms=this.modules,len;var i=0;for(len=ms.length;i<len;i++){var m=ms[i];if(m.id==name||m.appType==name)return m}return null},onReady:function(fn,scope){if(this.isReady)fn.call(scope,
this);else this.on({ready:fn,scope:scope,single:!0})},getDesktop:function(){return this.desktop},onUnload:function(e){!1===this.fireEvent('beforeunload',this)&&e.stopEvent()}});Ext.define('Ext.ux.desktop.Module',{mixins:{observable:Ext.util.Observable},constructor:function(config){this.mixins.observable.constructor.call(this,config);this.init()},init:Ext.emptyFn});
Ext.define('Ext.ux.desktop.ShortcutModel',{extend:Ext.data.Model,fields:[{name:'name',convert:Ext.String.createVarName},{name:'iconCls'},{name:'module'}]});
Ext.define('Ext.ux.desktop.StartMenu',{extend:Ext.menu.Menu,baseCls:Ext.baseCSSPrefix+'panel',cls:'x-menu ux-start-menu',bodyCls:'ux-start-menu-body',defaultAlign:'bl-tl',iconCls:'user',bodyBorder:!0,width:300,initComponent:function(){this.layout.align='stretch';this.items=this.menu;this.callParent();this.toolbar=new Ext.toolbar.Toolbar(Ext.apply({dock:'right',cls:'ux-start-menu-toolbar',vertical:!0,width:100,layout:{align:'stretch'}},this.toolConfig));this.addDocked(this.toolbar);delete this.toolItems},
addMenuItem:function(){var cmp=this.menu;cmp.add.apply(cmp,arguments)},addToolItem:function(){var cmp=this.toolbar;cmp.add.apply(cmp,arguments)}});
Ext.define('Ext.ux.desktop.TaskBar',{extend:Ext.toolbar.Toolbar,alias:'widget.taskbar',cls:'ux-taskbar',startBtnText:'Start',initComponent:function(){this.startMenu=new Ext.ux.desktop.StartMenu(this.startConfig);this.quickStart=new Ext.toolbar.Toolbar(this.getQuickStart());this.windowBar=new Ext.toolbar.Toolbar(this.getWindowBarConfig());this.tray=new Ext.toolbar.Toolbar(this.getTrayConfig());this.items=[{xtype:'button',cls:'ux-start-button',iconCls:'ux-start-button-icon',menu:this.startMenu,menuAlign:'bl-tl',
text:this.startBtnText},this.quickStart,{xtype:'splitter',html:'\x26#160;',height:14,width:2,cls:'x-toolbar-separator x-toolbar-separator-horizontal'},this.windowBar,'-',this.tray];this.callParent()},afterLayout:function(){this.callParent();this.windowBar.el.on('contextmenu',this.onButtonContextMenu,this)},getQuickStart:function(){var me=this,ret={minWidth:20,width:'neptune'===Ext.themeName?70:60,items:[],enableOverflow:!0};Ext.each(this.quickStart,function(item){ret.items.push({tooltip:{text:item.name,
align:'bl-tl'},overflowText:item.name,iconCls:item.iconCls,module:item.module,handler:me.onQuickStartClick,scope:me})});return ret},getTrayConfig:function(){var ret={items:this.trayItems};delete this.trayItems;return ret},getWindowBarConfig:function(){return{flex:1,cls:'ux-desktop-windowbar',items:['\x26#160;'],layout:{overflowHandler:'Scroller'}}},getWindowBtnFromEl:function(el){return this.windowBar.getChildByElement(el)||null},onQuickStartClick:function(btn){if(btn=this.app.getModule(btn.module))btn=
btn.createWindow(),btn.show()},onButtonContextMenu:function(e){var t=e.getTarget(),btn=this.getWindowBtnFromEl(t);btn&&(e.stopEvent(),this.windowMenu.theWin=btn.win,this.windowMenu.showBy(t))},onWindowBtnClick:function(btn){var win=btn.win;win.minimized||win.hidden?(btn.disable(),win.show(null,function(){btn.enable()})):win.active?(btn.disable(),win.on('hide',function(){btn.enable()},null,{single:!0}),win.minimize()):win.toFront()},addTaskButton:function(win){win={iconCls:win.iconCls,enableToggle:!0,
toggleGroup:'all',width:140,margin:'0 2 0 3',text:Ext.util.Format.ellipsis(win.title,20),listeners:{click:this.onWindowBtnClick,scope:this},win:win};win=this.windowBar.add(win);win.toggle(!0);return win},removeTaskButton:function(btn){var found;this.windowBar.items.each(function(item){item===btn&&(found=item);return!found});found&&this.windowBar.remove(found);return found},setActiveButton:function(btn){btn?btn.toggle(!0):this.windowBar.items.each(function(item){item.isButton&&item.toggle(!1)})}});
Ext.define('Ext.ux.desktop.TrayClock',{extend:Ext.toolbar.TextItem,alias:'widget.trayclock',cls:'ux-desktop-trayclock',html:'\x26#160;',timeFormat:'g:i A',tpl:'{time}',initComponent:function(){this.callParent();'string'===typeof this.tpl&&(this.tpl=new Ext.XTemplate(this.tpl))},afterRender:function(){Ext.defer(this.updateTime,100,this);this.callParent()},doDestroy:function(){this.timer&&(window.clearTimeout(this.timer),this.timer=null);this.callParent()},updateTime:function(){var time=Ext.Date.format(new Date,
this.timeFormat);time=this.tpl.apply({time:time});this.lastText!==time&&(this.setText(time),this.lastText=time);this.timer=Ext.defer(this.updateTime,1E4,this)}});
Ext.define('Ext.ux.desktop.Video',{extend:Ext.panel.Panel,alias:'widget.video',layout:'fit',autoplay:!1,controls:!0,bodyStyle:'background-color:#000;color:#fff',html:'',tpl:'\x3cvideo id\x3d"{id}-video" autoPlay\x3d"{autoplay}" controls\x3d"{controls}" poster\x3d"{poster}" start\x3d"{start}" loopstart\x3d"{loopstart}" loopend\x3d"{loopend}" autobuffer\x3d"{autobuffer}" loop\x3d"{loop}" style\x3d"width:100%;height:100%"\x3e,\x3ctpl for\x3d"src"\x3e,\x3csource src\x3d"{src}" type\x3d"{type}"/\x3e,\x3c/tpl\x3e,{html},\x3c/video\x3e'.split(','),initComponent:function(){if(this.fallbackHTML)var fallback=
this.fallbackHTML;else fallback='Your browser does not support HTML5 Video. ',Ext.isChrome?fallback+='Upgrade Chrome.':Ext.isGecko?fallback+='Upgrade to Firefox 3.5 or newer.':(fallback+='Please try \x3ca href\x3d"http://www.mozilla.com"\x3eFirefox\x3c/a\x3e',fallback=Ext.isIE?fallback+', \x3ca href\x3d"http://www.google.com/chrome"\x3eChrome\x3c/a\x3e or \x3ca href\x3d"http://www.apple.com/safari/"\x3eSafari\x3c/a\x3e.':fallback+' or \x3ca href\x3d"http://www.google.com/chrome"\x3eChrome\x3c/a\x3e.');
this.fallbackHTML=fallback;fallback=this.data=Ext.copyTo({tag:'video',html:fallback},this,'id,poster,start,loopstart,loopend,playcount,autobuffer,loop');this.autoplay&&(fallback.autoplay=1);this.controls&&(fallback.controls=1);Ext.isArray(this.src)?fallback.src=this.src:fallback.src=[{src:this.src}];this.callParent()},afterRender:function(){var el;this.callParent();this.video=this.body.getById(this.id+'-video');if(this.supported=(el=this.video.dom)&&'video'===el.tagName.toLowerCase())this.video.on('error',
this.onVideoError,this)},getFallback:function(){return'\x3ch1 style\x3d"background-color:#ff4f4f;padding: 10px;"\x3e'+this.fallbackHTML+'\x3c/h1\x3e'},onVideoError:function(){this.video.remove();this.supported=!1;this.body.createChild(this.getFallback())},doDestroy:function(){var videoDom;var video=this.video;this.supported&&video&&((videoDom=video.dom)&&videoDom.pause&&videoDom.pause(),video.remove(),this.video=null);this.callParent()}});
Ext.define('Ext.ux.desktop.Wallpaper',{extend:Ext.Component,alias:'widget.wallpaper',cls:'ux-wallpaper',html:'\x3cimg src\x3d"'+Ext.BLANK_IMAGE_URL+'"\x3e',stretch:!1,wallpaper:null,stateful:!0,stateId:'desk-wallpaper',afterRender:function(){this.callParent();this.setWallpaper(this.wallpaper,this.stretch)},applyState:function(){var old=this.wallpaper;this.callParent(arguments);old!==this.wallpaper&&this.setWallpaper(this.wallpaper)},getState:function(){return this.wallpaper&&{wallpaper:this.wallpaper}},
setWallpaper:function(wallpaper,stretch){this.stretch=!1!==stretch;this.wallpaper=wallpaper;if(this.rendered){stretch=this.el.dom.firstChild;if(wallpaper&&wallpaper!==Ext.BLANK_IMAGE_URL)if(this.stretch)stretch.src=wallpaper,this.el.removeCls('ux-wallpaper-tiled'),Ext.fly(stretch).setStyle({width:'100%',height:'100%'}).show();else{Ext.fly(stretch).hide();var bkgnd='url('+wallpaper+')';this.el.addCls('ux-wallpaper-tiled')}else Ext.fly(stretch).hide();this.el.setStyle({backgroundImage:bkgnd||''});this.stateful&&
this.saveState()}return this}});
Ext.define('Ext.ux.event.RecorderManager',{extend:Ext.panel.Panel,alias:'widget.eventrecordermanager',layout:'fit',buttonAlign:'left',eventsToIgnore:{mousemove:1,mouseover:1,mouseout:1},bodyBorder:!1,playSpeed:1,initComponent:function(){function speed(text,value){return{text:text,speed:value,group:'speed',checked:value===me.playSpeed,handler:me.onPlaySpeed,scope:me}}var me=this;me.recorder=new Ext.ux.event.Recorder({attachTo:me.attachTo,listeners:{add:me.updateEvents,coalesce:me.updateEvents,buffer:200,
scope:me}});me.recorder.eventsToRecord=Ext.apply({},me.recorder.eventsToRecord);me.tbar=[{text:'Record',xtype:'splitbutton',whenIdle:!0,handler:me.onRecord,scope:me,menu:me.makeRecordButtonMenu()},{text:'Play',xtype:'splitbutton',whenIdle:!0,handler:me.onPlay,scope:me,menu:[speed('Qarter Speed (0.25x)',.25),speed('Half Speed (0.5x)',.5),speed('3/4 Speed (0.75x)',.75),'-',speed('Recorded Speed (1x)',1),speed('Double Speed (2x)',2),speed('Quad Speed (4x)',4),'-',speed('Full Speed',1E3)]},{text:'Clear',
whenIdle:!0,handler:me.onClear,scope:me},'-\x3e',{text:'Stop',whenActive:!0,disabled:!0,handler:me.onStop,scope:me}];var events=me.attachTo&&me.attachTo.testEvents;me.items=[{xtype:'textarea',itemId:'eventView',fieldStyle:'font-family: monospace',selectOnFocus:!0,emptyText:'Events go here!',value:events?me.stringifyEvents(events):'',scrollToBottom:function(){var inputEl=this.inputEl.dom;inputEl.scrollTop=inputEl.scrollHeight}}];me.fbar=[{xtype:'tbtext',text:'Attached To: '+(me.attachTo&&me.attachTo.location.href)}];
me.callParent()},makeRecordButtonMenu:function(){function less(lhs,rhs){return lhs.text<rhs.text?-1:rhs.text<lhs.text?1:0}var ret=[],subs={},eventsToRec=this.recorder.eventsToRecord,ignoredEvents=this.eventsToIgnore;Ext.Object.each(eventsToRec,function(name,value){var sub=subs[value.kind];sub||(subs[value.kind]=sub=[],ret.push({text:value.kind,menu:sub}));sub.push({text:name,checked:!0,handler:function(menuItem){menuItem.checked?eventsToRec[name]=value:delete eventsToRec[name]}});ignoredEvents[name]&&
(sub[sub.length-1].checked=!1,Ext.defer(function(){delete eventsToRec[name]},1))});ret.sort(less);Ext.Array.each(ret,function(sub){sub.menu.sort(less)});return ret},getEventView:function(){return this.down('#eventView')},onClear:function(){this.getEventView().setValue('')},onPlay:function(){var events=this.getEventView().getValue();events&&(events=Ext.decode(events),events.length&&(this.player=Ext.create('Ext.ux.event.Player',{attachTo:window.opener,eventQueue:events,speed:this.playSpeed,listeners:{stop:this.onPlayStop,
scope:this}}),this.player.start(),this.syncBtnUI()))},onPlayStop:function(){this.player=null;this.syncBtnUI()},onPlaySpeed:function(menuitem){this.playSpeed=menuitem.speed},onRecord:function(){this.recorder.start();this.syncBtnUI()},onStop:function(){this.player?(this.player.stop(),this.player=null):this.recorder.stop();this.syncBtnUI();this.updateEvents()},syncBtnUI:function(){var idle=!this.player&&!this.recorder.active;Ext.each(this.query('[whenIdle]'),function(btn){btn.setDisabled(!idle)});Ext.each(this.query('[whenActive]'),
function(btn){btn.setDisabled(idle)});this.getEventView().setReadOnly(!idle)},stringifyEvents:function(events){var line,lines=[];Ext.each(events,function(ev){line=[];Ext.Object.each(ev,function(name,value){line.length?line.push(', '):line.push('  { ');line.push(name,': ');line.push(Ext.encode(value))});line.push(' }');lines.push(line.join(''))});return'[\n'+lines.join(',\n')+'\n]'},updateEvents:function(){var text=this.stringifyEvents(this.recorder.getRecordedEvents()),view=this.getEventView();view.setValue(text);
view.scrollToBottom()}});
Ext.define('Ext.ux.form.MultiSelect',{extend:Ext.form.FieldContainer,mixins:[Ext.util.StoreHolder,Ext.form.field.Field],alternateClassName:'Ext.ux.Multiselect',alias:['widget.multiselectfield','widget.multiselect'],layout:'anchor',ddReorder:!1,appendOnly:!1,displayField:'text',allowBlank:!0,minSelections:0,maxSelections:Number.MAX_VALUE,blankText:'This field is required',minSelectionsText:'Minimum {0} item(s) required',maxSelectionsText:'Maximum {0} item(s) required',delimiter:',',dragText:'{0} Item{1}',
ignoreSelectChange:0,pageSize:10,initComponent:function(){this.items=this.setupItems();this.bindStore(this.store,!0);this.callParent();this.initField()},setupItems:function(){this.boundList=new Ext.view.BoundList(Ext.apply({anchor:'none 100%',border:1,multiSelect:!0,store:this.store,displayField:this.displayField,disabled:this.disabled,tabIndex:0,navigationModel:{type:'default'}},this.listConfig));this.boundList.getNavigationModel().addKeyBindings({pageUp:this.onKeyPageUp,pageDown:this.onKeyPageDown,
scope:this});this.boundList.getSelectionModel().on('selectionchange',this.onSelectChange,this);this.boundList.pickerField=this;if(!this.title)return this.boundList;this.boundList.border=!1;return{xtype:'panel',isAriaRegion:!1,border:!0,anchor:'none 100%',layout:'anchor',title:this.title,tbar:this.tbar,items:this.boundList}},onSelectChange:function(selModel,selections){this.ignoreSelectChange||this.setValue(selections)},getSelected:function(){return this.boundList.getSelectionModel().getSelection()},
isEqual:function(v1,v2){var fromArray=Ext.Array.from,i=0;v1=fromArray(v1);v2=fromArray(v2);fromArray=v1.length;if(fromArray!==v2.length)return!1;for(;i<fromArray;i++)if(v2[i]!==v1[i])return!1;return!0},afterRender:function(){var me=this,boundList;me.callParent();var scrollable=(boundList=me.boundList)&&boundList.getScrollable();if(me.selectOnRender){var records$jscomp$0=me.getRecordsForValue(me.value);records$jscomp$0.length&&(++me.ignoreSelectChange,boundList.getSelectionModel().select(records$jscomp$0),
--me.ignoreSelectChange);delete me.toSelect}!me.ddReorder||me.dragGroup||me.dropGroup||(me.dragGroup=me.dropGroup='MultiselectDD-'+Ext.id());if(me.draggable||me.dragGroup)me.dragZone=Ext.create('Ext.view.DragZone',{view:boundList,ddGroup:me.dragGroup,dragText:me.dragText,containerScroll:!!scrollable,scrollEl:scrollable&&scrollable.getElement()});if(me.droppable||me.dropGroup)me.dropZone=Ext.create('Ext.view.DropZone',{view:boundList,ddGroup:me.dropGroup,handleNodeDrop:function(data,dropRecord,position){var view=
this.view,store=view.getStore(),records=data.records;data.view.store.remove(records);data=store.indexOf(dropRecord);'after'===position&&data++;store.insert(data,records);view.getSelectionModel().select(records);me.fireEvent('drop',me,records)}});(scrollable=me.down('panel'))&&boundList&&boundList.ariaEl.dom.setAttribute('aria-labelledby',scrollable.header.id+'-title-textEl')},onKeyPageUp:function(e){var pageSize=this.pageSize,nm=this.boundList.getNavigationModel();var oldIdx=nm.recordIndex;nm.setPosition(oldIdx>
pageSize?oldIdx-pageSize:0,e)},onKeyPageDown:function(e){var pageSize=this.pageSize,boundList=this.boundList,nm=boundList.getNavigationModel();boundList=boundList.getStore().getCount();var oldIdx=nm.recordIndex;nm.setPosition(oldIdx<boundList-pageSize?oldIdx+pageSize:boundList-1,e)},isValid:function(){var disabled=this.disabled;return this.forceValidation||!disabled?this.validateValue(this.value):disabled},validateValue:function(value){value=this.getErrors(value);var isValid=Ext.isEmpty(value);this.preventMark||
(isValid?this.clearInvalid():this.markInvalid(value));return isValid},markInvalid:function(errors){var oldMsg=this.getActiveError();this.setActiveErrors(Ext.Array.from(errors));oldMsg!==this.getActiveError()&&this.updateLayout()},clearInvalid:function(){var hadError=this.hasActiveError();this.unsetActiveError();hadError&&this.updateLayout()},getSubmitData:function(){var data=null;if(!this.disabled&&this.submitValue&&!this.isFileUpload()){var val=this.getSubmitValue();null!==val&&(data={},data[this.getName()]=
val)}return data},getSubmitValue:function(){var delimiter=this.delimiter,val=this.getValue();return Ext.isString(delimiter)?val.join(delimiter):val},getValue:function(){return this.value||[]},getRecordsForValue:function(value){var records=[],all=this.store.getRange(),valueField=this.valueField,i=0,allLen=all.length,j,valueLen;for(valueLen=value.length;i<valueLen;++i)for(j=0;j<allLen;++j){var rec=all[j];rec.get(valueField)===value[i]&&records.push(rec)}return records},setupValue:function(value){var delimiter=
this.delimiter,valueField=this.valueField,i=0,item;if(Ext.isDefined(value)){delimiter&&Ext.isString(value)?value=value.split(delimiter):Ext.isArray(value)||(value=[value]);for(delimiter=value.length;i<delimiter;++i)(item=value[i])&&item.isModel&&(value[i]=item.get(valueField));value=Ext.Array.unique(value)}else value=[];return value},setValue:function(value){var selModel=this.boundList.getSelectionModel(),store=this.store;if(store.getCount())value=this.setupValue(value),this.mixins.field.setValue.call(this,
value),this.rendered?(++this.ignoreSelectChange,selModel.deselectAll(),value.length&&selModel.select(this.getRecordsForValue(value)),--this.ignoreSelectChange):this.selectOnRender=!0;else store.on({load:Ext.Function.bind(this.setValue,this,[value]),single:!0})},clearValue:function(){this.setValue([])},onEnable:function(){var list=this.boundList;this.callParent();list&&list.enable()},onDisable:function(){var list=this.boundList;this.callParent();list&&list.disable()},getErrors:function(value){var format=
Ext.String.format,errors=[];value=Ext.Array.from(value||this.getValue());value=value.length;!this.allowBlank&&1>value&&errors.push(this.blankText);value<this.minSelections&&errors.push(format(this.minSelectionsText,this.minSelections));value>this.maxSelections&&errors.push(format(this.maxSelectionsText,this.maxSelections));return errors},doDestroy:function(){this.bindStore(null);Ext.destroy(this.dragZone,this.dropZone,this.keyNav);this.callParent()},onBindStore:function(store){var boundList=this.boundList;
store.autoCreated&&this.resolveDisplayField();Ext.isDefined(this.valueField)||(this.valueField=this.displayField);boundList&&boundList.bindStore(store)},resolveDisplayField:function(){var boundList=this.boundList,store=this.getStore();this.valueField=this.displayField='field1';store.expanded||(this.displayField='field2');boundList&&boundList.setDisplayField(this.displayField)}});
Ext.define('Ext.ux.form.ItemSelector',{extend:Ext.ux.form.MultiSelect,alias:['widget.itemselectorfield','widget.itemselector'],alternateClassName:['Ext.ux.ItemSelector'],hideNavIcons:!1,buttons:'top up add remove down bottom'.split(' '),buttonsText:{top:'Move to Top',up:'Move Up',add:'Add to Selected',remove:'Remove from Selected',down:'Move Down',bottom:'Move to Bottom'},layout:{type:'hbox',align:'stretch'},ariaRole:'group',initComponent:function(){this.ddGroup=this.id+'-dd';this.ariaRenderAttributes=
this.ariaRenderAttributes||{};this.ariaRenderAttributes['aria-labelledby']=this.id+'-labelEl';this.callParent();this.bindStore(this.store)},createList:function(title){return Ext.create('Ext.ux.form.MultiSelect',{submitValue:!1,getSubmitData:function(){return null},getModelData:function(){return null},flex:1,dragGroup:this.ddGroup,dropGroup:this.ddGroup,title:title,store:{model:this.store.model,data:[]},displayField:this.displayField,valueField:this.valueField,disabled:this.disabled,listeners:{boundList:{scope:this,
itemdblclick:this.onItemDblClick,drop:this.syncValue}}})},setupItems:function(){this.fromField=this.createList(this.fromTitle);this.toField=this.createList(this.toTitle);return[this.fromField,{xtype:'toolbar',margin:'0 4',padding:0,layout:{type:'vbox',pack:'center'},items:this.createButtons()},this.toField]},createButtons:function(){var me=this,buttons=[];me.hideNavIcons||Ext.Array.forEach(me.buttons,function(name){buttons.push({xtype:'button',ui:'default',tooltip:me.buttonsText[name],ariaLabel:me.buttonsText[name],
handler:me['on'+Ext.String.capitalize(name)+'BtnClick'],cls:Ext.baseCSSPrefix+'form-itemselector-btn',iconCls:Ext.baseCSSPrefix+'form-itemselector-'+name,navBtn:!0,scope:me,margin:'4 0 0 0'})});return buttons},getSelections:function(list){var store=list.getStore();return Ext.Array.sort(list.getSelectionModel().getSelection(),function(a,b){a=store.indexOf(a);b=store.indexOf(b);return a<b?-1:a>b?1:0})},onTopBtnClick:function(){var list=this.toField.boundList,store=list.getStore(),selected=this.getSelections(list);
store.suspendEvents();store.remove(selected,!0);store.insert(0,selected);store.resumeEvents();list.refresh();this.syncValue();list.getSelectionModel().select(selected)},onBottomBtnClick:function(){var list=this.toField.boundList,store=list.getStore(),selected=this.getSelections(list);store.suspendEvents();store.remove(selected,!0);store.add(selected);store.resumeEvents();list.refresh();this.syncValue();list.getSelectionModel().select(selected)},onUpBtnClick:function(){var list=this.toField.boundList,
store=list.getStore(),selected=this.getSelections(list),i=0,len=selected.length,index=0;for(store.suspendEvents();i<len;++i,index++){var rec=selected[i];index=Math.max(index,store.indexOf(rec)-1);store.remove(rec,!0);store.insert(index,rec)}store.resumeEvents();list.refresh();this.syncValue();list.getSelectionModel().select(selected)},onDownBtnClick:function(){var list=this.toField.boundList,store=list.getStore(),selected=this.getSelections(list),i=selected.length-1,index=store.getCount()-1;for(store.suspendEvents();-1<
i;--i,index--){var rec=selected[i];index=Math.min(index,store.indexOf(rec)+1);store.remove(rec,!0);store.insert(index,rec)}store.resumeEvents();list.refresh();this.syncValue();list.getSelectionModel().select(selected)},onAddBtnClick:function(){var selected=this.getSelections(this.fromField.boundList);this.moveRec(!0,selected);this.toField.boundList.getSelectionModel().select(selected)},onRemoveBtnClick:function(){var selected=this.getSelections(this.toField.boundList);this.moveRec(!1,selected);this.fromField.boundList.getSelectionModel().select(selected)},
moveRec:function(add,recs){var fromField=this.fromField,toField=this.toField,fromStore=add?fromField.store:toField.store;add=add?toField.store:fromField.store;fromStore.suspendEvents();add.suspendEvents();fromStore.remove(recs);add.add(recs);fromStore.resumeEvents();add.resumeEvents();fromField.boundList.containsFocus&&fromField.boundList.focus();fromField.boundList.refresh();toField.boundList.refresh();this.syncValue()},syncValue:function(){this.mixins.field.setValue.call(this,this.setupValue(this.toField.store.getRange()))},
onItemDblClick:function(view,rec){this.moveRec(view===this.fromField.boundList,rec)},setValue:function(value){var fromField=this.fromField,toField=this.toField,fromStore=fromField.store,toStore=toField.store;if(this.fromStorePopulated)value=this.setupValue(value),this.mixins.field.setValue.call(this,value),value=this.getRecordsForValue(value),fromStore.suspendEvents(),toStore.suspendEvents(),fromStore.removeAll(),toStore.removeAll(),this.populateFromStore(this.store),Ext.Array.forEach(value,function(rec){-1<
fromStore.indexOf(rec)&&fromStore.remove(rec);toStore.add(rec)}),fromStore.resumeEvents(),toStore.resumeEvents(),Ext.suspendLayouts(),fromField.boundList.refresh(),toField.boundList.refresh(),Ext.resumeLayouts(!0);else this.fromField.store.on({load:Ext.Function.bind(this.setValue,this,[value]),single:!0})},onBindStore:function(store,initial){initial=this.fromField;var toField=this.toField;if(initial)if(initial.store.removeAll(),toField.store.removeAll(),store.autoCreated&&(initial.resolveDisplayField(),
toField.resolveDisplayField(),this.resolveDisplayField()),Ext.isDefined(this.valueField)||(this.valueField=this.displayField),store.getCount())this.populateFromStore(store);else this.store.on('load',this.populateFromStore,this)},populateFromStore:function(store){var fromStore=this.fromField.store;this.fromStorePopulated=!0;fromStore.add(store.getRange());fromStore.fireEvent('load',fromStore)},onEnable:function(){this.callParent();this.fromField.enable();this.toField.enable();Ext.Array.forEach(this.query('[navBtn]'),
function(btn){btn.enable()})},onDisable:function(){this.callParent();this.fromField.disable();this.toField.disable();Ext.Array.forEach(this.query('[navBtn]'),function(btn){btn.disable()})},doDestroy:function(){this.bindStore(null);this.callParent()}});
Ext.define('Ext.ux.form.SearchField',{extend:Ext.form.field.Text,alias:'widget.searchfield',triggers:{clear:{weight:0,cls:Ext.baseCSSPrefix+'form-clear-trigger',hidden:!0,handler:'onClearClick',scope:'this'},search:{weight:1,cls:Ext.baseCSSPrefix+'form-search-trigger',handler:'onSearchClick',scope:'this'}},hasSearch:!1,paramName:'query',initComponent:function(){var me=this,store=me.store;me.callParent(arguments);me.on('specialkey',function(f,e){if(e.getKey()===e.ENTER)me.onSearchClick()});store&&
store.isStore||(store=me.store=Ext.data.StoreManager.lookup(store));store.setRemoteFilter(!0);store=me.store.getProxy();store.setFilterParam(me.paramName);store.encodeFilters=function(filters){return filters[0].getValue()}},onClearClick:function(){var activeFilter=this.activeFilter;activeFilter&&(this.setValue(''),this.store.getFilters().remove(activeFilter),this.activeFilter=null,this.getTrigger('clear').hide(),this.updateLayout())},onSearchClick:function(){var value=this.getValue();0<value.length&&
(this.activeFilter=new Ext.util.Filter({property:this.paramName,value:value}),this.store.getFilters().add(this.activeFilter),this.getTrigger('clear').show(),this.updateLayout())}});
Ext.define('Ext.ux.grid.SubTable',{extend:Ext.grid.plugin.RowExpander,alias:'plugin.subtable',rowBodyTpl:['\x3ctable class\x3d"'+Ext.baseCSSPrefix+'grid-subtable"\x3e','{%','this.owner.renderTable(out, values);','%}','\x3c/table\x3e'],init:function(grid){var columns=this.columns,len;this.callParent(arguments);this.columns=[];if(columns){var i=0;for(len=columns.length;i<len;++i){var columnCfg=Ext.apply({preventRegister:!0},columns[i]);columnCfg.xtype=columnCfg.xtype||'gridcolumn';this.columns.push(Ext.widget(columnCfg))}}},
destroy:function(){var columns=this.columns,len;if(columns){var i=0;for(len=columns.length;i<len;++i)columns[i].destroy()}this.columns=null;this.callParent()},getRowBodyFeatureData:function(record,idx,rowValues){this.callParent(arguments);rowValues.rowBodyCls+=' '+Ext.baseCSSPrefix+'grid-subtable-row'},renderTable:function(out,rowValues){var columns=this.columns,numColumns=columns.length;rowValues=this.getAssociatedRecords(rowValues.record);var recCount=rowValues.length,i,j;out.push('\x3cthead\x3e');
for(j=0;j<numColumns;j++)out.push('\x3cth class\x3d"'+Ext.baseCSSPrefix+'grid-subtable-header"\x3e',columns[j].text,'\x3c/th\x3e');out.push('\x3c/thead\x3e\x3ctbody\x3e');for(i=0;i<recCount;i++){var rec=rowValues[i];out.push('\x3ctr\x3e');for(j=0;j<numColumns;j++){var column=columns[j];var value=rec.get(column.dataIndex);column.renderer&&column.renderer.call&&(value=column.renderer.call(column.scope||this,value,{},rec));out.push('\x3ctd class\x3d"'+Ext.baseCSSPrefix+'grid-subtable-cell"');null!=column.width&&
out.push(' style\x3d"width:'+column.width+'px"');out.push('\x3e\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'grid-cell-inner"\x3e',value,'\x3c/div\x3e\x3c/td\x3e')}out.push('\x3c/tr\x3e')}out.push('\x3c/tbody\x3e')},getRowBodyContentsFn:function(rowBodyTpl){var me=this;return function(rowValues){rowBodyTpl.owner=me;return rowBodyTpl.applyTemplate(rowValues)}},getAssociatedRecords:function(record){return record[this.association]().getRange()}});
Ext.define('Ext.ux.grid.TransformGrid',{extend:Ext.grid.Panel,constructor:function(table,config){config=Ext.apply({},config);table=this.table=Ext.get(table);for(var configFields=config.fields||[],configColumns=config.columns||[],fields=[],cols=[],headers=table.query('thead th'),i=0,len=headers.length,data=table.dom,height,col,text,name;i<len;++i)col=headers[i],text=col.innerHTML,name='tcol-'+i,fields.push(Ext.applyIf(configFields[i]||{},{name:name,mapping:'td:nth('+(i+1)+')/@innerHTML'})),cols.push(Ext.applyIf(configColumns[i]||
{},{text:text,dataIndex:name,width:col.offsetWidth,tooltip:col.title,sortable:!0}));table=config.width?config.width:table.getWidth()+1;config.height&&(height=config.height);Ext.applyIf(config,{store:{data:data,fields:fields,proxy:{type:'memory',reader:{record:'tbody tr',type:'xml'}}},columns:cols,width:table,height:height});this.callParent([config]);!1!==config.remove&&data.parentNode.removeChild(data)},doDestroy:function(){this.table.remove();this.tabl=null;this.callParent()}});
Ext.define('Ext.ux.grid.plugin.AutoSelector',{extend:Ext.plugin.Abstract,alias:'plugin.gridautoselector',config:{store:null},init:function(grid){grid.isXType('tablepanel')||Ext.raise('The gridautoselector plugin is designed only for grids and trees');this.grid=grid;this.watchGrid();grid.on({reconfigure:this.watchGrid,scope:this})},destroy:function(){this.setStore(null);this.grid=null;this.callParent()},ensureSelection:function(){var grid=this.grid,selection;grid.getStore().getCount()&&((selection=
grid.getSelection())&&selection.length||grid.getSelectionModel().select(0))},watchGrid:function(){this.setStore(this.grid.getStore());this.ensureSelection()},updateStore:function(store){Ext.destroy(this.storeListeners);this.storeListeners=store&&store.on({add:this.ensureSelection,remove:this.ensureSelection,destroyable:!0,scope:this})}});
Ext.define('Ext.ux.layout.ResponsiveColumn',{extend:Ext.layout.container.Auto,alias:'layout.responsivecolumn',states:{small:1E3,large:0},_responsiveCls:Ext.baseCSSPrefix+'responsivecolumn',initLayout:function(){this.innerCtCls+=' '+this._responsiveCls;this.callParent()},beginLayout:function(ownerContext){var viewportWidth=Ext.Element.getViewportWidth(),states=this.states,activeThreshold=Infinity,innerCt=this.innerCt,currentState=this._currentState,name;for(name in states){var threshold=states[name]||
Infinity;if(viewportWidth<=threshold&&threshold<=activeThreshold){activeThreshold=threshold;var newState=name}}newState!==currentState&&(innerCt.replaceCls(currentState,newState,this._responsiveCls),this._currentState=newState);this.callParent(arguments)},onAdd:function(item){var responsiveCls;this.callParent([item]);(responsiveCls=item.responsiveCls)&&item.addCls(responsiveCls)}},function(Responsive){Ext.isIE8&&Responsive.override({responsiveSizePolicy:{readsWidth:0,readsHeight:0,setsWidth:1,setsHeight:0},
setsItemSize:!0,calculateItems:function(ownerContext,containerSize){var targetContext=ownerContext.targetContext,items=ownerContext.childItems,len=items.length,gotWidth=containerSize.gotWidth;containerSize=containerSize.width;if(!1===gotWidth)return targetContext.domBlock(this,'width'),!1;if(!gotWidth)return!0;for(targetContext=0;targetContext<len;++targetContext){gotWidth=items[targetContext];var itemWidth=parseInt(gotWidth.el.getStyle('background-position-x'),10);var itemMarginWidth=parseInt(gotWidth.el.getStyle('background-position-y'),
10);gotWidth.setWidth(itemWidth/100*(containerSize-itemMarginWidth)-itemMarginWidth)}ownerContext.setContentWidth(containerSize+ownerContext.paddingContext.getPaddingInfo().width);return!0},getItemSizePolicy:function(){return this.responsiveSizePolicy}})});
Ext.define('Ext.ux.statusbar.ValidationStatus',{extend:Ext.Component,alias:'plugin.validationstatus',errorIconCls:'x-status-error',errorListCls:'x-status-error-list',validIconCls:'x-status-valid',showText:'The form has errors (click for details...)',hideText:'Click again to hide the error list',submitText:'Saving...',init:function(sb){this.statusBar=sb;sb.on({single:!0,scope:this,render:this.onStatusbarRender});sb.on({click:{element:'el',fn:this.onStatusClick,scope:this,buffer:200}})},onStatusbarRender:function(sb){var me=
this,startMonitor=function(){me.monitor=!0};me.monitor=!0;me.errors=Ext.create('Ext.util.MixedCollection');me.listAlign='right'===sb.statusAlign?'br-tr?':'bl-tl?';me.form&&(me.formPanel=Ext.getCmp(me.form)||me.statusBar.lookupController().lookupReference(me.form),me.basicForm=me.formPanel.getForm(),me.startMonitoring(),me.basicForm.on({beforeaction:function(f,action){'submit'===action.type&&(me.monitor=!1)}}),me.formPanel.on({beforedestroy:me.destroy,scope:me}),me.basicForm.on('actioncomplete',startMonitor),
me.basicForm.on('actionfailed',startMonitor))},startMonitoring:function(){this.basicForm.getFields().each(function(f){f.on('validitychange',this.onFieldValidation,this)},this)},stopMonitoring:function(){var form=this.basicForm;form.destroyed||form.getFields().each(function(f){f.un('validitychange',this.onFieldValidation,this)},this)},doDestroy:function(){Ext.destroy(this.msgEl);this.stopMonitoring();this.statusBar.statusEl.un('click',this.onStatusClick,this);this.callParent()},onFieldValidation:function(f,
isValid){if(!this.monitor)return!1;(isValid=f.getErrors()[0])?this.errors.add(f.id,{field:f,msg:isValid}):this.errors.removeAtKey(f.id);this.updateErrorList();0<this.errors.getCount()?this.statusBar.getText()!==this.showText&&this.statusBar.setStatus({text:this.showText,iconCls:this.errorIconCls}):this.statusBar.clearStatus().setIcon(this.validIconCls)},updateErrorList:function(){var msgEl=this.getMsgEl();if(0<this.errors.getCount()){var msg=['\x3cul\x3e'];this.errors.each(function(err){msg.push('\x3cli id\x3d"x-err-',
err.field.id,'"\x3e\x3ca href\x3d"#"\x3e',err.msg,'\x3c/a\x3e\x3c/li\x3e')});msg.push('\x3c/ul\x3e');msgEl.update(msg.join(''))}else msgEl.update('');msgEl.setSize('auto','auto')},getMsgEl:function(){var me=this,msgEl=me.msgEl,t;msgEl||(msgEl=me.msgEl=Ext.DomHelper.append(Ext.getBody(),{cls:me.errorListCls},!0),msgEl.hide(),msgEl.on('click',function(e){if(t=e.getTarget('li',10,!0))Ext.getCmp(t.id.split('x-err-')[1]).focus(),me.hideErrors()},null,{stopEvent:!0}));return msgEl},showErrors:function(){this.updateErrorList();
this.getMsgEl().alignTo(this.statusBar.getEl(),this.listAlign).slideIn('b',{duration:300,easing:'easeOut'});this.statusBar.setText(this.hideText);this.formPanel.body.on('click',this.hideErrors,this,{single:!0})},hideErrors:function(){var el=this.getMsgEl();el.isVisible()&&(el.slideOut('b',{duration:300,easing:'easeIn'}),this.statusBar.setText(this.showText));this.formPanel.body.un('click',this.hideErrors,this)},onStatusClick:function(){this.getMsgEl().isVisible()?this.hideErrors():0<this.errors.getCount()&&
this.showErrors()}});
Ext.define('Window.addEditTextWindow.Controller',{extend:Ext.app.ViewController,alias:'controller.add-edit-text-window',initViewModel:function(vm){var view=this.getView();if(view.customConfig.selectedRecord){vm.set('selectedRecord',view.customConfig.selectedRecord);var initContent=view.customConfig.selectedRecord.get('text')}else{var obj={get:function(){return''}};view.customConfig.selectedRecord=obj;vm.set('selectedRecord',obj);initContent=''}vm.set('textTypeUrl',view.customConfig.textTypeUrl);vm.set('store',
view.customConfig.store);vm.set('mode',view.customConfig.mode);'edit'===view.customConfig.mode?(vm.set('content',initContent),vm.set('textType',view.customConfig.selectedRecord.get('tip'))):'add'===view.customConfig.mode&&vm.set('textType',view.customConfig.textType);vm.bind('{content}',function(content){this.isDataModified(content,initContent)?vm.set('isButtonDisabled',!1):vm.set('isButtonDisabled',!0)},this)},isDataModified:function(arg1,arg2){return arg1.length!==arg2.length||arg1!==arg2},onSaveButtonClick:function(){var view=
this.getView(),vm=this.getViewModel(),mode=vm.get('mode'),url=vm.get('textTypeUrl'),selectedRecord=vm.get('selectedRecord');'edit'===mode?(url+=selectedRecord.get('id')+'/',method='PUT'):'add'===mode&&(method='POST');view.setLoading();Ext.Ajax.request({method:method,url:url,params:{tip:vm.get('textType'),text:vm.get('content')},success:function(){vm.get('store').load({failure:function(){app.showSaveErrorMsg()}});vm.set('isWindowShouldNotBeClosed',!1);view.close()},failure:function(){app.showSaveErrorMsg()},
callback:function(){view.setLoading(!1)}})},onCancelButtonClick:function(){this.getView().close()},onBeforeCloseWindow:function(){var vm=this.getViewModel(),window=this.getView(),isWindowShouldNotBeClosed=vm.get('isWindowShouldNotBeClosed'),initContent=window.customConfig.selectedRecord.get('text');if(this.isDataModified(initContent,vm.get('content'))&&isWindowShouldNotBeClosed)return app.showCancelDirtyQuestion(function(){vm.set('isWindowShouldNotBeClosed',!1);window.close()},function(){}),!1;vm.set('isWindowShouldNotBeClosed',
!0);return!0}});
Ext.define('Window.addEditTextWindow.View',{extend:Ext.window.Window,xtype:'add-edit-text-window',controller:'add-edit-text-window',viewModel:'add-edit-text-window',layout:'fit',modal:!0,dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'button',text:'Сохранить',iconCls:I.Save,disabled:!0,bind:{disabled:'{isButtonDisabled}'},handler:'onSaveButtonClick'},{xtype:'button',text:'Отмена',iconCls:I.Cancel,handler:'onCancelButtonClick'}]}],items:[{xtype:'textarea',fieldLabel:'Текст',labelWidth:50,margin:'10',
flex:1,bind:{value:'{content}'}}],listeners:{beforeclose:'onBeforeCloseWindow'}});Ext.define('Window.addEditTextWindow.ViewModel',{extend:Ext.app.ViewModel,alias:'viewmodel.add-edit-text-window',data:{textType:void 0,selectedRecord:void 0,content:'',isButtonDisabled:!0,isWindowShouldNotBeClosed:!0}});
Ext.define('Window.chooseWindow.Ctrl',{extend:Ext.app.ViewController,alias:'controller.window-choosewindow-ctrl',init:function(){this.getViewModel().bind('{searchQuery}',this.onSearchQueryChanged,this)},onCleanQueryClicked:function(sender){this.getViewModel().set('searchQuery',null)},onSearchQueryChanged:function(value){var view=this.getView();if(view.getShowSearchPane()){var filter=view.getFilterPropertyName();view=this.getViewModel().getStore('gridStore');console.log('onSearchQueryChanged',value,
filter,view);filter&&(!0!==view.remoteFilter&&Ext.isEmpty(value)&&(console.log('local sorting null value'),value=''),view.removeFilter(filter),value={property:filter,value:value},!0!==view.removeFilter&&(console.log('filter add like \x26 ci'),value.anyMatch=!0,value.caseSensitive=!1),view.addFilter(value))}},onWndBeforeClose:function(sender){this.getView();console.log('choose_wnd::onWndBeforeCLose')},onGridSelectionChanged:function(sender,selected,eOpts){console.log('onGridSelChanged');sender=null;
Ext.isEmpty(selected)||(sender=selected[0]);console.log('set selected record',sender);this.getViewModel().set('selectedRecord',sender)},onOkClicked:function(sender){sender=this.getView();this.getViewModel().set('wasSaved',!0);sender.close()},onCancelClicked:function(sender){sender=this.getView();var vm=this.getViewModel();vm.set('wasSaved',!1);vm.set('selectedRecord',null);sender.close()},onCreateNewClicked:function(sender){sender=this.getView().getAddWndCfg();Ext.isEmpty(sender)?console.error('addWndCfg not defined!'):
(sender=Ext.create(sender),sender.show(),sender.on('beforeclose',this.onAddWndBeforeClose,this))},onAddWndBeforeClose:function(sender){sender.wasSaved()&&this.getViewModel().getStore('gridStore').load()},onGridStoreLoad:function(sender,records,successful,operation,eOpts){console.log('choose_wnd::onGridStoreLoad',records);var selectedId=this.getView().getSelectedId();if(!Ext.isEmpty(selectedId)){var selectedRecords=[];Ext.each(records,function(r){r.get('id')==selectedId&&selectedRecords.push(r)},this);
sender=this.getView();Ext.isEmpty(selectedRecords)||sender.getShowPageToolbar()||sender.lookupReference('grid').getSelectionModel().select(selectedRecords)}}});
Ext.define('Window.chooseWindow.View',{extend:Ext.window.Window,xtype:'window-choosewindow-view',controller:'window-choosewindow-ctrl',viewModel:'window-choosewindow-vm',title:'Окно выбора значения',floating:!0,layout:{type:'vbox',align:'stretch'},height:500,modal:!0,width:600,config:{selectedId:null,canAddNew:!1,addWndCfg:null,fieldLabel:null,customStore:null,showSearchPane:!1,filterPropertyName:null,showPageToolbar:!1,gridColumns:[]},updateCustomStore:function(value){Ext.isEmpty(value)||this.getViewModel().setStores({gridStore:value})},
publishes:['canAddNew','fieldLabel','showSearchPane','showPageToolbar'],reference:'choose_wnd',listeners:{beforeclose:'onWndBeforeClose'},dockedItems:[{xtype:'toolbar',dock:'top',overflowHandler:'menu',defaults:{scale:'small'},items:[{text:'Выбрать',iconCls:I.CheckCircleO,disabled:!0,minWidth:70,handler:'onOkClicked',reference:'ok_btn',bind:{disabled:'{!isDirty}'}},{text:'Отмена',iconCls:I.Cancel,handler:'onCancelClicked'},'-\x3e',{text:'Создать',iconCls:I.Plus,handler:'onCreateNewClicked',bind:{hidden:'{!choose_wnd.canAddNew}'}}]},
{xtype:'toolbar',dock:'top',overflowHandler:'menu',defaults:{scale:'small'},hidden:!0,bind:{hidden:'{!choose_wnd.showSearchPane}'},items:[{xtype:'label',text:'Поиск:'},{xtype:'textfield',iconCls:I.Search,labelWidth:70,minWidth:150,reference:'search_field',bind:{value:'{searchQuery}'}},{xtype:'button',text:'Очистить',iconCls:I.Broom,handler:'onCleanQueryClicked'}]}],defaults:{padding:'0 10 10 10'},items:[{xtype:'label',bind:{html:'\x3cdiv style\x3d"font-size: small;text-align: center;"\x3e{choose_wnd.fieldLabel}\x3c/div\x3e'}},
{xtype:'grid-basegrid-view',reference:'grid',flex:1,selModel:{type:'checkboxmodel',mode:'SINGLE',allowDeselect:!0},listeners:{selectionchange:'onGridSelectionChanged'},bbar:{xtype:'pagingtoolbar',displayInfo:!0,hidden:!0,bind:{hidden:'{!choose_wnd.showPageToolbar}'}},columns:[],bind:{store:'{gridStore}'}}],initComponent:function(){this.items[1].columns=this.config.gridColumns;console.log('init chooseWnd',this.items);this.callParent(arguments)},wasSaved:function(){return this.getViewModel().get('wasSaved')},
getSelectedRecord:function(){return this.getViewModel().get('selectedRecord')}});
Ext.define('Window.chooseWindow.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.window-choosewindow-vm',data:{selectedRecord:null,searchQuery:null,showPageToolbar:!1,wasSaved:!1},stores:{gridStore:{autoLoad:!1,filters:[],pageSize:0,limit:0,remoteFilter:!0,proxy:{type:'common-restproxy',sortParam:'ordering',url:'',reader:{type:'json',messageProperty:'detail',rootProperty:'data'}},listeners:{}}},formulas:{isDirty:{bind:{bindTo:'{selectedRecord}'},get:function(record){var oldSelectedId=this.getView().getSelectedId();
console.log('isDirty',record,oldSelectedId);return!record&&oldSelectedId||record&&!oldSelectedId?!0:record&&oldSelectedId?record.id!=oldSelectedId:!1}}}});
Ext.define('Window.editWindow.Ctrl',{extend:Ext.app.ViewController,alias:'controller.window-editwindow-ctrl',onWndShow:function(sender){sender.setWidth(sender.getWidth());sender=this.getView();var mode=sender.getMode();sender.setMaxHeight(app.viewport.getHeight());if('edit'==mode){mode=sender.getFormModel();var form=sender.lookupReference('form'),editRec=sender.getEditRecord();sender=sender.getEditId();Ext.isEmpty(editRec)?Ext.isEmpty(sender)||(mode=Ext.create(mode),mode.setId(sender),mode.load({scope:this,
failure:this.onRecLoadFailed,success:this.onRecLoadSuccess})):form.loadRecord(editRec)}},onRecLoadSuccess:function(record,operation){this.getView().lookupReference('form').loadRecord(record)},onRecLoadFailed:function(record,operation){app.showGetDataErrorMsg();this.close()},onBeforeClose:function(sender){var $jscomp$this=this;this.getView();if(this.getViewModel().get('isDirty'))return app.showCancelDirtyQuestion(function(){console.log('ok clicked',$jscomp$this);$jscomp$this.getViewModel().set('isDirty',
!1);$jscomp$this.getView().close()},Ext.emptyFn,this),!1},onAddClicked:function(sender){var view=this.getView(),model=view.getFormModel(),vm=this.getViewModel(),form=view.lookupReference('form');vm.set('addSvyaz',form.addSvyaz);if(form.isValid())if(form.additionalValidation&&'function'===typeof form.additionalValidation&&!form.additionalValidation())form=form.additionalValidationErrorMsg(),app.showErrorMsg('Ошибка!',form,!1,sender);else if(!0===view.getSubmitFormDirectly()){view=view.getSubmitFormDirectlyURL();
if(Ext.isEmpty(view))throw'Не верно задана конфигурация: submitFormDirectlyURL';sender=form.ignore_error;form.getForm().submit({url:view,success:this.onSaveSuccess,failure:sender?this.onSaveSuccess:this.onSaveFormFailure,scope:this})}else sender=Ext.create(model),model=view.getFormModelCustomUrl(),Ext.isEmpty(model)||sender.getProxy().setUrl(model),form.updateRecord(sender),form.makeRecord&&'function'===typeof form.makeRecord&&form.makeRecord(sender),Ext.isEmpty(view.getCheckBeforeSaveUrl())?sender.save({failure:this.onSaveRecordFailure,
success:this.onSaveRecordSuccess,scope:this}):this.checkBeforeSave(sender,view.getCheckBeforeSaveUrl());else app.showInvalidFormMsg(sender)},checkBeforeSave:function(record,checkUrl){record.save({url:checkUrl,failure:this.onCheckFailure,success:this.onCheckSuccess,scope:this})},onCheckSuccess:function(record,operation){var $jscomp$this=this;console.log('onCheckSuccess',operation);record=operation.getResponse();record=Ext.decode(record.responseText);console.log('responseJSON',record);var view=this.getView(),
vm=this.getViewModel();operation='';console.log('URL',view.getFormModel());record=record.data;var infoMsg=record.msg.replace(/(?:\r\n|\r|\n)/g,'\x3cbr\x3e');1!=record.canAdd?app.showQuestion(record.errorMsg,infoMsg,function(){vm.set('isDirty',!1);vm.set('wasSaved',!1);$jscomp$this.getView().close()},Ext.emptyFn,this,null,Ext.MessageBox.ERROR):(!0===record.izyatie?(console.log('Сохранение после изъятия'),this.getViewModel().set('izyatie',!0),console.log('Изъятие',this.getViewModel().get('izyatie')),
operation='Запрос на подтверждение изъятия документов из дела'):operation='Запрос на подтверждение списания учтенных листов',app.showQuestion(operation,infoMsg,function(){var model=view.getFormModel(),form=view.lookupReference('form_panel').down('form');model=Ext.create(model);var modelUrl=view.getFormModelCustomUrl();Ext.isEmpty(modelUrl)||model.getProxy().setUrl(modelUrl);console.log('Get URL',model.getProxy().getUrl(),typeof model.getProxy().getUrl());$jscomp$this.getViewModel().set('modelUrl',
model.getProxy().getUrl());form.updateRecord(model);console.log('NEWRECORD',model);model.save({failure:$jscomp$this.onSaveFailure,success:$jscomp$this.onSaveFormSuccess,scope:$jscomp$this})},Ext.emptyFn,this))},onCheckFailure:function(record,operation){console.log('onCheckFailure',operation);app.showSaveErrorMsg(operation.response)},onSaveFailure:function(record,operation){this.getView();this.getViewModel().set('wasSaved',!1);console.log('onSaveFailure',operation.error.response);app.showSaveErrorMsg(operation.error.response)},
onEditClicked:function(sender){var view=this.getView(),form=view.lookupReference('form');if(form.isValid())if(form.additionalValidation&&'function'===typeof form.additionalValidation&&!form.additionalValidation())form=form.additionalValidationErrorMsg(),app.showErrorMsg('Ошибка!',form,!1,sender);else if(!0===view.getSubmitFormDirectly()){sender=view.getSubmitFormDirectlyURL();if(Ext.isEmpty(sender))throw'Не верно задана конфигурация: submitFormDirectlyURL';form.getForm().submit({url:sender,success:this.onSaveFormSuccess,
failure:this.onSaveFormFailure,scope:this})}else sender=form.getRecord(),form.updateRecord(sender),sender.save({failure:this.onSaveRecordFailure,success:this.onSaveRecordSuccess,scope:this});else app.showInvalidFormMsg(sender)},onSaveFormSuccess:function(record,operation){this.getViewModel().get('izyatie')&&(operation=this.getViewModel().get('modelUrl'),Ext.Ajax.request({url:operation+record.id+'/doc_izyatie/',method:'GET',success:function(response,eOpt){console.log('onEditWndBeforeClose в изъятии')},
scope:this}));console.log('onSave scope',this);record=this.getView();operation=this.getViewModel();operation.set('isDirty',!1);operation.set('wasSaved',!0);record.close()},onCancelClicked:function(sender){var $jscomp$this=this,view=this.getView(),vm=this.getViewModel();vm.get('isDirty')?app.showCancelDirtyQuestion(function(){console.log('ok clicked',$jscomp$this);vm.set('isDirty',!1);view.close()},Ext.emptyFn,this,sender):(vm.set('wasSaved',!1),this.getView().close())},onSaveRecordSuccess:function(record,
operation){this.getViewModel().set('current_doc_id',record.id);this.onSaveSuccess()},onSaveRecordFailure:function(record,operation){record=null;operation&&operation.error&&(record=operation.error);this.onSaveFormFailure(null,record)},onSaveSuccess:function(){console.log('onSave scope',this);var view=this.getView(),vm=this.getViewModel();vm.set('isDirty',!1);vm.set('wasSaved',!0);view.close()},onSaveFormFailure:function(form,action){console.log('post save failure!',form,action);this.getView();this.getViewModel().set('wasSaved',
!1);app.showSaveErrorMsg(action.response)},onFormDirtyChange:function(sender,dirty,eOpts){console.log('onFormDirtyChange',dirty,sender);this.getViewModel().set('isDirty',dirty)}});
Ext.define('Window.editWindow.View',{extend:Ext.window.Window,xtype:'window-editwindow-view',controller:'window-editwindow-ctrl',viewModel:'window-editwindow-vm',reference:'window-editwindow-view',listeners:{show:'onWndShow',beforeclose:'onBeforeClose'},constrain:!0,config:{mode:'add',checkBeforeSaveUrl:null,addBtnCfg:{text:'Зарегистрировать',iconCls:I.PlusCircle,tooltip:'Зарегистрировать документ'},editBtnCfg:{text:'Сохранить',iconCls:I.Edit,tooltip:'Сохранить изменения'},cancelBtnCfg:{text:'Отмена',
iconCls:I.Cancel,tooltip:'Закрыть окно без изменений'},formModel:'',formModelCustomUrl:'',submitFormDirectly:!1,submitFormDirectlyURL:'',formClass:null,editRecord:null,editId:null,formItems:[{xtype:'displayfield',value:'Not initialized!!'}],formItemsCustomCfg:null,formCustomCfg:null,formItemsCustomCfg_EXAMPLE:{tip_spravochnika:{disabled:!0,value:1}}},layout:{type:'vbox',align:'stretch'},modal:!0,scrollable:'vertical',resizable:!0,wasSaved:function(){return this.getViewModel().get('wasSaved')},addSvyaz:function(){return this.getViewModel().get('addSvyaz')},
currentDoc:function(){return this.getViewModel().get('current_doc_id')},initComponent:function(){this.dockedItems=this.getDockedItem();this.items=this.getItems();this.callParent(arguments);var fieldCfgs=this.config.formItemsCustomCfg;if(!Ext.isEmpty(this.config.formItemsCustomCfg)){var form=this.lookupReference('form'),fieldName;for(fieldName in fieldCfgs){var field=form.getForm().findField(fieldName);if(!Ext.isEmpty(field)){var fieldProperties=fieldCfgs[fieldName],propName;for(propName in fieldProperties){var setMethod=
'set'+Ext.util.Format.capitalize(propName);console.log('formItemsCustomCfg',setMethod,field,fieldProperties[propName]);field[setMethod](fieldProperties[propName])}}}}},getDockedItem:function(){var dockedItems=[],mode=this.config.mode;'add'==mode?(mode=this.config.addBtnCfg,Ext.apply(mode,{handler:'onAddClicked',bind:{disabled:'{!isDirty}'}}),dockedItems.push(mode)):'edit'==mode&&(mode=this.config.editBtnCfg,Ext.apply(mode,{handler:'onEditClicked',bind:{disabled:'{!isDirty}'}}),dockedItems.push(mode));
mode=this.config.cancelBtnCfg;Ext.apply(mode,{handler:'onCancelClicked'});dockedItems.push(mode);return[{xtype:'toolbar',dock:'top',items:dockedItems}]},getItems:function(){var isEditMode='edit'==this.config.mode,panelItems=[],formClass=this.config.formClass;isEditMode=Ext.isEmpty(formClass)?{xtype:'panel-editpanel-view',listeners:{dirtychange:'onFormDirtyChange'},reference:'form',fieldDefaults:{labelAlign:'right',labelWidth:90,msgTarget:Ext.supports.Touch?'side':'under'},layout:{type:'vbox',align:'stretch'},
items:this.config.formItems}:{xtype:formClass,trackResetOnLoad:isEditMode,listeners:{dirtychange:'onFormDirtyChange'},reference:'form'};Ext.isEmpty(this.config.formCustomCfg)||Ext.apply(isEditMode,this.config.formCustomCfg);panelItems.push(isEditMode);return{xtype:'panel',bodyPadding:'10',layout:'fit',reference:'form_panel',items:panelItems}}});
Ext.define('Window.editWindow.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.window-editwindow-vm',data:{isDirty:!1,wasSaved:!1,izyatie:!1,modelUrl:null,addSvyaz:!1,current_doc_id:null}});
Ext.define('Window.simpleWindow.Ctrl',{extend:Ext.app.ViewController,alias:'controller.window-simplewindow-ctrl',onWndShow:function(sender){sender.setWidth(sender.getWidth());var view=this.getView();sender=view.lookupReference('form');view=view.getRecord();sender.loadRecord(view)},onBeforeClose:function(sender){var $jscomp$this=this;this.getView();if(this.getViewModel().get('isDirty'))return app.showCancelDirtyQuestion(function(){console.log('ok clicked',$jscomp$this);$jscomp$this.getViewModel().set('isDirty',
!1);$jscomp$this.getView().close()},Ext.emptyFn,this),!1},onAddOrEditClicked:function(sender){var view=this.getView(),form=view.lookupReference('form');form.isValid()?form.additionalValidation&&'function'===typeof form.additionalValidation&&!form.additionalValidation()?(view=form.additionalValidationErrorMsg(),app.showErrorMsg('Ошибка!',view,!1,sender)):(sender=view.getRecord(),form.updateRecord(sender),form=this.getViewModel(),form.set('isDirty',!1),form.set('wasApply',!0),form.set('updatedRecord',
sender),view.close()):app.showInvalidFormMsg(sender)},onCancelClicked:function(sender){var $jscomp$this=this;this.getView();var vm=this.getViewModel();vm.get('isDirty')?app.showCancelDirtyQuestion(function(){console.log('ok clicked',$jscomp$this);$jscomp$this.getViewModel().set('isDirty',!1);$jscomp$this.getView().close()},Ext.emptyFn,this,sender):(vm.set('wasApply',!1),this.getView().close())},onFormDirtyChange:function(sender,dirty,eOpts){console.log('onFormDirtyChange',dirty);this.getViewModel().set('isDirty',
dirty)}});
Ext.define('Window.simpleWindow.View',{extend:Ext.window.Window,xtype:'window-simplewindow-view',controller:'window-simplewindow-ctrl',viewModel:'window-simplewindow-vm',listeners:{show:'onWndShow',beforeclose:'onBeforeClose'},config:{mode:'add',addBtnCfg:{text:'Создать',iconCls:I.PlusCircle,tooltip:'Создать'},editBtnCfg:{text:'Сохранить',iconCls:I.Edit,tooltip:'Сохранить изменения'},cancelBtnCfg:{text:'Отмена',iconCls:I.Cancel,tooltip:'Закрыть окно без изменений'},formClass:null,record:null,formItems:[{xtype:'displayfield',
value:'Not initialized!!'}],formItemsCustomCfg:null,formItemsCustomCfg_EXAMPLE:{tip_spravochnika:{disabled:!0,value:1}},formCustomCfg:null},layout:{type:'vbox',align:'stretch'},modal:!0,scrollable:'vertical',wasApply:function(){return this.getViewModel().get('wasApply')},updatedRecord:function(){return this.getViewModel().get('updatedRecord')},initComponent:function(){this.dockedItems=this.getDockedItem();this.items=this.getItems();this.callParent(arguments);var fieldCfgs=this.config.formItemsCustomCfg;
if(!Ext.isEmpty(this.config.formItemsCustomCfg)){var form=this.lookupReference('form'),fieldName;for(fieldName in fieldCfgs){var field=form.getForm().findField(fieldName);if(!Ext.isEmpty(field)){var fieldProperties=fieldCfgs[fieldName],propName;for(propName in fieldProperties){var setMethod='set'+Ext.util.Format.capitalize(propName);console.log('formItemsCustomCfg',setMethod,field,fieldProperties[propName]);field[setMethod](fieldProperties[propName])}}}}},getDockedItem:function(){var dockedItems=
[],mode=this.config.mode;'add'==mode?(mode=this.config.addBtnCfg,Ext.apply(mode,{handler:'onAddOrEditClicked',bind:{disabled:'{!isDirty}'}}),dockedItems.push(mode)):'edit'==mode&&(mode=this.config.editBtnCfg,Ext.apply(mode,{handler:'onAddOrEditClicked',bind:{disabled:'{!isDirty}'}}),dockedItems.push(mode));mode=this.config.cancelBtnCfg;Ext.apply(mode,{handler:'onCancelClicked'});dockedItems.push(mode);return[{xtype:'toolbar',dock:'top',items:dockedItems}]},getItems:function(){var panelItems=[],formClass=
this.config.formClass;Ext.isEmpty(formClass)?panelItems.push({xtype:'panel-editpanel-view',listeners:{dirtychange:'onFormDirtyChange'},reference:'form',fieldDefaults:{labelAlign:'right',labelWidth:90,msgTarget:'under'},layout:{type:'vbox',align:'stretch'},items:this.config.formItems}):(formClass={xtype:formClass,trackResetOnLoad:!0,listeners:{dirtychange:'onFormDirtyChange'},reference:'form'},Ext.isEmpty(this.config.formCustomCfg)||Ext.apply(formClass,this.config.formCustomCfg),panelItems.push(formClass));
return{xtype:'panel',bodyPadding:'10',layout:'fit',items:panelItems}}});Ext.define('Window.simpleWindow.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.window-simplewindow-vm',data:{isDirty:!1,wasApply:!1,updatedRecord:null}});Ext.define('Tree.baseTree.Ctrl',{extend:Ext.app.ViewController,alias:'controller.tree-basetree-ctrl',onResize:function(sender){console.log('on resize!');sender.setStyle('overflow-x','auto')}});
Ext.define('Tree.baseTree.View',{extend:Ext.tree.Panel,xtype:'tree-basetree-view',controller:'tree-basetree-ctrl',rootVisible:!1,useArrows:!0,viewConfig:{listeners:{resize:{fn:'onResize',single:!0},refresh:{fn:'onResize',delay:300}}},selectNodeByInnername:function(innername,silence){silence=void 0===silence?!0:silence;var node=null;this.getRootNode().cascade({before:function(n){n.id==innername&&(node=n)},scope:this});node&&(silence&&this.suspendEvent('selectionchange'),this.selectPath(node.getPath()),
silence&&this.resumeEvent('selectionchange'))}});
Ext.define('Grid.baseGrid.View',{extend:Ext.grid.Panel,xtype:'grid-basegrid-view',enableColumnMove:!1,listeners:{},columnLines:!0,viewConfig:{markDirty:!1,emptyText:'Нет записей!',getRowClass:function(record,rowIndex,rowParams,store){if(record.get('is_deleted')||record.get('is_nedostavlen'))return'row-deleted'}},selModel:{selType:'rowmodel',mode:'SINGLE'},defaultColCfg:null,initComponent:function(){if(!Ext.isEmpty(this.defaultColCfg))for(var i=0;i<this.columns.length;i++)Ext.applyIf(this.columns[i],
this.defaultColCfg);this.callParent(arguments)}});
Ext.define('Grid.nestedGrid.Ctrl',{extend:Ext.app.ViewController,alias:'controller.grid-nestedgrid-ctrl',onSelectionChanged:function(sender,selected,eOpts){var me=this.getView(),row=null;Ext.isArray(selected)&&0!=selected.length&&(row=selected[0]);if(selected=this.getViewModel()){var previousSelectionModel=selected.get('nestedGrid.selectedRowSelModel');null!=previousSelectionModel&&previousSelectionModel!=sender&&previousSelectionModel.deselectAll(!0);selected.set('nestedGrid.selectedRow',row);selected.set('nestedGrid.selectedRowSelModel',
sender);Ext.isEmpty(me.parentNestedGrid)?this.fireViewEvent('nestedSelectionChanged',row,eOpts):me.parentNestedGrid.fireEvent('nestedSelectionChanged',me,row,eOpts)}},onResize:function(sender){sender=sender.headerCt.items.first();if(!Ext.isEmpty(sender)&&void 0!==sender.innerCls&&'x-grid-cell-inner-row-expander'===sender.innerCls){sender.setFlex(null);var colWidth=24;switch(Ext.theme.name){case 'Triton':case 'NeptuneTouch':case 'CrispTouch':colWidth=32}sender.setMinWidth(colWidth);sender.setMaxWidth(colWidth)}},
onToggleRows:function(){this.rowExpanded?this.collapseRows():this.expandRows()},expandAllGrids:function(){this.expandRows();Ext.Function.defer(this.expandNestedGrids,300,this)},collapseAllGrids:function(){this.collapseRows();Ext.Function.defer(this.collapseNestedGrids,300,this)},collapseRows:function(){var view=this.getView();if(view.plugins&&view.plugins.length){var plugin=view.plugins[0];view=view.getStore();for(var nodes=plugin.view.getNodes(),i=0;i<nodes.length;i++)!0!==Ext.fly(nodes[i]).hasCls(plugin.rowCollapsedCls)&&
plugin.toggleRow(i,view.getAt(i));this.rowExpanded=!1}},expandRows:function(){var view=this.getView();if(view.plugins&&view.plugins.length){var plugin=view.plugins[0];view=view.getStore();for(var nodes=plugin.view.getNodes(),i=0;i<nodes.length;i++){var node=Ext.fly(nodes[i]);!0===node.hasCls(plugin.rowCollapsedCls)&&node.query('div .x-grid-row-expander').length&&plugin.toggleRow(i,view.getAt(i))}this.rowExpanded=!0}},expandNestedGrids:function(){var view=this.getView();Ext.ComponentQuery.query(view.xtype+
'[id\x3d'+view.id+'] '+view.xtype).forEach(function(grid){return grid.getController().expandRows()})},collapseNestedGrids:function(){var view=this.getView();Ext.ComponentQuery.query(view.xtype+'[id\x3d'+view.id+'] '+view.xtype).forEach(function(grid){return grid.getController().collapseRows()})}});
Ext.define('Grid.nestedGrid.View',{extend:Grid.baseGrid.View,xtype:'grid-nestedgrid-view',controller:'grid-nestedgrid-ctrl',viewModel:'grid-nestedgrid-vm',subGridCfg:{childCfg:null,subChildCfg:null},config:{childCfg:null,subChildCfg:null},_cfg_example:{childCfg:{columns:[],defaultColCfg:null,nestedStoreName:'',showToolbar:!0,applyCfg:null,bindCfg:null},subChildCfg:null},listeners:{selectionchange:'onSelectionChanged',resize:{fn:'onResize',single:!0}},viewConfig:{markDirty:!1,listeners:{expandbody:function(rowNode,
record,expandRow,eOpts){rowNode=this.up('grid-nestedgrid-view').getPlugin('panel_row_widget').getWidget(this,record);(expandRow=rowNode.down('grid'))&&rowNode&&'function'===typeof record[rowNode.getStoreName()]&&expandRow.setStore(record[rowNode.getStoreName()]())}}},cfgForDockedItems:[{xtype:'toolbar',bind:{hidden:'{!firstNestedPanel.showToolbar}'},dock:'left',items:[{iconCls:I.VerticalArrows,scale:'small',handler:'onToggleRows'}]}],initComponent:function(){console.warn(this.subGridCfg,this);if(Ext.isEmpty(this.subGridCfg)){var childCfg=
this.config.childCfg;var nestedCntItem=this.config.subChildCfg}else childCfg=this.subGridCfg.childCfg,nestedCntItem=this.subGridCfg.subChildCfg;console.log(childCfg,nestedCntItem,this.config,this.subGridCfg);Ext.isEmpty(nestedCntItem)?nestedCntItem={xtype:'grid-basegrid-view',columns:childCfg.columns,defaultColCfg:childCfg.defaultColCfg,defaultListenerScope:!0,viewModel:{data:null},viewConfig:{markDirty:!1,listeners:{resize:function(sender){return sender.updateLayout()},selectionchange:function(sender,
selection,eOpts){this.lookupController(!0).onSelectionChanged(sender,selection,eOpts)}}},onSelectionChanged:this.onSelectionChanged,bind:{store:'{record.'+childCfg.nestedStoreName+'}'}}:(nestedCntItem.showToolbar=!1,nestedCntItem={xtype:'grid-nestedgrid-view',title:childCfg.title,columns:childCfg.columns,defaultColCfg:childCfg.defaultColCfg,viewModel:{data:null},bind:{store:'{record.'+childCfg.nestedStoreName+'}'},parentNestedGrid:this,dockedItems:this.cfgForDockedItems,subGridCfg:{childCfg:nestedCntItem}},
Ext.isEmpty(this.bbar)&&(this.bbar={xtype:'pagingtoolbar',displayInfo:!0}));Ext.isEmpty(childCfg.applyCfg)||Ext.applyIf(nestedCntItem,childCfg.applyCfg);Ext.isEmpty(childCfg.bindCfg)||Ext.applyIf(nestedCntItem.bind,childCfg.bindCfg);this.plugins=[Ext.create('Ext.grid.plugin.RowWidget',{id:'panel_row_widget',widget:{xtype:'grid-nestedgrid-panel-view',layout:'fit',storeName:childCfg.nestedStoreName,bind:{record:'{record}'},showToolbar:null==childCfg.showToolbar?!1:childCfg.showToolbar,items:nestedCntItem},
getHeaderConfig:function(){var defaultIconColumnCfg=this.superclass.getHeaderConfig.apply(this,arguments);defaultIconColumnCfg.renderer=function(value,gridcell,record){value=0;try{if(Ext.isEmpty(record[childCfg.nestedStoreName]))return null;value=record[childCfg.nestedStoreName]().data.length}catch(e){console.error('nested grid error',e,record)}if(0!=value)return'\x3cdiv class\x3d"'+Ext.baseCSSPrefix+'grid-row-expander" role\x3d"presentation" tabIndex\x3d"0"\x3e\x3c/div\x3e'};return defaultIconColumnCfg}})];
this.callParent(arguments)},onToggleRows:function(){this.rowExpanded?this.collapseRows():this.expandRows()},expandAllGrids:function(){this.expandRows();Ext.Function.defer(this.expandNestedGrids,300,this)},collapseAllGrids:function(){this.collapseRows();Ext.Function.defer(this.collapseNestedGrids,300,this)},collapseRows:function(){if(this.plugins&&this.plugins.length){for(var plugin=this.plugins[0],store=this.getStore(),nodes=plugin.view.getNodes(),i=0;i<nodes.length;i++)!0!==Ext.fly(nodes[i]).hasCls(plugin.rowCollapsedCls)&&
plugin.toggleRow(i,store.getAt(i));this.rowExpanded=!1}},expandRows:function(){if(this.plugins&&this.plugins.length){for(var plugin=this.plugins[0],store=this.getStore(),nodes=plugin.view.getNodes(),i=0;i<nodes.length;i++){var node=Ext.fly(nodes[i]);!0===node.hasCls(plugin.rowCollapsedCls)&&node.query('div .x-grid-row-expander').length&&plugin.toggleRow(i,store.getAt(i))}this.rowExpanded=!0}},expandNestedGrids:function(){Ext.ComponentQuery.query(this.xtype+'[id\x3d'+this.id+'] '+this.xtype).forEach(function(grid){return grid.expandRows()})},
collapseNestedGrids:function(){Ext.ComponentQuery.query(this.xtype+'[id\x3d'+this.id+'] '+this.xtype).forEach(function(grid){return grid.collapseRows()})},goToLastPage:function(){var pageToolbar=this.down('pagingtoolbar');pageToolbar&&pageToolbar.moveLast()}});Ext.define('Grid.nestedGrid.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.grid-nestedgrid-vm',data:{nestedGrid:{selectedRow:null,selectedRowSelModel:null}}});
Ext.define('Grid.nestedGrid.panel.View',{extend:Ext.panel.Panel,xtype:'grid-nestedgrid-panel-view',defaultListenerScope:!0,layout:'fit',config:{record:null,storeName:null,showToolbar:!1},publishes:['record','showToolbar'],listeners:{resize:{fn:function(sender){return sender.setWidth('100%')}}},initComponent:function(){this.callParent(arguments)}});
Ext.define('Grid.searchGrid.View',{extend:Ext.grid.Panel,xtype:'grid-searchgrid-view',reference:'searchgrid',searchValue:null,matches:[],currentIndex:null,searchRegExp:null,caseSensitive:!1,regExpMode:!1,matchCls:'x-livesearch-match',defaultStatusText:'Ничего не найдено!',enableColumnMove:!1,columnLines:!0,defaultColCfg:{style:{textAlign:'center'},align:'center',cellWrap:!0,menuDisabled:!0,sortable:!1,flex:1},viewConfig:{markDirty:!1,emptyText:'Нет записей!',getRowClass:function(record,rowIndex,rowParams,
store){if(record.get('is_deleted'))return'row-deleted'}},selModel:{selType:'rowmodel',mode:'SINGLE'},initComponent:function(){this.tbar=['Поиск:',{xtype:'textfield',name:'searchField',overflow:'auto',margin:'10px,0,10px,0',cls:'icon-textfield fa fa-search',hideLabel:!0,width:200,listeners:{change:{fn:this.onTextFieldChange,scope:this,buffer:500}}},'-',{xtype:'button',width:50,text:'\x26lt;',tooltip:'Найти предыдущую строку',handler:this.onPreviousClick,scope:this},{xtype:'button',width:50,text:'\x26gt;',
tooltip:'Найти следующую строку',handler:this.onNextClick,scope:this}];if(!Ext.isEmpty(this.defaultColCfg))for(var i=0;i<this.columns.length;i++)Ext.applyIf(this.columns[i],this.defaultColCfg);this.bbar={xtype:'pagingtoolbar',displayInfo:!0};this.callParent(arguments)},afterRender:function(){this.callParent(arguments);this.textField=this.down('textfield[name\x3dsearchField]');this.view.on('cellkeydown',this.focusTextField,this)},focusTextField:function(view,td,cellIndex,record,tr,rowIndex,e,eOpts){e.getKey()===
e.S&&(e.preventDefault(),this.textField.focus())},tagsRe:/<[^>]*>/gm,tagsProtect:'',getSearchValue:function(){var value=this.textField.getValue();if(''===value)return null;if(this.regExpMode){try{new RegExp(value)}catch(error){return null}if('^'===value||'$'===value)return null}else value=Ext.String.escapeRegex(value);return value},onTextFieldChange:function(){var me=this,count=0,view=me.view,columns=me.visibleColumnManager.getColumns();view.refresh();me.searchValue=me.getSearchValue();me.matches=
[];me.currentIndex=null;null!==me.searchValue&&(me.searchRegExp=new RegExp(me.getSearchValue(),'g'+(me.caseSensitive?'':'i')),me.store.each(function(record,idx){var node=view.getNode(record);node&&Ext.Array.forEach(columns,function(column){var cell=Ext.fly(node).down(column.getCellInnerSelector(),!0),seen;if(cell){var matches=cell.innerHTML.match(me.tagsRe);var cellHTML=cell.innerHTML.replace(me.tagsRe,me.tagsProtect);cellHTML=cellHTML.replace(me.searchRegExp,function(m){++count;seen||(me.matches.push({record:record,
column:column}),seen=!0);return'\x3cspan class\x3d"'+me.matchCls+'"\x3e'+m+'\x3c/span\x3e'},me);Ext.each(matches,function(match){cellHTML=cellHTML.replace(me.tagsProtect,match)});cell.innerHTML=cellHTML}})},me),count&&(me.currentIndex=0,me.gotoCurrent()));null===me.currentIndex&&(me.getSelectionModel().deselectAll(),me.textField.focus())},onPreviousClick:function(){var len=this.matches.length,idx=this.currentIndex;len&&(this.currentIndex=0===idx?len-1:idx-1,this.gotoCurrent())},onNextClick:function(){var len=
this.matches.length,idx=this.currentIndex;len&&(this.currentIndex=idx===len-1?0:idx+1,this.gotoCurrent())},caseSensitiveToggle:function(checkbox,checked){this.caseSensitive=checked;this.onTextFieldChange()},regExpToggle:function(checkbox,checked){this.regExpMode=checked;this.onTextFieldChange()},privates:{gotoCurrent:function(){var pos=this.matches[this.currentIndex];this.getSelectionModel().select(pos.record)}}});
Ext.define('Ext.ux.DateTimeField',{extend:Ext.form.field.Date,alias:'widget.datetimefield',format:'d.m.Y H:i',invalidText:'Ошибка формата. Правильный формат: дд.мм.гггг чч:ММ',altFormats:'d/m/Y H:i:s|c',width:270,collapseIf:function(e){var picker=this.picker;picker.timePicker&&!e.within(picker.timePicker.el,!1,!0)&&this.callParent([e])},createPicker:function(){var parentPicker=this.callParent(),parentConfig=Ext.clone(parentPicker.initialConfig),initialConfig=Ext.clone(this.initialConfig),excludes=
['renderTo','width','height','bind','reference'];parentPicker.destroy();for(parentPicker=0;parentPicker<excludes.length;parentPicker++)initialConfig.hasOwnProperty([excludes[parentPicker]])&&delete initialConfig[excludes[parentPicker]];return Ext.create('Ext.ux.DateTimePicker',Ext.merge(initialConfig,parentConfig))},getErrors:function(value){value=0<arguments.length?value:this.formatDate(this.processRawValue(this.getRawValue()));var format=Ext.String.format,errors=this.superclass.superclass.getErrors.apply(this,
arguments),disabledDays=this.disabledDays,disabledDatesRE=this.disabledDatesRE,minValue=this.minValue,maxValue=this.maxValue,len=disabledDays?disabledDays.length:0,i=0;if(null===value||1>value.length)return errors;var svalue=value;value=this.parseDate(value);if(!value)return errors.push(format(this.invalidText,svalue,Ext.Date.unescapeFormat(this.format))),errors;svalue=value.getTime();minValue&&svalue<minValue.getTime()&&errors.push(format(this.minText,this.formatDate(minValue)));maxValue&&svalue>
maxValue.getTime()&&errors.push(format(this.maxText,this.formatDate(maxValue)));if(disabledDays)for(minValue=value.getDay();i<len;i++)if(minValue===disabledDays[i]){errors.push(this.disabledDaysText);break}disabledDays=this.formatDate(value);disabledDatesRE&&disabledDatesRE.test(disabledDays)&&errors.push(format(this.disabledDatesText,disabledDays));return errors},getRefItems:function(){var result=this.callParent();this.picker&&this.picker.timePicker&&result.push(this.picker.timePicker);return result},
onExpand:function(){this.callParent();this.picker&&this.picker.timePicker&&this.picker.alignTimePicker()}});
Ext.define('Ext.ux.DateTimePicker',{extend:Ext.picker.Date,alias:'widget.datetimepicker',todayText:'Сегодня',hourText:'Часы',minuteText:'Мин.',initEvents:function(){var me=this,eDate=Ext.Date,day=eDate.DAY;Ext.apply(me.keyNavConfig,{up:function(e){e.ctrlKey?e.shiftKey?me.minuteSlider.setValue(me.minuteSlider.getValue()+1):me.showNextYear():e.shiftKey?me.hourSlider.setValue(me.hourSlider.getValue()+1):me.update(eDate.add(me.activeDate,day,-7))},down:function(e){e.ctrlKey?e.shiftKey?me.minuteSlider.setValue(me.minuteSlider.getValue()-
1):me.showPrevYear():e.shiftKey?me.hourSlider.setValue(me.hourSlider.getValue()-1):me.update(eDate.add(me.activeDate,day,7))}});me.callParent()},initComponent:function(){var me=this;'string'===typeof me.value?me.value=Ext.Date.parse(me.value,me.format):me.value||(me.value=new Date);var dtAux=me.value;dtAux.setSeconds(0);me.timeFormat=-1!==me.format.indexOf('h')?'h':'H';me.hourSlider=new Ext.slider.Single(Ext.Object.merge({fieldLabel:me.hourText,labelAlign:'top',labelSeparator:' ',padding:'0 0 10 17',
focusable:!1,value:0,minValue:0,maxValue:23,vertical:!0,tipText:function(thumb){thumb=thumb.value;return'H'===me.timeFormat?thumb||'0':thumb&&0>=thumb-12?thumb:Math.abs(thumb-12)}},me.hourSliderConfig));me.minuteSlider=new Ext.slider.Single(Ext.Object.merge({fieldLabel:me.minuteText,labelAlign:'top',labelSeparator:' ',padding:'0 10 10 0',focusable:!1,value:0,increment:1,minValue:0,maxValue:59,vertical:!0},me.minuteSliderConfig));me.timePicker=new Ext.panel.Panel(Ext.Object.merge({layout:{type:'hbox',
align:'stretch'},border:!1,defaults:{flex:1},width:130,floating:!0,dockedItems:[{xtype:'toolbar',dock:'top',ui:'footer',items:['-\x3e',{xtype:'label',style:'font-weight: bold;',text:'h'==me.timeFormat?'12:00 AM':'00:00'},'-\x3e']}],items:[me.hourSlider,me.minuteSlider],onMouseDown:function(e){e.preventDefault()}},me.timePickerConfig));me.callParent();me.ownerCt=me.up('[floating]');me.timePicker.ownerCt=me.ownerCt;me.registerWithOwnerCt();me.timePicker.registerWithOwnerCt();me.setValue(new Date(dtAux));
me.hourSlider.addListener('change',me.changeTimeValue,me);me.minuteSlider.addListener('change',me.changeTimeValue,me)},handleTabClick:function(e){this.handleDateClick(e,this.activeCell.firstChild,!0)},getSelectedDate:function(date){date=Ext.Date.clearTime(date,!0).getTime();var cells=this.cells,cellItems=cells.elements,cLen=cellItems.length,c;cells.removeCls(this.selectedCls);for(c=0;c<cLen;c++)if(cells=cellItems[c].firstChild,cells.dateValue===date)return cells;return null},changeTimeValue:function(slider){var label=
this.timePicker.down('label'),minutePrefix=10>this.minuteSlider.getValue()?'0':'',hourDisplay=this.hourSlider.getValue(),pickerValue;if('h'==this.timeFormat){var timeSufix=12>this.hourSlider.getValue()?' AM':' PM';hourDisplay=(hourDisplay=13>this.hourSlider.getValue()?hourDisplay:hourDisplay-12)||'12'}label.setText((10>hourDisplay?'0':'')+hourDisplay+':'+minutePrefix+this.minuteSlider.getValue()+(timeSufix||''));this.pickerField&&(pickerValue=this.pickerField.getValue())&&(slider=new Date(pickerValue[slider==
this.hourSlider?'setHours':'setMinutes'](slider.getValue())),this.pickerField.setValue(slider),this.pickerField.fireEvent('select',this.pickerField,slider))},afterShow:function(animateTarget,callback,scope){this.callParent([animateTarget,callback,scope]);this.timePicker.show();animateTarget=this.timePicker.down('toolbar').getEl();'transparent'==animateTarget.getStyle('background-color')&&animateTarget.setStyle('background-color',animateTarget.getStyle('border-color'))},afterSetPosition:function(x,
y){this.callParent([x,y]);this.alignTimePicker()},alignTimePicker:function(){var el=this.el,alignTo=this.getTimePickerSide(),xPos='tl'==alignTo?-1*this.timePicker.getWidth()-5:5;this.timePicker.setHeight(el.getHeight());this.timePicker.showBy(this,alignTo,[xPos,0])},onHide:function(){this.timePicker.hide();this.callParent()},beforeDestroy:function(){this.rendered&&Ext.destroy(this.timePicker,this.minuteSlider,this.hourSlider);this.callParent()},getTimePickerSide:function(){var el=this.el;return Ext.getBody().getViewSize().width<
el.getX()+el.getWidth()+140?'tl':'tr'},setValue:function(value){value=value||new Date;value.setSeconds(0);this.value=new Date(value);return this.update(this.value)},selectToday:function(){var btn=this.todayBtn,handler=this.handler,auxDate=new Date;btn&&!btn.disabled&&(this.setValue(new Date(auxDate.setSeconds(0))),this.fireEvent('select',this,this.value),handler&&handler.call(this.scope||this,this,this.value),this.onSelect());return this},handleDateClick:function(e,t,blockStopEvent){var handler=this.handler,
hourSet=this.timePicker.items.items[0].getValue(),minuteSet=this.timePicker.items.items[1].getValue(),auxDate=new Date(t.dateValue);!0!==blockStopEvent&&e.stopEvent();this.disabled||!t.dateValue||Ext.fly(t.parentNode).hasCls(this.disabledCellCls)||(this.doCancelFocus=!1===this.focusOnSelect,auxDate.setHours(hourSet,minuteSet,0),this.setValue(new Date(auxDate)),delete this.doCancelFocus,this.fireEvent('select',this,this.value),handler&&handler.call(this.scope||this,this,this.value),this.onSelect())},
selectedUpdate:function(date){date=Ext.Date.clearTime(date,!0);this.callParent([date]);this.updateSliders()},fullUpdate:function(date){date=Ext.Date.clearTime(date,!0);this.callParent([date]);this.updateSliders()},updateSliders:function(){var currentDate=this.pickerField&&this.pickerField.getValue()||new Date;this.timePicker.rendered&&(this.hourSlider.setValue(currentDate.getHours()),this.minuteSlider.setValue(currentDate.getMinutes()))}});
Ext.define('Field.chooseField.Ctrl',{extend:Ext.app.ViewController,alias:'controller.field-choosefield-ctrl',onChooseBtnClick:function(){this.showChooseWnd()},showChooseWnd:function(){var view=this.getView(),wndCfg=view.getChooseWndCfg();console.log('chooseWnd CFG',wndCfg);if(null==wndCfg)Ext.Msg.alert('Not configured!','Need chooseWndCfg');else{var currentValue=view.lookupReference('text_field').getValue();currentValue={fieldLabel:view.fieldLabel,selectedId:currentValue,addWndCfg:wndCfg.addWndCfg,
filterPropertyName:wndCfg.filterPropertyName,showSearchPane:wndCfg.showSearchPane,showPageToolbar:wndCfg.showPageToolbar,canAddNew:!Ext.isEmpty(wndCfg.addWndCfg)&&wndCfg.canAddNew,customStore:view.getChooseWndCustomStore(),gridColumns:wndCfg.gridColumns,width:wndCfg.width?wndCfg.width:600};Ext.isEmpty(wndCfg.title)||(currentValue.title=wndCfg.title);currentValue=Ext.create('Window.chooseWindow.View',currentValue);console.log(wndCfg,currentValue);Ext.isEmpty(view.getChooseWndCustomStore())&&(view=
currentValue.getViewModel().getStore('gridStore'),view.addFilter(wndCfg.storeFilters),view.getProxy().setUrl(wndCfg.proxyUrl),view.setModel(wndCfg.storeModel),currentValue.lookupReference('grid').reconfigure(null,wndCfg.gridColumns),view.load());currentValue.show();currentValue.on('beforeclose',this.onWndBeforeClose,this)}},updateHiddenDataField:function(textField,record){this.preventUpdateChooseField=!0;var view=this.getView(),dataHiddenField=view.lookupReference('hidden_field_for_data'),getDataValueFunc=
view.getCustomHiddenFieldForDataCfg().getDataValueForChooseField,dataValue=null;record&&(dataValue=getDataValueFunc(view,dataHiddenField,textField,record));console.log('#@# updateHiddenDataField',dataValue);dataHiddenField.setValue(dataValue);this.preventUpdateChooseField=!1},onChangeHiddenDataField:function(sender,newValue,oldValue,eOpts){console.log('####  onChangeHiddenDataField',this.preventUpdateChooseField);this.preventUpdateChooseField||(oldValue=this.getView(),newValue=sender.getValue(),oldValue=
oldValue.lookupReference('text_field'),oldValue.setValue(newValue),console.log('####  onChangeHiddenDataField',newValue,oldValue,sender))},onWndBeforeClose:function(wnd){if(wnd.wasSaved()){var view=this.getView();wnd=wnd.getSelectedRecord();var textField=view.lookupReference('text_field'),data=Ext.isEmpty(wnd)?null:wnd.data;textField.setValue(data);if(view.getUseHiddenFieldForDirectSubmit()){var value=null;data&&(value=data[textField.getValueDataField()]);view.lookupReference('hidden_value_field').setValue(value)}view.getCustomHiddenFieldForDataCfg()&&
this.updateHiddenDataField(textField,wnd)}}});
Ext.define('Field.chooseField.Model',{extend:Ext.data.Model,fields:[{name:'id',type:'int'},{name:'is_deleted',type:'boolean',persist:!1},{name:'archival',type:'boolean',persist:!1},{name:'created_by',persist:!1},{name:'modified_by',persist:!1},{name:'created_at',type:'date',dateReadFormat:FORMAT_CFG.READ_DATE,persist:!1},{name:'modified_at',type:'date',dateReadFormat:FORMAT_CFG.READ_DATE,persist:!1},{name:'tip_spravochnika',type:'int'},{name:'short_name',type:'string'},{name:'name',type:'string'}],
proxy:{type:'common-restproxy',url:'api/dir/dirbase/'},isDeleted:function(){this.get('is_deleted')}});
Ext.define('Field.chooseField.View',{extend:Ext.form.FieldContainer,xtype:'field-choosefield-view',controller:'field-choosefield-ctrl',layout:'hbox',config:{fieldCfg:null,customHiddenFieldForDataCfg:null,customHiddenFieldForDataCfg_EXAMPLE:{fieldCfg:{name:'kem_vydana_rezoljucija_nested'},getDataValueForChooseField:function(chooseField,hiddenField,textField,value){return value}},useHiddenFieldForDirectSubmit:!1,chooseWndCustomStore:null,chooseWndCfg:null,chooseWndCfg_EXAMPLE:{customStore:null,gridColumns:[{text:'Краткое наименование',
dataIndex:'short_name',flex:1},{text:'Наименование',dataIndex:'name',flex:1}],proxyUrl:'api/dir/dirbase/',storeModel:'Field.chooseField.Model',storeFilters:[{property:'tip_spravochnika',value:2}],canAddNew:!1,addWndCfg:null}},setFieldNullValue:function(){this.lookupReference('text_field').setValue(null)},initComponent:function(){var textFieldCfg={};Ext.apply(textFieldCfg,this.config.fieldCfg);textFieldCfg.xtype='field-displayfield-view';textFieldCfg.readOnly=!0;textFieldCfg.flex=1;textFieldCfg.reference=
'text_field';textFieldCfg.model=this.config.chooseWndCfg.storeModel;var fieldName=textFieldCfg.name;this.config.useHiddenFieldForDirectSubmit&&(delete textFieldCfg.name,textFieldCfg.submitValue=!1);this.items=[textFieldCfg,{xtype:'button',iconCls:'x-fa fa-edit',handler:'onChooseBtnClick',tooltip:'Редактировать'}];this.config.useHiddenFieldForDirectSubmit&&this.items.push({xtype:'hiddenfield',name:fieldName,reference:'hidden_value_field'});this.config.customHiddenFieldForDataCfg&&(textFieldCfg=this.config.customHiddenFieldForDataCfg.fieldCfg,
Ext.apply(textFieldCfg,{xtype:'hidden-data-field',reference:'hidden_field_for_data',listeners:{change:'onChangeHiddenDataField'}}),this.items.push(textFieldCfg));this.callParent(arguments)}});
Ext.define('Field.displayField.View',{extend:Ext.form.field.Text,xtype:'field-displayfield-view',initComponent:function(){this.callParent(arguments)},config:{customFieldData:null,displayDataField:null,displayFieldRenderer:null,valueDataField:'id',model:null},getValue:function(){var customData=this.getCustomFieldData();console.log('get value custom data',customData);isNaN(customData)&&(customData=customData[this.getValueDataField()]);return customData},rawToValue:function(rawValue){console.warn('Это преобразование (rawToValue) не нужно...',
rawValue)},setValue:function(value){console.log('field set value',value);this.setCustomFieldData(value);this.callSuper(arguments)},setRawValue:function(value){console.log('field set RAW value',value);this.callSuper(arguments)},getDisplayData:function(value){var displayField=this.getDisplayDataField(),displayRenderer=this.getDisplayFieldRenderer();console.log('getDisplayData',displayField,displayRenderer);if(!Ext.isEmpty(displayField))return value[this.getDisplayDataField()];if('function'==typeof displayRenderer)return displayRenderer(value);
console.error('Cannot define display data');return''},valueToRaw:function(value){console.log('valueToRaw',value,isNaN(value));if(Ext.isEmpty(value))return'';if(isNaN(value))return value=this.getDisplayData(value);console.log('start load record');var model=this.getModel();if(Ext.isEmpty(model))return'Ошибка при загрузке справочника...';model=Ext.create(model);model.setId(value);model.load({scope:this,failure:this.onRecLoadFailed,success:this.onRecLoadSuccess});return MSG.DataIsLoading},onRecLoadSuccess:function(record,
operation){console.log('record loaded!');this.setRawValue(this.getDisplayData(record.data));this.validate()},onRecLoadFailed:function(record,operation){this.setRawValue(MSG.COMMON_GET_ERR.msg)}});
Ext.define('Field.hiddenDataField.View',{xtype:'hidden-data-field',extend:Ext.form.field.Hidden,config:{fieldDataAsIs:null},getValue:function(){var result=this.getFieldDataAsIs();this.callSuper(arguments);return result},setValue:function(value){console.log('#### hidden-data-field',value);this.setFieldDataAsIs(value);this.callSuper(arguments)}});
Ext.define('Field.sampleTextField.Controller',{extend:Ext.app.ViewController,alias:'controller.sample-text-field',initViewModel:function(vm){this.textTypeBinding=vm.bind('{textType}',function(textType){textType?vm.set('isOpenEditWindowButtonDisabled',!1):vm.set('isOpenEditWindowButtonDisabled',!0)},this);var view=this.getView();view.sampleTextCfg&&view.sampleTextCfg.url&&view.sampleTextCfg.textType&&view.sampleTextCfg.textTypeString&&(vm.set('textTypeUrl',view.sampleTextCfg.url),vm.set('textType',
view.sampleTextCfg.textType),vm.set('textTypeString',view.sampleTextCfg.textTypeString),vm.set('fieldLabelValue',vm.get('textTypeObj')[view.sampleTextCfg.textType]))},destroyViewBindings:function(){this.textTypeBinding&&(this.textTypeBinding.destroy(),this.textTypeBinding=null)},destroy:function(){this.destroyViewBindings();this.callParent()},onAddButtonClick:function(){var vm=this.getViewModel();Ext.create('Field.sampleTextField.components.addingSampleTextWindow.View',{title:vm.get('textTypeString'),
modal:!0,customConfig:{textType:vm.get('textType'),displayFieldValue:vm.get('textTypeObj')[vm.get('textType')],textTypeUrl:vm.get('textTypeUrl'),parentViewModel:vm}}).show()}});
Ext.define('Field.sampleTextField.View',{extend:Ext.form.FieldContainer,xtype:'sample-text-field',controller:'sample-text-field',viewModel:'sample-text-field',layout:'hbox',initComponent:function(){var textAreaField={xtype:'textarea',reference:'textarea',flex:1,bind:{fieldLabel:'{fieldLabelValue}',value:'{content}'}};Ext.apply(textAreaField,this.sampleTextCfg.fieldCfg);this.items=[textAreaField,{xtype:'button',iconCls:I.Plus,handler:'onAddButtonClick',disabled:!0,bind:{disabled:'{isOpenEditWindowButtonDisabled}'}}];
this.callParent(arguments)}});Ext.define('Field.sampleTextField.ViewModel',{extend:Ext.app.ViewModel,alias:'viewmodel.sample-text-field',data:{name:'',content:'',isOpenEditWindowButtonDisabled:!0,textTypeObj:{1:'Текст поручения',2:'Текст резолюции'}}});
Ext.define('Field.sampleTextField.components.addingSampleTextWindow.Controller',{extend:Ext.app.ViewController,alias:'controller.adding-sample-text-window',initViewModel:function(vm$jscomp$0){var view=vm$jscomp$0.getView(),parentViewModel=view.customConfig.parentViewModel;vm$jscomp$0.set('textType',view.customConfig.textType);vm$jscomp$0.set('displayFieldValue',view.customConfig.displayFieldValue);vm$jscomp$0.set('textTypeUrl',view.customConfig.textTypeUrl);vm$jscomp$0.set('parentViewModel',parentViewModel);
this.contentBinding=parentViewModel.bind('{content}',function(content){var vm=this.getViewModel();content&&vm.set('isCreateButtonDisabled',!1)},this)},destroyViewBindings:function(){this.contentBinding&&(this.contentBinding.destroy(),this.contentBinding=null)},destroy:function(){this.destroyViewBindings();this.callParent()},onCancelButtonClick:function(){this.getView().close()},onInsertButtonClick:function(){var vm=this.getViewModel(),selectedRecord=vm.get('selectedRecord');vm=vm.get('parentViewModel');
var content=vm.get('content');content&&(content+='\n');content+=selectedRecord.get('text');vm.set('content',content);this.getView().close()},onCreateButtonClick:function(){var vm=this.getViewModel();Ext.create('Window.addEditTextWindow.View',{xtype:'creating-sample-texts-window',title:'Cоздание типового тектса',width:600,height:300,customConfig:{selectedRecord:vm.get('selectedRecord'),textTypeUrl:vm.get('textTypeUrl'),textType:vm.get('textType'),store:vm.getStore('samples'),mode:'add'}}).show()},
onFindFieldChange:function(field,value){field=this.getViewModel();''===value?field.set('isClearButtonDisabled',!0):field.set('isClearButtonDisabled',!1)},onClearButtonClick:function(){this.getViewModel().set('findFieldValue','')}});
Ext.define('Field.sampleTextField.components.addingSampleTextWindow.View',{extend:Ext.window.Window,xtype:'adding-sample-text-window',width:600,height:500,controller:'adding-sample-text-window',viewModel:'adding-sample-text-window',layout:'fit',dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'button',text:'Вставить',iconCls:I.Paste,disabled:!0,bind:{disabled:'{!selectedRecord}'},handler:'onInsertButtonClick'},{xtype:'button',text:'Отмена',iconCls:I.Remove,handler:'onCancelButtonClick'},'-\x3e',
{xtype:'button',text:'Создать',iconCls:I.Plus,handler:'onCreateButtonClick'}]}],items:[{xtype:'container',layout:{type:'vbox',align:'stretch'},items:[{xtype:'displayfield',fieldLabel:'Тип',labelWidth:50,margin:'10 0 0 10',bind:{value:'{displayFieldValue}'}},{xtype:'container',margin:'10 0 0 10',layout:{type:'hbox',align:'left'},items:[{xtype:'textfield',fieldLabel:'Поиск',labelWidth:50,listeners:{change:'onFindFieldChange'},bind:{value:'{findFieldValue}'}},{xtype:'button',text:'Очистить',margin:'0 0 0 20',
handler:'onClearButtonClick',disabled:!0,bind:{disabled:'{isClearButtonDisabled}'}}]},{xtype:'grid',selModel:{type:'checkboxmodel',mode:'SINGLE',allowDeselect:!0},flex:1,margin:'10 0 0 0',columns:[{xtype:'templatecolumn',text:'Текст',tpl:'{text}',flex:1}],bind:{store:'{samples}',selection:'{selectedRecord}'},bbar:{xtype:'pagingtoolbar',displayInfo:!0}}]}]});
Ext.define('Field.sampleTextField.components.addingSampleTextWindow.ViewModel',{extend:Ext.app.ViewModel,alias:'viewmodel.adding-sample-text-window',data:{typeText:null,textTypeUrl:null,textTypeString:null,findFieldValue:null,selectedRecord:void 0,isCreateButtonDisabled:!0,isWindowShouldNotBeClosed:!0,isClearButtonDisabled:!0},stores:{samples:{type:'common-simplelist',pageSize:GRIDS_CFG.PageSize,autoLoad:!0,proxy:{url:'{textTypeUrl}'},remoteFilter:!0,filters:[{property:'text',value:'{findFieldValue}'},
{property:'tip',value:'{textType}'}]}}});
Ext.define('Field.simpleTextArea.Ctrl',{extend:Ext.app.ViewController,alias:'controller.simpletextarea-ctrl',onAddWindow:function(){var view=this.getView();view=Ext.create('Field.simpleTextArea.window.View',{tipTeksti:view.getTipTeksti(),addUrl:view.getAddUrl()});view.show();view.on('beforeclose',this.onWndBeforeClose,this)},onWndBeforeClose:function(sender){(sender=sender.getViewModel().get('content'))&&this.insertTextToField(sender)},insertTextToField:function(text){var htmlInputEl=this.getView().lookupReference('text_area').inputEl.dom;
if(document.selection)htmlInputEl.focus(),sel=document.selection.createRange(),sel.text=text;else if(htmlInputEl.selectionStart||'0'==htmlInputEl.selectionStart){var endPos=htmlInputEl.selectionEnd;htmlInputEl.value=htmlInputEl.value.substring(0,htmlInputEl.selectionStart)+text+htmlInputEl.value.substring(endPos,htmlInputEl.value.length)}else htmlInputEl.value+=text}});
Ext.define('Field.simpleTextArea.View',{extend:Ext.form.FieldContainer,xtype:'simpletextarea-view',layout:'hbox',viewModel:'simpletextarea-vm',controller:'simpletextarea-ctrl',config:{tipTeksti:null,addUrl:null},initComponent:function(){var textAreaField={xtype:'textarea',reference:'text_area',flex:1};Ext.apply(textAreaField,this.fieldCfg);console.log('textAreaField',textAreaField,this);this.items=[textAreaField,{xtype:'button',iconCls:I.Plus,handler:'onAddWindow'}];this.callParent(arguments)}});
Ext.define('Field.simpleTextArea.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.simpletextarea-vm',data:{fieldLabelValue:null,selectedRecord:null}});
Ext.define('Field.simpleTextArea.window.Ctrl',{extend:Ext.app.ViewController,alias:'controller.simpletextarea-window-ctrl',onSelectClick:function(sender){this.getView().close()},onCancelClick:function(){var view=this.getView();this.getViewModel().set('content',null);view.close()},onGridSelectionChanged:function(sender,selected,eOpts){sender=this.getViewModel();Ext.isEmpty(selected)||(selected=selected[0],sender.set('selectedRecord',selected),sender.set('content',sender.get('selectedRecord').get('text')))},
onGridStoreLoad:function(sender,records,successful,operation,eOpts){sender=this.getViewModel();console.log(records);sender.set('isEmptyGrid',0==records.length)},onAddClick:function(sender){sender=this.getViewModel();sender={layout:{type:'vbox',align:'stretch'},modal:!0,scrollable:'vertical',xtype:'window-editwindow-view',title:'Cоздание значения для типового текста',resizable:!1,width:600,height:400,mode:'add',formModel:'Field.simpleTextArea.window.Model',formClass:'simpletextarea-window-form-view',
addBtnCfg:{text:'Создать',iconCls:I.PlusCircle,tooltip:'Создать'},formItemsCustomCfg:{tip:{readOnly:!0,value:sender.get('tipTeksti')}}};sender=Ext.create(sender);sender.show();sender.on('beforeclose',this.onEditWndBeforeClose,this)},onEditWndBeforeClose:function(sender){if(sender.wasSaved()){var store=this.getViewModel().getStore('gridStore');console.log('store',store);store.reload();sender.getMode()}}});
Ext.define('Field.simpleTextArea.window.Model',{extend:Ext.data.Model,fields:[{name:'tip',type:'int'},{name:'text',type:'string'}],proxy:{type:'common-restproxy',url:API_ROOT+'api_v1/refwork/tipovie_teksti/'}});
Ext.define('Field.simpleTextArea.window.View',{extend:Ext.window.Window,xtype:'simpletextarea-window-view',viewModel:'simpletextarea-window-vm',controller:'simpletextarea-window-ctrl',config:{tipTeksti:null,addUrl:null},updateTipTeksti:function(value){this.getViewModel().set('tipTeksti',value)},updateAddUrl:function(value){this.getViewModel().set('addUrl',value)},title:'Окно выбора значения',width:700,height:500,layout:'fit',dockedItems:[{xtype:'toolbar',dock:'top',items:[{xtype:'button',text:'Выбрать',
iconCls:I.CheckCircleO,disabled:!0,bind:{disabled:'{!selectedRecord}'},handler:'onSelectClick'},{xtype:'button',text:'Отмена',iconCls:I.Cancel,handler:'onCancelClick'},'-\x3e',{xtype:'button',text:'Создать',iconCls:I.Plus,handler:'onAddClick'}]}],items:[{xtype:'panel',layout:'fit',dockedItems:[{items:[{xtype:'toolbar',dock:'top',items:[{xtype:'label',text:'Поиск:'},{xtype:'textfield',iconCls:I.Search,bind:{value:'{shortQuery}'}},{text:'Очистить',iconCls:I.Broom,bind:{disabled:'{!shortQuery}'},handler:function(sender){sender.lookupViewModel(!0).set('shortQuery',
null)}},'-\x3e',{xtype:'combo',fieldLabel:'Тип текста',labelAlign:'right',labelWidth:120,msgTarget:'under',editable:!1,readOnly:!0,bind:{value:'{tipTeksti}'},store:{type:'common-enumsstore',data:[{id:1,value:'Текст поручения'},{id:2,value:'Текст резолюции'},{id:3,value:'Текст кр. содержания'}]},queryMode:'local',displayField:'value',valueField:'id'}]}]}],items:[{xtype:'grid-basegrid-view',columnLines:!0,flex:3,selModel:{selType:'checkboxmodel',mode:'SINGLE'},bind:{store:'{gridStore}',selection:'{selectedRecord}'},
bbar:{xtype:'pagingtoolbar',displayInfo:!0},reference:'tipovieteksti_grid',defaultColCfg:{align:'left',cellWrap:!0,menuDisabled:!0,sortable:!1,minWidth:100,flex:1,style:DEFAULT_GRID_HEADER_STYLE},columns:[{text:'Текст',dataIndex:'text'}],listeners:{selectionchange:'onGridSelectionChanged'}}]}]});
Ext.define('Field.simpleTextArea.window.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.simpletextarea-window-vm',data:{selectedRecord:null,isEmptyGrid:!0,shortQuery:null,tipTeksti:null,addUrl:null,content:null},stores:{gridStore:{type:'common-simplelist',model:'Field.simpleTextArea.window.Model',proxyUrl:'{addUrl}',listeners:{load:'onGridStoreLoad'},remoteFilter:!0,filters:[{property:'tip',value:'{tipTeksti}'},{property:'short_query',value:'{shortQuery}'}],autoLoad:!0,pageSize:0,limit:0}}});
Ext.define('Field.simpleTextArea.window.form.View',{extend:Ext.form.Panel,xtype:'simpletextarea-window-form-view',reference:'tipovieteksti_form',cls:'fieldlabel-vertical-align',actions:{create:{text:'Создать',handler:'onCreateClick',iconCls:I.PlusCircle,tooltip:'Создать'},edit:{text:'Редактировать',handler:'onEditClick',iconCls:I.Edit,tooltip:'Редактировать данные'},save:{text:'Сохранить',handler:'onSaveClick',iconCls:I.Save,tooltip:'Сохранить изменения'},cancel:{text:'Отмена',handler:'onCancelClick',
iconCls:I.Cancel,tooltip:'Отменить редактирование'}},bodyPadding:10,defaults:{anchor:'100%'},layout:'fit',fieldDefaults:{labelAlign:'right',labelWidth:120,msgTarget:'under'},items:[{xtype:'fieldset',title:'Основное',defaults:{anchor:'100%'},layout:'anchor',defaultType:'textarea',items:[{xtype:'combo',fieldLabel:'Тип текста',name:'tip',editable:!1,readOnly:!0,bind:{value:'{tipTeksti}'},store:{type:'common-enumsstore',data:[{id:1,value:'Текст поручения'},{id:2,value:'Текст резолюции'},{id:3,value:'Текст краткого содержания'}]},
queryMode:'local',displayField:'value',valueField:'id',flex:1},{name:'text',height:150,fieldLabel:'Текст',flex:3}]}]});Ext.override(Ext.Ajax,{timeout:6E4});Ext.override(Ext.data.writer.Json,{getRecordData:function(record,operation){record.data=this.callParent(arguments);record.getAssociatedData(record.data,{serialize:!0});return record.data}});Ext.override('Ext.util.TextMetrics',{bind:function(el){this.el=Ext.get(el);this.measure.setStyle(this.el.getStyle('font-size font-style font-weight padding font-family line-height text-transform letter-spacing word-break white-space'.split(' ')))}});
Ext.override(Ext.grid.feature.Grouping,{expandTip:'Нажмите чтобы развернуть. При зажатой клавише Ctrl сворачиваются все остальные',collapseTip:'Нажмите чтобы свернуть. При зажатой клавише Ctrl сворачиваются все остальные'});Ext.override(Ext.form.RadioGroup,{blankText:'Вы должны выбрать один элемент'});Ext.override(Ext.data.proxy.Proxy,{config:{allowResponseType:!1},updateReader:function(reader){this.callParent([reader]);this.getAllowResponseType()||delete this.responseType}});
Ext.define('Common.BaseModel',{extend:Ext.data.Model,fields:[{name:'id',type:'int'},{name:'archival',type:'boolean',persist:!1},{name:'created_by',persist:!1},{name:'modified_by',persist:!1},{name:'created_at',type:'date',dateReadFormat:FORMAT_CFG.READ_DATE,persist:!1},{name:'modified_at',type:'date',dateReadFormat:FORMAT_CFG.READ_DATE,persist:!1}],proxy:{type:'common-restproxy'}});Ext.define('Common.EnumsStore',{extend:Ext.data.Store,alias:'store.common-enumsstore',fields:['id','value']});
Ext.define('Common.RestProxy',{extend:Ext.data.proxy.Rest,alias:'proxy.common-restproxy',buildUrl:function(request){var operation=request.getOperation(),records=operation.getRecords(),record=records?records[0]:null;records=this.getFormat();var url=this.getUrl(request);record=record&&!record.phantom?record.getId():operation.getId();if(this.getAppendId()&&this.isValidId(record)){url.match(this.slashRe)||(url+='/');url+=encodeURIComponent(record);switch(operation.action){case 'update':case 'read':case 'destroy':url+=
'/'}(operation=request.getParams())&&delete operation[this.getIdParam()]}records&&(url.match(this.periodRe)||(url+='.'),url+=records);request.setUrl(url);return url},getParams:function(operation){var result=this.callSuper(arguments);if(!Ext.isEmpty(result.filter)){var filter=Ext.clone(result.filter);delete result.filter;Ext.apply(result,filter)}return result},encodeSorters:function(sorters){var length=sorters.length,sortStrs=[],i;for(i=0;i<length;i++){var sorter=sorters[i];var direction='DESC'==sorter.getDirection()?
'-':'';sortStrs[i]=direction+sorter.getProperty()}return sortStrs.join(',')},encodeFilters:function(filters){var length=filters.length,filterObj={},i;for(i=0;i<length;i++){var filter=filters[i];filterObj[filter.getProperty()]=filter.getValue()}return filterObj},reader:{type:'json',rootProperty:'data',messageProperty:'detail'},writer:{type:'json',messageProperty:'detail',writeAllFields:!0}});
Ext.define('Common.SimpleList',{extend:Ext.data.Store,alias:'store.common-simplelist',pageSize:0,limit:0,remoteSort:!1,autoLoad:!1,config:{proxyUrl:'',extraParams:null},updateExtraParams:function(value){Ext.isEmpty(value)||this.getProxy().setExtraParams(this.getExtraParams())},updateProxyUrl:function(value){Ext.isEmpty(value)||(this.getProxy().setUrl(value),this.autoLoad&&this.load())},proxy:{type:'common-restproxy',sortParam:'ordering',reader:{messageProperty:'detail',rootProperty:'data'}}});
Ext.define('Common.print.Ctrl',{extend:Ext.app.ViewController,alias:'controller.common-print-ctrl',onDownloadClick:function(sender){sender=this.getViewModel();window.open(sender.get('odtUrl')+sender.get('params'))},onPrintClick:function(sender){-1<navigator.userAgent.toLowerCase().indexOf('firefox')?($('body').append('\x3ciframe id\x3d"firefox-pdf-iframe" src\x3d"/download_pdf" style\x3d"display:none"\x3e\x3c/iframe\x3e'),$('#firefox-pdf-iframe').load(function(){document.getElementById('firefox-pdf-iframe').contentWindow.print()})):
document.querySelector('iframe').contentWindow.print()},setReport:function(reportUrl){var view=this.getView();reportUrl=Ext.create({xtype:'component',width:'100%',height:'100%',html:'\x3ciframe src\x3d"'+reportUrl+'" type\x3d"application/pdf" id\x3d"pdfDocument" width\x3d"100%" height\x3d"500px"\x3e\x3c/iframe\x3e'});view.add(reportUrl)},showReport:function(scope,apiUrl){this.getView();this.requestId=Ext.Ajax.request({url:apiUrl,timeout:6E4,method:'GET',success:this.onGetDocSuccess,failure:this.onGetDocFailure,
scope:this});var ctrl=this;this.waitMsgBox=Ext.MessageBox.show({msg:'Формирование документа',progressText:'Идет формирование документа...',buttons:Ext.MessageBox.CANCEL,fn:function(btn){ctrl.abortPrintRequest(apiUrl,ctrl.task_id)},width:300,wait:{interval:200}})},abortPrintRequest:function(apiUrl,task_id){this.abortRequestInProgress=!0;Ext.Ajax.abort(this.requestId);var view=this.getView();if(Ext.isEmpty(task_id))Ext.isEmpty(this.waitMsgBox)||this.waitMsgBox.hide(),Ext.isEmpty(view)||view.close();
else{var ctrl=this;this.requestId=Ext.Ajax.request({url:API_ROOT+'printresult/cancel_print_task',params:Ext.Object.toQueryString({task_id:task_id}),timeout:6E4,method:'GET',callback:function(obj,success,response){view.close();Ext.isEmpty(ctrl.waitMsgBox)||ctrl.waitMsgBox.hide()},scope:this})}},repeateRequest:function(apiUrl,task_id){this.requestId=Ext.Ajax.request({url:apiUrl,params:Ext.Object.toQueryString({task_id:task_id}),timeout:6E4,method:'GET',success:this.onGetDocSuccess,failure:this.onGetDocFailure,
scope:this})},onGetDocSuccess:function(response,opts){if(!Ext.isEmpty(this)&&!this.abortRequestInProgress){opts=this.getView();var vm=this.getViewModel(),obj=Ext.decode(response.responseText);console.log('onGetDocSuccess',obj);if(1==obj.success){obj=obj.data;if(obj.in_process){this.task_id=obj.task_id;Ext.Function.defer(this.repeateRequest,3E3,this,[response.request.url,obj.task_id]);return}vm.set('filename',obj.filename);vm.set('desired_filename',obj.desired_filename);response='?fn\x3d'+obj.filename+
'\x26df\x3d'+encodeURIComponent(obj.desired_filename);vm.set('params',response);response=Ext.create({xtype:'component',id:'pdfDocument',autoEl:{tag:'embed',type:'application/pdf',width:'100%',src:vm.get('pdfUrl')+vm.get('params'),height:'100%'}});opts.setMaxWidth(app.viewport.width);opts.setMaxHeight(app.viewport.height);opts.add(response)}else opts.close(),app.showErrorMsg(MSG.COMMON_PRINT_ERR.title,MSG.COMMON_PRINT_ERR.msg);Ext.isEmpty(this.waitMsgBox)||this.waitMsgBox.hide()}},onGetDocFailure:function(response,
opts){this.abortRequestInProgress||(response=this.getView(),this.waitMsgBox.hide(),this.waitMsgBox=null,response.close(),app.showErrorMsg(MSG.COMMON_PRINT_ERR.title,MSG.COMMON_PRINT_ERR.msg))}});
Ext.define('Common.print.View',{xtype:'common-print-view',extend:Ext.window.Window,controller:'common-print-ctrl',showMaximized:!0,maximizable:!0,viewModel:{data:{hostUrl:'http://192.168.8.8',pdfUrl:API_ROOT+'printresult/pdf',odtUrl:API_ROOT+'printresult/odt'}},layout:{type:'hbox',align:'stretch'},dockedItems:[{xtype:'toolbar',docked:'top',items:[{text:'Отправить на печать',iconCls:I.Print,handler:'onPrintClick',hidden:!0},{text:'Скачать для редактирования',iconCls:I.Download,handler:'onDownloadClick'}]}],
items:{},showReport:function(scope,apiUrl){this.controller.showReport(scope,apiUrl)},setReport:function(reportUrl){this.controller.setReport(reportUrl)}});Ext.define('Panel.basePanel.View',{extend:Ext.panel.Panel,xtype:'panel-basepanel-view',config:{archive:!1},updateArchive:function(value){try{this.getViewModel().set('isArchive',value)}catch(e){console.log('Нет ViewModel!')}}});
Ext.define('Panel.editPanel.View',{extend:Ext.form.Panel,xtype:'panel-editpanel-view',cls:'fieldlabel-vertical-align',actions:{create:{text:'Создать',handler:'onCreateClick',iconCls:I.PlusCircle,tooltip:'Создать'},edit:{text:'Редактировать',handler:'onEditClick',iconCls:I.Edit,tooltip:'Редактировать данные'},save:{text:'Сохранить',handler:'onSaveClick',iconCls:I.Save,tooltip:'Сохранить изменения'},cancel:{text:'Отмена',handler:'onCancelClick',iconCls:I.Cancel,tooltip:'Отменить редактирование'}},bodyPadding:10});
Ext.define('Viewport.baseViewport.Ctrl',{extend:Ext.app.ViewController,alias:'controller.viewport-baseviewport-ctrl'});
Ext.define('Viewport.baseViewport.View',{extend:Ext.Viewport,layout:'border',controller:'viewport-baseviewport-ctrl',viewModel:'viewport-baseviewport-vm',config:{currentMode:null},updateCurrentMode:function(value){this.getViewModel().set('currentMode')},initComponent:function(){var baseItemCfg=this.getTopPanelConfig(this.config.currentMode);this.items.push(baseItemCfg);this.callParent(arguments)},getTopPanelConfig:function(currentMode){return{region:'north',reference:'top_area',collapsible:!1,bind:{bodyStyle:'background:#{backgroundColor}'},
margin:'0 0 0 0',items:[{xtype:'viewport-parttop-view',currentMode:currentMode}]}}});Ext.define('Viewport.baseViewport.Vm',{extend:Ext.app.ViewModel,alias:'viewmodel.viewport-baseviewport-vm',data:{globalRec:null,isCollapsed:'right',isCollapsible:!0,currentMenu:null,backgroundColor:'F0EDED',treeSelectedNodePath:null,type_of_prover:null,name_of_tom:null,centerCustomWgtTitle:null}});
Ext.define('Viewport.partTop.View',{extend:Ext.panel.Panel,xtype:'viewport-parttop-view',ui:'parttop',viewModel:{data:{currentMenu:'Загрузка...',currentIcon:null,currentUser:{familiya_inicialy:null}},formulas:{treePath:{bind:{bindTo:'{treeSelectedNodePath}'},get:function(path){console.log('treeSelectedNodePath',path);if(Ext.isEmpty(path))return null;path=path.replace('/root/','');path=Ext.util.Format.stripTags(path);console.log('treeSelectedNodePath',path);return path}},customWgtTitle:{bind:{bindTo:'{centerCustomWgtTitle}'},
get:function(wgtTitle){return wgtTitle}}},stores:{regimStore:{type:'common-simplelist',proxy:{type:'common-restproxy',url:API_ROOT+'api_v1/main/regims/'},autoLoad:!0,listeners:{load:'onRegimStoreLoaded'}},currentUserStore:{type:'common-simplelist',proxy:{type:'common-restproxy',url:API_ROOT+'api_v1/main/current_user/'},autoLoad:!0,listeners:{load:'onCurrentUserStoreLoaded'}}}},referenceHolder:!0,defaultListenerScope:!0,layout:{type:'hbox',pack:'start'},config:{currentMode:null,currentMenu:null,currentIcon:null},
items:[{xtype:'container',id:'buildinfobutton',height:5,width:5,style:'display:inline-block;background:#F0EDED;cursor:pointer;',listeners:{el:{click:'onShowVersionInfoClicked'}}},{xtype:'colorbutton',bind:'{backgroundColor}',width:5,height:5,hidden:!0},{xtype:'image',src:'\x3cshared\x3e/logo-small.png',margin:'5 5 10 5',flex:1,maxWidth:200},{xtype:'container',layout:'card',flex:1,reference:'path_label',margin:'0 5 5 5',items:[{xtype:'container',margin:'10, 0, 0, 0',bind:{data:{currentMenu:'{currentMenu}',
treePath:'{treePath}',customWgtTitle:'{customWgtTitle}'}},tpl:'\x3ctpl\x3e,\x3cdiv style\x3d"text-align: left; vertical-align: center; background-color: #{backgroundColor};,font-size: small;"\x3e,А-РСП/{currentMenu},\x3ctpl if\x3d{treePath}\x3e,/{treePath},\x3c/tpl\x3e,\x3ctpl if\x3d{customWgtTitle}\x3e,/{customWgtTitle},\x3c/tpl\x3e,\x3c/div\x3e\x3c/tpl\x3e'.split(',')}]},{xtype:'button',margin:'5 5 5 5',pack:'right',scale:'medium',reference:'regim_button',width:300,bind:{text:'{currentMenu}',iconCls:'{currentIcon}'}},
{xtype:'button',margin:'5 5 5 5',pack:'right',width:70,showSeparator:!0,iconCls:I.User,scale:'medium',menu:{xtype:'menu',width:70,showSeparator:!0,margin:'0 0 10 0',defaults:{width:400},items:[{xtype:'label',bind:{hidden:'{!currentUser}',html:'\x3cp style\x3d"font-size: smaller; font-weight: 700"\x3e{currentUser.familiya_inicialy}\x3c/p\x3e'},focusable:!1},{text:'\x3cb\x3eВыход\x3c/b\x3e',iconCls:'x-fa fa-sign-out-alt',handler:function(){window.location='http://'+window.location.host+'/logout'}}]}}],
initComponent:function(){this.callParent(arguments)},onItemClick:function(item){item=item.relativeUrl;Ext.isEmpty(item)||(window.location.href=window.location.origin+'/'+item)},onCurrentUserStoreLoaded:function(sender,records){sender=this.getViewModel();records&&records.length?sender.set('currentUser',records[0].data):sender.set('currentUser',null)},onRegimStoreLoaded:function(sender,records){sender=this.lookupReference('regim_button');var regimMenu=Ext.create('Ext.menu.Menu',{width:300,showSeparator:!0,
margin:'0 0 10 0',defaults:{width:300}}),currentMode=this.getCurrentMode(),vm=this.getViewModel();Ext.each(records,function(rec){console.log('regim records',rec);rec=rec.data;regimMenu.add({regim_id:rec.id,text:rec.name,iconCls:rec.icon_cls,relativeUrl:rec.relative_url,listeners:{click:'onItemClick'}});currentMode==rec.id&&(vm.set('currentMenu',rec.name),vm.set('currentIcon',rec.icon_cls))});sender.setMenu(regimMenu,!0)},onShowVersionInfoClicked:function(sender){sender='';Ext.manifest.version&&(sender+=
'Веб-интерфейс: '+Ext.manifest.version+'\n');current_version&&(sender+='Сборка: '+current_version+'\n');window.BACKEND_VERSION&&(sender+='\nВерсия сервера: '+window.BACKEND_VERSION+'\n');sender=sender.replace(/(?:\r\n|\r|\n)/g,'\x3cbr\x3e');Ext.Msg.alert('Версия',sender,Ext.emptyFn)},defaults:{bodyPadding:10}});
Ext.define('DopuskWork.Router',{extend:Ext.app.Controller,routes:{'sotrudnik_uid/:goto_params':{action:'onGoToSotrudnikByUUID'}},onGoToSotrudnikByUUID:function(values){console.log('ROUTER onGoToSotrudnikByUUID',values);app.GoToSotrudnikByUUID(values);CLEAR_URL_HASH()}});console.log('Начало!');
Ext.define('DopuskWork.cfg.consts',{singleton:!0,tip_ucheta_listov:{vidacha:1,spisanie:2,brak:3,unichtozenie_braka:4,vozvrat:5},tip_oznakomlenia:{doc:1,delo:2},grif_sekretnosti:{nesekretno:1,secretno:2,sovsekretno:3,osoboyvazn:4}});
Ext.define('DopuskWork.cfg.enums',{singleton:!0,getValue:function(enumObj,id,property){property=void 0===property?'value':property;return(enumObj=enumObj.find(function(i){return i.id==id}))?enumObj[property]:'---'},litera:[{id:1,value:'О'},{id:2,value:'М'}],stepen_rodstva:[{id:0,value:'Муж'},{id:1,value:'Жена'},{id:2,value:'Отец'},{id:3,value:'Мать'},{id:4,value:'Сын'},{id:5,value:'Дочь'},{id:6,value:'Брат'},{id:7,value:'Сестра'},{id:8,value:'Неполнородный брат'},{id:9,value:'Неполнородная сестра'},
{id:10,value:'Усыновитель'},{id:11,value:'Усыновленный'},{id:12,value:'Удочеренная'},{id:13,value:'Бывший муж'},{id:14,value:'Бывшая жена'}],dop_info_rodst:[{id:0,value:'Умер(-ла)'},{id:1,value:'Пропал(-ла) без вести'},{id:2,value:'Нет сведений'}],stepen_obrazovania:[{id:0,value:'Среднее общее'},{id:1,value:'Среднее профессиональное'},{id:2,value:'Высшее'}],litera_dostup:[{id:0,value:'Нет'},{id:1,value:'"О"'},{id:2,value:'"М"'}],yroven_dopyska:[{id:0,value:'Нет'},{id:1,value:'Первая форма'},{id:2,
value:'Вторая форма'},{id:3,value:'Третья форма'}],svedinia_stepen_sekretnosti:[{id:1,value:'Несекретно'},{id:2,value:'Секретно'},{id:3,value:'Сов. секретно'},{id:4,value:'Особой важности'}],status:[{id:0,value:'Кандидат в исполнители'},{id:1,value:'Исполнитель'},{id:2,value:'Уволенный'},{id:3,value:'Отказано в трудоустройстве'}],passport_type:[{id:0,value:'Общегражданский'},{id:1,value:'Заграничный'},{id:2,value:'Служебный'},{id:3,value:'Дипломатический'}],grif_sekretnosti:[{id:1,value:'Несекретно',
short_value:'НС'},{id:2,value:'Секретно',short_value:'С'},{id:3,value:'Совeршенно секретно',short_value:'СС'},{id:4,value:'Особой важности',short_value:'ОВ'}],srok_chranenia:[{id:1,value:'1 год'},{id:3,value:'3 года'},{id:5,value:'5 лет'},{id:10,value:'10 лет'},{id:30,value:'30 лет'},{id:75,value:'75 лет'},{id:100,value:'Постоянно'}],tip_spravochnika:[{id:1,value:'Виды объектов учета'},{id:2,value:'Место хранения'},{id:3,value:'Вид документа'},{id:4,value:'Пометка'},{id:5,value:'Отпечатано'},{id:6,
value:'Тип машинного носителя'}],prichina:[{id:0,value:'Отпуск'},{id:1,value:'Командировка'},{id:2,value:'Другое'}]});
Ext.define('app',{singleton:!0,API_URLS:{},API_ADDITIONAL_CONST:{withDeletedAction:'with_deleted'},userTreeConst:{node_root:'docroot',node_nomenklatura_dozn:'nomra_dolz',node_archive:'archive',node_archive_item:'archive_item',node_archive_dopol:'archive_dopol',node_archive_dopol_nomra_item:'archive_dopol_nomra_item',node_archive_dopol_nomra_dopol_item:'archive_dopol_nomra_dopol_item',node_approval:'approval',node_approval_item:'approval_item',node_approval_project_item:'approval_project_item',node_approval_dopolnenie_item:'approval_dopolnenie_item',
node_nomenklatura_item:'nomra_dolz_item',node_nomra_podr:'nomra_podr',node_department:'depart',node_depart_item:'depart_item',node_dolznost:'dolz',node_expected_list:'expected_list',node_sotrudniki:'sotrud',node_sotr_status_kand:'sotr_status_kandidat',node_sotr_status_isp:'sotr_status_ispolnitel',node_sotr_status_uvol:'sotr_status_uvolenniy',node_sotr_status_otk:'sotr_status_otkazano'},dirTreeConst:{node_root:'docroot',node_dirs:'dirs',node_dirs_item:'dirs_items'},docTreeConst:{node_root:'docroot',
node_nomenklatura:'nomra',node_nomenklatura_item:'nomra_item',node_jurnal_zuz:'zuz',node_jurnal_zuz_item:'zuz_item',node_jurnal_group:'jurnal_group',node_jurnal_item:'jurnal_item',node_vchodiashich:'vchodiashich',node_otpech_buro:'otpech_buro',node_podgotov:'podgotov',node_rab_tetradi:'rab_tetradi',node_mash_nositeley:'mash_nositeley',node_paketno_kontrol:'paketno_kontrol',node_invent_tehdoc:'invent_tehdoc',node_sbrosh_mater:'sbrosh_mater',node_otpravka:'otpravka',node_otpravka_ochered:'ochered_otpravki',
node_otpravka_sform_reestri:'ochered_sform_reestri',node_otpravka_otpravleno:'ochered_otpravleno',node_unichtozenie:'unichtozenie',node_unichtozenie_ochered:'unich_ochered',node_unichtozenie_reshenja:'unich_reshenja',node_unichtozenie_akti:'unich_akt',node_unichtozenie_unichtozenja:'unich_unichtozenja'},nomraTreeConst:{node_root:'docroot',node_archive:'archive',node_archive_item:'archive_item',node_archive_dopol:'archive_dopol',node_archive_dopol_nomra_item:'archive_dopol_nomra_item',node_archive_dopol_nomra_dopol_item:'archive_dopol_nomra_dopol_item'},
getCookie:function(name){var cookieValue=null;if(document.cookie&&''!=document.cookie)for(var cookies=document.cookie.split(';'),i=0;i<cookies.length;i++){var cookie=Ext.String.trim(cookies[i]);if(cookie.substring(0,name.length+1)==name+'\x3d'){cookieValue=decodeURIComponent(cookie.substring(name.length+1));break}}return cookieValue},DateFormat:'d.m.Y',DateTimeFormat:'d.m.Y H:i',UnderConstructionWgtCfg:{xtype:'container',layout:'center',items:{xtype:'label',html:'\x3cdiv style\x3d"text-align: center; vertical-align: center"\x3e\x3ch1\x3eВ РАЗРАБОТКЕ\x3c/h1\x3e\x3c/div\x3e'}},
SelectionChildWgtCfg:{xtype:'container',layout:'center',items:{xtype:'label',html:'\x3cdiv style\x3d"text-align: center; vertical-align: center"\x3e\x3ch1\x3eВыберете дочерний элемент\x3c/h1\x3e\x3c/div\x3e'}},getDateWithEndOfTheDay:function(date){return new Date(date.getFullYear(),date.getMonth(),date.getDate(),23,59,59)},showQuestion:function(title,msg,okCb,noCb,scope,animateTarget){Ext.MessageBox.show({title:title,msg:msg,buttons:Ext.MessageBox.YESNO,scope:scope,fn:function(btn){'yes'==btn?okCb():
noCb()},animateTarget:animateTarget,icon:Ext.MessageBox.QUESTION})},showConfirmDeleteQuestion:function(okCb,noCb,scope,animateTarget){app.showQuestion(MSG.COMMON_DELETE_QUESTION.title,MSG.COMMON_DELETE_QUESTION.msg,okCb,noCb,scope,animateTarget)},showCancelDirtyQuestion:function(okCb,noCb,scope,animateTarget){app.showQuestion(MSG.COMMON_SOTRUD_SAVE_QUESTION.title,MSG.COMMON_SOTRUD_SAVE_QUESTION.msg,okCb,noCb,scope,animateTarget)},showErrorMsg:function(title,msg,maskClickAction,animateTarget,fn,scope){fn=
void 0===fn?Ext.emptyFn:fn;scope=void 0===scope?app:scope;Ext.MessageBox.show({title:title,msg:msg,buttons:Ext.MessageBox.OK,animateTarget:void 0===animateTarget?null:animateTarget,scope:scope,fn:fn,icon:Ext.MessageBox.ERROR,maskClickAction:!0})},showSaveErrorMsg:function(animateTarget){app.showErrorMsg(MSG.COMMON_SAVE_ERR.title,MSG.COMMON_SAVE_ERR.msg,!1,animateTarget)},showDeleteErrorMsg:function(animateTarget){app.showErrorMsg(MSG.COMMON_DELETE_ERR.title,MSG.COMMON_DELETE_ERR.msg,!1,animateTarget)},
showGetDataErrorMsg:function(){app.showErrorMsg(MSG.COMMON_GET_ERR.title,MSG.COMMON_GET_ERR.msg,!1,animateTarget)},showInvalidFormMsg:function(animateTarget){app.showErrorMsg('Ошибка в данных!','Проверьте данные формы',!0,animateTarget)},getNotifyPopup:function(){var popUp=Ext.create('Ext.Component',{html:'',padding:5,floating:!0,y:1,hideMode:'offsets',width:'100%',shadow:!1,cls:'error-msg-div',style:{textAlign:'center'},renderTo:Ext.getBody()});popUp.task=new Ext.util.DelayedTask(popUp.getEl().fadeOut,
popUp.getEl());return popUp},showAjaxException:function(conn,response,options,eOpts){response.request&&!0===response.request.aborted||(app.isDebug?(console.log('EXCEPTION!',response),app.preventCreateDbgWnd||(app.hideFailureAlerts=!0,conn='Произошла непредвиденная ошибка при запросе. Возможно таймаут соединения',Ext.isEmpty(response.responseText)||(conn=response.responseText),app.errorWindow=new Ext.window.Window({title:'Отладочное окно. Произошла ошибка!',scrollable:!0,layout:'fit',width:600,height:500,
items:[{xtype:'textarea',value:conn}]}),app.errorWindow.show(),app.errorWindow.getEl().fadeIn())):app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR.msg))},makeReferences:function(){var vp=app.viewport;app.topArea=vp.lookupReference('top_area');app.bottomArea=vp.lookupReference('bottom_area');app.rightArea=vp.lookupReference('right_area');app.sotrudListRightArea=vp.lookupReference('sotrud_list_right_area');app.leftSotrArea=vp.lookupReference('left_sotr_area');app.dopuskTree=vp.lookupReference('dopusk_tab');
app.searchTree=vp.lookupReference('search_sotr_tab');app.normaArchiveTab=vp.lookupReference('nomra_archive_tab');app.usersPanel=vp.lookupReference('users_panel');app.mainTab=vp.lookupReference('main_tab');app.docTab=vp.lookupReference('doc_tab');app.poruchenjaTab=vp.lookupReference('poruchenja_tab');app.userTab=vp.lookupReference('user_tab');app.dirTab=vp.lookupReference('dir_tab');app.searchTab=vp.lookupReference('search_tab');app.centerArea=vp.lookupReference('center_area');app.docArea=vp.lookupReference('center_doc_area');
app.docAreaMain=vp.lookupReference('center_doc_area_main');app.docAreaCustom=vp.lookupReference('center_doc_area_custom');app.poruchenjaArea=vp.lookupReference('center_poruchenja_area');app.poruchenjaAreaMain=vp.lookupReference('center_poruchenja_area_main');app.poruchenjaAreaCustom=vp.lookupReference('center_poruchenja_area_custom');app.userArea=vp.lookupReference('center_user_area');app.userAreaMain=vp.lookupReference('center_user_area_main');app.userAreaCustom=vp.lookupReference('center_user_area_custom');
app.sotrudListArea=vp.lookupReference('center_sotrud_list_area');app.sotrudListAreaMain=vp.lookupReference('center_sotrud_list_area_main');app.sotrudListAreaCustom=vp.lookupReference('center_sotrud_list_area_custom');app.dirArea=vp.lookupReference('center_dir_area');app.dirAreaMain=vp.lookupReference('center_dir_area_main');app.dirAreaCustom=vp.lookupReference('center_dir_area_custom');app.searchArea=vp.lookupReference('center_search_area');app.searchAreaMain=vp.lookupReference('center_search_area_main');
app.searchAreaCustom=vp.lookupReference('center_search_area_custom');app.archiveArea=vp.lookupReference('center_archive_area');app.archiveAreaMain=vp.lookupReference('center_archive_area_main');app.archiveAreaCustom=vp.lookupReference('center_archive_area_custom')},gridItemDblClicked:function(sender,record,item,index,e,eOpts){app.setDocAreaCustomWgt({xtype:'sotr-doc-view-doc_pane-pane'})},gridSelectionChanged:function(sender,selected,eOpts){},exchangeMainCustomWgt:function(){var activeArea=app.centerArea.getLayout().getActiveItem(),
innerLayout=activeArea.getLayout();0!=activeArea.items.indexOf(innerLayout.getActiveItem())?(innerLayout.setActiveItem(0),app.viewport.viewModel.set('centerCustomWgtTitle',null)):innerLayout.setActiveItem(1)},setDocAreaMainWgt:function(wgtCfg){app.docAreaMain.removeAll();app.docAreaMain.add(Ext.create(wgtCfg));app.docArea.setActiveItem(app.docAreaMain)},goToObject:function(appType,type,uid,newTab){newTab=void 0===newTab?!1:newTab;type=type+'/'+uid;uid=app.viewport.getCurrentMode();if(appType!=uid){uid=
app.viewport.down('viewport-parttop-view').getViewModel().getStore('regimStore');console.log('regimStore',uid);var relativeUrl$0=null;uid.each(function(rec){rec=rec.data;console.log('regimStore.each',rec,appType);if(rec.id===appType)return relativeUrl$0=rec.relative_url,!1});Ext.isEmpty(relativeUrl$0)||GOTO_RELATIVE_URL(relativeUrl$0,type,newTab)}else GOTO_RELATIVE_URL(null,type,newTab)},GoToSotrudnikByUUID:function(sotrudnikUid){console.log('BEFORE REQUERST');Ext.Ajax.request({url:API_ROOT+'api_v1/dopuskwork/sotrudnik/',
method:'GET',params:{uid:sotrudnikUid},success:this.goToSotrudnikSuccess,failure:app.goToObjectFailure})},goToObjectFailure:function(){app.showErrorMsg(MSG.COMMON_GOTO_ERROR.title,MSG.COMMON_GOTO_ERROR.msg);app.goToGridObjectLoadMsk.hide()},goToSotrudnikSuccess:function(response){console.log('goToSotrudnikSuccess REQUERST',response);response=Ext.decode(response.responseText);if(1!=response.success||1!=response.data.length)app.goToObjectFailure();else{var sotrudRecord=DopuskWork.sotrud.Model.loadData(response.data[0]);
app.leftSotrArea.getActiveTab()!==app.dopuskTree&&app.leftSotrArea.setActiveTab(app.dopuskTree);app.goToGridObjectLoadMsk=new Ext.LoadMask({msg:'\x3cbr/\x3e\x3cb\x3eВыполняется переход к сотруднику....\x3c/b\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e',target:app.viewport});app.goToGridObjectLoadMsk.show();switch(response.data[0].status){case 0:app.dopuskTree.selectNodeByInnername('sotr_status_kandidat');break;case 1:app.dopuskTree.selectNodeByInnername('sotr_status_ispolnitel');break;case 2:app.dopuskTree.selectNodeByInnername('sotr_status_uvolenniy');
break;case 3:app.dopuskTree.selectNodeByInnername('sotr_status_otkazano')}CommonUtils.getRepeatePromise(20,200,function(){var node=app.dopuskTree.selection,result=!1;!node||'sotr_status_kandidat'!==node.data.innername&&'sotr_status_ispolnitel'!==node.data.innername&&'sotr_status_uvolenniy'!==node.data.innername&&'sotr_status_otkazano'!==node.data.innername||(node=app.userArea.down('dopuskwork-sotrud-view grid'))&&(result=node.getStore().isLoaded());return result}).then(function(){var grid=app.userArea.down('grid');
grid.lookupController(!0).onGridItem(grid,sotrudRecord)}).then(function(){app.goToGridObjectLoadMsk.hide()}).catch(function(){app.goToObjectFailure()})}},goToGridObject:function(targetDesc){var treeNode=targetDesc.treenode,targetId=targetDesc.target_id;app.goToGridObjectLoadMsk=new Ext.LoadMask({msg:'\x3cbr/\x3e\x3cb\x3eВыполняется переход к объекту....\x3c/b\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e',target:app.viewport});'users'==targetDesc.tab&&(app.normalSelectUserTree(treeNode),Ext.defer(function(){try{var grid=
app.userArea.down('grid'),ctrl=grid.lookupController(!0);(Ext.isEmpty(targetDesc.model)?grid.store.model:Ext.ClassManager.get(targetDesc.model)).load(targetId,{success:function(record){app.goToGridObjectLoadMsk.hide();app.setUserAreaCustomWgt({xtype:'dopuskwork-sotrud-panel-view',userRecord:record,sourceGrid:grid})},failure:function(record){console.error('load failed!');app.goToGridObjectLoadMsk.hide()},scope:ctrl})}catch(e){app.goToGridObjectLoadMsk.hide()}finally{DopuskWork.app.getController('DopuskWork.Router').redirectTo('')}},
1E3,this))},silenceSelectDocTree:function(innername){app.docTab.down('treepanel').selectNodeByInnername(innername)},normalSelectDocTree:function(innername){app.docTab.down('treepanel').selectNodeByInnername(innername,!1)},normalSelectUserTree:function(innername){app.leftSotrArea.down('treepanel').selectNodeByInnername(innername,!1)},updateDocTree:function(){app.docTab.down('treepanel').getViewModel().getStore('treestore').load()},updateUserTree:function(){app.userTab.down('treepanel').getViewModel().getStore('treestore').load()},
updateTree:function(){app.leftSotrArea.down('treepanel').getViewModel().getStore('treestore').load()},updateDirTree:function(){app.dirTab.down('treepanel').getViewModel().getStore('treestore').load()},updateArchiveTree:function(){var archiveTreeStore=Ext.data.StoreManager.lookup('archiveTreeStoreId');console.log('[i]\t docArchiveTabTree:',archiveTreeStore);archiveTreeStore.load()},getDocAreaMainWgt:function(){return app.docAreaMain.items.getAt(0)},setDocAreaCustomWgt:function(wgtCfg,title){title=
void 0===title?null:title;app.docAreaCustom.removeAll();app.docAreaCustom.add(Ext.create(wgtCfg));app.docArea.setActiveItem(app.docAreaCustom);app.viewport.viewModel.set('centerCustomWgtTitle',title)},setUserAreaMainWgt:function(wgtCfg){app.userAreaMain.removeAll();app.userAreaMain.add(Ext.create(wgtCfg));app.userArea.setActiveItem(app.userAreaMain)},setDirAreaMainWgt:function(wgtCfg){app.dirAreaMain.removeAll();app.dirAreaMain.add(Ext.create(wgtCfg));app.dirArea.setActiveItem(app.dirAreaMain)},setUserAreaCustomWgt:function(wgtCfg,
title){title=void 0===title?null:title;app.userAreaCustom.removeAll();app.userAreaCustom.add(Ext.create(wgtCfg));app.userArea.setActiveItem(app.userAreaCustom);app.viewport.viewModel.set('centerCustomWgtTitle',title)},setSotdrudListAreaCustomWgt:function(wgtCfg,title){title=void 0===title?null:title;app.sotrudListAreaCustom.removeAll();app.sotrudListAreaCustom.add(Ext.create(wgtCfg));app.sotrudListArea.setActiveItem(app.sotrudListAreaCustom);app.viewport.viewModel.set('centerCustomWgtTitle',title)},
initConnections:function(){},showDialogWnd:function(itemCfg){itemCfg=Ext.create('Ext.window.Window',{modal:!0,scrollable:'vertical',constrain:!0,height:app.viewport.getHeight()-30,layout:'fit',items:[itemCfg]});app.viewport.add(itemCfg);itemCfg.show();itemCfg.center()},setNomraAreaMainWgt:function(wgtCfg){app.archiveAreaMain.removeAll();app.archiveAreaMain.add(Ext.create(wgtCfg));app.archiveArea.setActiveItem(app.archiveAreaMain)},setNomraArchiveAreaMainWgt:function(wgtCfg,title){title=void 0===title?
null:title;app.archiveAreaCustom.removeAll();app.archiveAreaCustom.add(Ext.create(wgtCfg));app.archiveArea.setActiveItem(app.archiveAreaCustom);app.viewport.viewModel.set('centerCustomWgtTitle',title)},handleConflictSituation:function(response_obj,is_dopol,callback){function goToConflictsTab(conflict){callback();var tabBar=Ext.getCmp('nomra-tabs-view');tabBar.setActiveTab(is_dopol?3:4);setTimeout(function(){tabBar.getActiveTab().getComponent(0).getSelectionModel().select(0)},500)}function createConflict(index){console.log('[i] Create conflict №',
index);Ext.Ajax.request({url:API_ROOT+'api_v1/dopuskwork/dvizhenie/'+(is_dopol?'dopolnenie_nomradolznost_conflict/':'nomradolznost_conflict/'),method:'POST',params:requests_list[index],success:function(response,opts){console.log('[i]\t response:',response);index+1<requests_list.length?createConflict(index+1):(response=Ext.data.StoreManager.lookup(is_dopol?'dopolnenieConflictStore':'projectConflictStore'),console.log('[i] store loaded',response),response.on('load',function(){return goToConflictsTab(response_obj)}),
response.reload())},scope:app})}var requests_list=[];response_obj.data&&0<response_obj.data.length?Ext.MessageBox.show({title:'Конфликт',msg:response_obj.detail,buttons:Ext.MessageBox.YESNO,buttonText:{yes:'Перейти к решению конфликта',no:'Продолжить редактирование'},animateTarget:null,scope:app,fn:function(btn){'yes'===btn&&(response_obj.data.map(function(conflict_params){var doljnost_label=is_dopol?'dopolnenie_doljnost':'project_doljnost',doljnost=conflict_params.nomra_item;delete conflict_params.nomra_item;
conflict_params[doljnost_label]=doljnost;conflict_params.sotrudniki_list=JSON.stringify(conflict_params.sotrudniki_list);requests_list.push(conflict_params)}),0<requests_list.length&&createConflict(0));Ext.data.StoreManager.lookup(is_dopol?'storeDopolnenie':'storeProject').reload()},icon:Ext.MessageBox.WARNING,maskClickAction:!0}):response_obj.detail?app.showErrorMsg(MSG.COMMON_ERROR.title,response_obj.detail):app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR.msg)},goToNomradoljnost:function(nomra_stage,
nomradoljnost_id){function checkTabBar(step_number){try{if(console.log('[i] checkTabBar step:',step_number),tabBar=Ext.getCmp('nomra-tabs-view')){var loadPage=function(number){store.loadPage(number,{callback:function(records,operation,success){console.log('[i] callback args:',records,operation,success);found_record=store.getById(nomradoljnost_id);console.log('[i] found:',found_record);null!==found_record?(console.log('[i] recordToSelect:',found_record),grid.getSelectionModel().select(found_record),
app.goToGridObjectLoadMsk.hide()):records.length===store.getPageSize()?(console.log('[i] true compare:',records.length,store.getPageSize()),loadPage(number+1)):(console.log('[i] false compare:',records.length,store.getPageSize()),app.goToObjectFailure())}})};console.log('[i] SUCCESS in checkTabBar, tabBar:',tabBar);tabBar.setActiveTab(nomradoljTabIndex);var currTab=tabBar.getActiveTab();console.log('[i] currTab:',currTab);var grid='Проект'===currTab.title?currTab.getComponent(1).getComponent(0):currTab.getComponent(0);
console.log('[i] grid:',grid);var store=Ext.StoreManager.lookup(storeLabel);console.log('[i] store before loadPage:',store);var store2=Ext.StoreManager.lookup('storeDopolnenie');console.log('[i] store2',store2);loadPage(1)}else 10>step_number?setTimeout(function(){return checkTabBar(step_number+1)},1E3):app.goToObjectFailure()}catch(e){console.log('[i] goToObjectFailure:',e),app.goToObjectFailure()}}console.log('[i] goToNomradoljnost called:',nomra_stage,nomradoljnost_id);app.leftSotrArea.getActiveTab()!==
app.dopuskTree&&app.leftSotrArea.setActiveTab(app.dopuskTree);app.goToGridObjectLoadMsk=new Ext.LoadMask({msg:'\x3cbr/\x3e\x3cb\x3eВыполняется переход к должности....\x3c/b\x3e\x3cbr/\x3e\x3cbr/\x3e\x3cbr/\x3e',target:app.viewport});app.goToGridObjectLoadMsk.show();app.dopuskTree.selectNodeByInnername('nomra_dolz');switch(nomra_stage){case 2:var nomradoljTabIndex=0;var storeLabel='storeActual';break;case 4:nomradoljTabIndex=1;storeLabel='storeDopolnenie';break;case 1:nomradoljTabIndex=2,storeLabel=
'storeProject'}console.log('[i] nomradoljTabIndex:',nomradoljTabIndex);console.log('[i] storeLabel:',storeLabel);var tabBar,found_record;checkTabBar(0)},copyNomraToProject:function(nomra_id,nomra_stage,callback){function checkBeforeCopy(){console.log('[i] in checkBeforeCopy');Ext.Ajax.request({method:'POST',url:API_ROOT+'api_v1/dopuskwork/nomradolznost/'+nomra_id+'/check_before_copy/',success:function(response,opts){response=Ext.decode(response.responseText);console.log('[i] obj in checkBeforeCopy:',
response);response.success?(Ext.Msg.alert('️Копирование проекта','Содержимое '+title+' номенклатуры было успешно скопировано в проект',Ext.emptyFn),callback(),storeProject&&storeProject.reload()):handleCopyConflict(response)},failure:function(response,opts){app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR.msg)}})}function handleCopyConflict(obj){console.log('[i] in handleCopyConflict',obj);Ext.MessageBox.show({title:'Конфликт',msg:obj.detail,buttons:Ext.MessageBox.YESNO,buttonText:{yes:'Скопировать с конфликтами',
no:'Отменить копирование'},fn:function(btn){'yes'===btn&&Ext.Ajax.request({method:'POST',url:API_ROOT+'api_v1/dopuskwork/nomradolznost/'+nomra_id+'/copy_to_project/',success:function(response,opts){Ext.decode(response.responseText).success&&(callback(),Ext.Msg.alert('️Копирование проекта','Содержимое действующей номенклатуры было успешно скопировано в проект',Ext.emptyFn),storeProject&&storeProject.reload())}})},icon:Ext.MessageBox.WARNING,maskClickAction:!0})}function createProject(){console.log('[i] open create proj window');
var createNomraWnd=Ext.create({xtype:'window-editwindow-view',title:'Первичная регистрация проекта',resizable:!1,modal:!0,width:400,height:250,mode:'add',formModel:'DopuskWork.nomra.ModelCreateNomra',formClass:'nomra-create-view',formCustomItemsCfg:{stage:{value:'1'}}});createNomraWnd.show();createNomraWnd.on('beforeclose',function(wnd){wnd.wasSaved()&&checkBeforeCopy()},this)}callback=void 0===callback?Ext.emptyFn:callback;var storeProject=Ext.StoreManager.lookup('storeProject'),title=1===nomra_stage?
'действующей':'архивной';console.log('[i] store in copyNomraToProject:',storeProject);(function(){var projectExists;return $jscomp.asyncExecutePromiseGeneratorProgram(function($jscomp$generator$context){Ext.Ajax.request({method:'GET',url:API_ROOT+'api_v1/dopuskwork/nomradolznost/?stage\x3d1',success:function(response,opts){projectExists=0<Ext.decode(response.responseText).data.length;console.log('[i]\t got project exists:',projectExists);projectExists?checkBeforeCopy():createProject()},failure:function(response,
opts){app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR.msg);projectExists=null}});console.log('[i] return checkIfProjectExists:',projectExists);return $jscomp$generator$context.return(projectExists)})})()},sendDefaulRequest:function(type,url,params,callback){Ext.Ajax.request({method:type,url:url,params:params,success:function(response,opts){response=''!==response.responseText?Ext.decode(response.responseText):{success:!0};console.log('[i]\t obj:',response);response.success?callback(response):
(console.log('[i] FAILURE, obj',response),response.detail?app.showErrorMsg(MSG.COMMON_ERROR.title,response.detail):app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR))},failure:function(response,opts){app.showErrorMsg(MSG.COMMON_ERROR.title,MSG.COMMON_ERROR.msg)}})},loadPodrAndDoljnostById:function(podrId,doljId,callback){var $jscomp$this=this,url_dolj=API_ROOT+'api_v1/dopuskwork/dolznost/'+doljId;this.sendDefaulRequest('GET',API_ROOT+'api_v1/dopuskwork/podrazdelenie/'+podrId,{},function(podr_data){return $jscomp$this.sendDefaulRequest('GET',
url_dolj,{},function(dolj_data){return callback(podr_data.data,dolj_data.data)})})},getDataForma:function(strykt_podraz,doljnost,formaStore,callback){callback=void 0===callback?Ext.emptyFn:callback;console.log('[i] getDataForma: formaStore',formaStore);formaStore.removeFilter('podrazdelenie');formaStore.filter([{property:'podrazdelenie',value:strykt_podraz}]);formaStore.on('load',function(formaStoreLoaded){formaStoreLoaded.findBy(function(currRec,id){if(currRec.get('doljnost')===doljnost){console.log('[i] getDataForma: currRec found',
currRec);var dataForm=[];[{id:1,label:'Первая форма | ОВ',totalKey:'all_osob_vaj_number',currentKey:'current_osob_vaj_number',reserveKey:'reserve_ov_number'},{id:2,label:'Вторая форма | СС',totalKey:'all_sov_sec_number',currentKey:'current_sov_sec_number',reserveKey:'reserve_ss_number'},{id:3,label:'Третья форма | С',totalKey:'all_sec_number',currentKey:'current_sec_number',reserveKey:'reserve_s_number'}].map(function(currForm){var numberOfPositions=currRec.get(currForm.totalKey)-currRec.get(currForm.currentKey)-
currRec.get(currForm.reserveKey);console.log('[i] numberOfPositions',numberOfPositions);currForm={id:currForm.id,value:currForm.label+(' (Доступно: '+(0<numberOfPositions?numberOfPositions:0)+')'),disabled:0>=numberOfPositions};console.log('[i] data pushed:',currForm);dataForm.push(currForm)});id=currRec.get('workers_number');var otherCurrentNumber=currRec.get('all_sec_number')+currRec.get('all_sov_sec_number')+currRec.get('all_osob_vaj_number');id-=otherCurrentNumber;otherCurrentNumber=currRec.get('current_no_form_number');
var reserveNoFormNumber=currRec.get('reserve_no_form_number');id=id-otherCurrentNumber-reserveNoFormNumber;dataForm.push({id:0,value:'Нет (Доступно: '+(0<id?id:0)+')',disabled:0>=id});callback(dataForm);return!0}})})}});
Ext.define('DopuskWork.Application',{extend:'Ext.app.Application',name:'DopuskWork',requires:'DopuskWork.* app Ext.* Common.* Field.* Grid.* Panel.* Tree.* Viewport.* Window.*'.split(' '),controllers:'DopuskWork.Router',listen:{global:{unmatchedroute:'onUnmatchedRoute'}},quickTips:!1,platformConfig:{desktop:{quickTips:!0}},onAppUpdate:function(){Ext.Msg.confirm('Обновление приложения','Это приложение обновлено, перезагрузить страницу?',function(choice){'yes'===choice&&window.location.reload()})},
onUnmatchedRoute:function(hash){console.log('onUnmatchedRoute',hash)},initAppInstance:function(){Ext.ariaWarn=Ext.emptyFn;app.isDebug=!1;app.qq=Ext.ComponentQuery.query;Ext.Ajax.on('beforerequest',function(conn,options){console.log('Ajax',conn,options);options.headers=options.headers||{};options.headers['X-CSRFToken']=app.getCookie('csrftoken')},this);Ext.Ajax.on('requestexception',app.showAjaxException,this);app.viewport=new DopuskWork.main.viewport.View;Ext.QuickTips.init();Ext.apply(Ext.QuickTips.getQuickTip(),
{showDelay:1500});app.makeReferences();app.initConnections()},launch:function(){this.initAppInstance()}});Ext.define('CrudApp.model.Base',{extend:Ext.data.Model,schema:{namespace:'CrudApp.model'}});Ext.define('CrudApp.model.Cabinet',{extend:CrudApp.model.Base,alias:'model.cabinet',fields:[{type:'string',name:'name'}]});Ext.define('CrudApp.model.Department',{extend:CrudApp.model.Base,alias:'model.department',fields:[{type:'string',name:'name'}]});
Ext.define('CrudApp.model.Dolzhnost',{extend:CrudApp.model.Base,alias:'model.dolzhnost',fields:[{type:'string',name:'name'}]});Ext.define('CrudApp.model.Employee',{extend:CrudApp.model.Base,alias:'model.employee',fields:[{type:'string',name:'first_name'},{type:'string',name:'last_name'},{type:'string',name:'otchestvo'},{type:'int',name:'department'},{type:'int',name:'post'},{type:'int',name:'cabinet'}]});
var rowEditing=Ext.create('Ext.grid.plugin.RowEditing',{clicksToMoveEditor:1,autoCancel:!1}),cabinetStore=Ext.create('Ext.data.Store',{storeId:'cabinet',autoLoad:!0,autoSync:!0,model:'CrudApp.model.Cabinet',proxy:{type:'common-restproxy',url:API_ROOT+'api/main/cabinets'},listeners:{add:function(){console.log('DATA ADDED');cabinetStore.load()},remove:function(){console.log('DATA REMOVED');cabinetStore.load()}}});
Ext.define('CrudApp.view.main.ListCabinet',{extend:Ext.grid.Panel,xtype:'listCabinet',requires:[],title:'Список кабинетов',store:cabinetStore,plugins:[rowEditing],columns:[{text:'Наименование',width:200,dataIndex:'name',editor:{xtype:'textfield',allowBlank:!1}}],tbar:[{text:'➕ Добавить кабинет',handler:'onCreateCabinetBtnPressed'},{text:'\ud83d\uddd1️ Удалить кабинет',handler:function(){Ext.Msg.confirm('Подтверждение удаления','Вы уверены, что хотите безвозвратно удалить данный кабинет?',function(choice){'yes'===
choice&&(choice=this.up('grid').getSelectionModel(),rowEditing.cancelEdit(),console.log(cabinetStore.remove(choice.getSelection()[0])),0<cabinetStore.getCount()&&choice.select(0))},this)}},{text:'↺',handler:function(){cabinetStore.reload()}}],listeners:{}});rowEditing=Ext.create('Ext.grid.plugin.RowEditing',{clicksToMoveEditor:1,autoCancel:!1});
var departmentStore=Ext.create('Ext.data.Store',{storeId:'department',autoLoad:!0,autoSync:!0,model:'CrudApp.model.Department',proxy:{type:'common-restproxy',url:API_ROOT+'api/main/departments'},listeners:{add:function(){console.log('DATA ADDED');departmentStore.load()},remove:function(){console.log('DATA REMOVED');departmentStore.load()}}});
Ext.define('CrudApp.view.main.ListDepartment',{extend:Ext.grid.Panel,xtype:'listDepartment',requires:[],title:'Список отделов',store:departmentStore,plugins:[rowEditing],columns:[{text:'Наименование',width:200,dataIndex:'name',editor:{xtype:'textfield',allowBlank:!1}}],tbar:[{text:'➕ Добавить отдел',handler:'onCreateDepartmentBtnPressed'},{text:'\ud83d\uddd1️ Удалить отдел',handler:function(){Ext.Msg.confirm('Подтверждение удаления','Вы уверены, что хотите безвозвратно удалить данный отдел?',function(choice){'yes'===
choice&&(choice=this.up('grid').getSelectionModel(),rowEditing.cancelEdit(),console.log(departmentStore.remove(choice.getSelection()[0])),0<departmentStore.getCount()&&choice.select(0))},this)}},{text:'↺',handler:function(){departmentStore.reload()}}],listeners:{}});rowEditing=Ext.create('Ext.grid.plugin.RowEditing',{clicksToMoveEditor:1,autoCancel:!1});
var dolzhnostStore=Ext.create('Ext.data.Store',{storeId:'dolzhnost',autoLoad:!0,autoSync:!0,model:'CrudApp.model.Dolzhnost',proxy:{type:'common-restproxy',url:API_ROOT+'api/main/posts'},listeners:{add:function(){console.log('DATA ADDED');dolzhnostStore.load()},remove:function(){console.log('DATA REMOVED');dolzhnostStore.load()}}});
Ext.define('CrudApp.view.main.ListDolzhnost',{extend:Ext.grid.Panel,xtype:'listDolzhnost',requires:[],title:'Список должностей',store:dolzhnostStore,plugins:[rowEditing],columns:[{text:'Наименование',width:200,dataIndex:'name',editor:{xtype:'textfield',allowBlank:!1}}],tbar:[{text:'➕ Добавить должность',handler:'onCreateDolzhnostBtnPressed'},{text:'\ud83d\uddd1️ Удалить должность',handler:function(){Ext.Msg.confirm('Подтверждение удаления','Вы уверены, что хотите безвозвратно удалить данную должность?',
function(choice){'yes'===choice&&(choice=this.up('grid').getSelectionModel(),rowEditing.cancelEdit(),console.log(dolzhnostStore.remove(choice.getSelection()[0])),0<dolzhnostStore.getCount()&&choice.select(0))},this)}},{text:'↺',handler:function(){dolzhnostStore.reload()}}],listeners:{}});rowEditing=Ext.create('Ext.grid.plugin.RowEditing',{clicksToMoveEditor:1,autoCancel:!1});
var employeeStore=Ext.create('Ext.data.Store',{storeId:'employee',autoLoad:!0,autoSync:!0,model:'CrudApp.model.Employee',proxy:{type:'common-restproxy',url:API_ROOT+'api/main/employees'},listeners:{add:function(){console.log('DATA ADDED');employeeStore.load()},remove:function(){console.log('DATA REMOVED');employeeStore.load()}}});cabinetStore=Ext.getStore('cabinet');dolzhnostStore=Ext.getStore('dolzhnost');departmentStore=Ext.getStore('department');
Ext.define('CrudApp.view.main.ListEmployee',{extend:Ext.grid.Panel,xtype:'listEmployee',requires:[],title:'Список сотрудников',store:employeeStore,plugins:[rowEditing],columns:[{text:'Фамилия',width:200,dataIndex:'first_name',editor:{xtype:'textfield',allowBlank:!1}},{text:'Имя',width:200,dataIndex:'last_name',editor:{xtype:'textfield',allowBlank:!1}},{text:'Отчество',width:200,dataIndex:'otchestvo',editor:{xtype:'textfield',allowBlank:!1}},{text:'Отдел',width:200,dataIndex:'department',editor:{xtype:'combo',
allowBlank:!1,typeAhead:!0,triggerAction:'all',selectOnFocus:!1,displayField:'name',valueField:'id',store:departmentStore},renderer:function(value){console.log('department: ',value);return(value=departmentStore.getById(value))?value.data.name:'Не указано'}},{text:'Должность',width:200,dataIndex:'post',editor:{xtype:'combo',allowBlank:!1,typeAhead:!0,triggerAction:'all',selectOnFocus:!1,displayField:'name',valueField:'id',store:dolzhnostStore},renderer:function(value){console.log('post: ',value);return(value=
dolzhnostStore.getById(value))?value.data.name:'Не указано'}},{text:'Кабинет',width:200,dataIndex:'cabinet',editor:{xtype:'combo',allowBlank:!1,typeAhead:!0,triggerAction:'all',selectOnFocus:!1,displayField:'name',valueField:'id',store:cabinetStore},renderer:function(value){console.log('cabinet: ',value);return(value=cabinetStore.getById(value))?value.data.name:'Не указано'}}],tbar:[{text:'➕ Добавить сотрудника',handler:'onCreateEmployeeBtnPressed'},{text:'\ud83d\uddd1️ Удалить сотрудника',handler:function(){Ext.Msg.confirm('Подтверждение удаления',
'Вы уверены, что хотите безвозвратно удалить данного сотрудника?',function(choice){'yes'===choice&&(choice=this.up('grid').getSelectionModel(),rowEditing.cancelEdit(),console.log(employeeStore.remove(choice.getSelection()[0])),0<employeeStore.getCount()&&choice.select(0))},this)}},{text:'↺',handler:function(){employeeStore.reload()}}],listeners:{}});cabinetStore=Ext.getStore('cabinet');dolzhnostStore=Ext.getStore('dolzhnost');departmentStore=Ext.getStore('department');
var cabinetForm=new Ext.form.Panel({title:'Новый кабинет',floating:!0,url:API_ROOT+'api/main/cabinets/',layout:'column',defaults:{layout:'form',xtype:'container',defaultType:'textfield'},items:[{items:[{fieldLabel:'Наименование',name:'name',allowBlank:!1}]}],buttons:[{text:'Закрыть',handler:function(){cabinetForm.hide();this.up('form').getForm().reset()}},{text:'Очистить',handler:function(){this.up('form').getForm().reset()}},{text:'Добавить',formBind:!0,disabled:!0,handler:function(){var form$jscomp$0=
this.up('form').getForm();form$jscomp$0.isValid()&&form$jscomp$0.submit({success:function(form,action){console.log('Success',action.result.msg)},failure:function(form,action){console.log('Failed',action.result.msg)}});cabinetForm.hide()}}]}),dolzhnostForm=new Ext.form.Panel({title:'Новый отдел',floating:!0,url:API_ROOT+'api/main/posts/',layout:'column',defaults:{layout:'form',xtype:'container',defaultType:'textfield'},items:[{items:[{fieldLabel:'Наименование',name:'name',allowBlank:!1}]}],buttons:[{text:'Закрыть',
handler:function(){dolzhnostForm.hide();this.up('form').getForm().reset()}},{text:'Очистить',handler:function(){this.up('form').getForm().reset()}},{text:'Добавить',formBind:!0,disabled:!0,handler:function(){var form$jscomp$0=this.up('form').getForm();form$jscomp$0.isValid()&&form$jscomp$0.submit({success:function(form,action){console.log('Success',action.result.msg)},failure:function(form,action){console.log('Failed',action.result.msg)}});dolzhnostForm.hide()}}]}),departmentForm=new Ext.form.Panel({title:'Новый отдел',
floating:!0,url:API_ROOT+'api/main/departments/',layout:'column',defaults:{layout:'form',xtype:'container',defaultType:'textfield'},items:[{items:[{fieldLabel:'Наименование',name:'name',allowBlank:!1}]}],buttons:[{text:'Закрыть',handler:function(){departmentForm.hide();this.up('form').getForm().reset()}},{text:'Очистить',handler:function(){this.up('form').getForm().reset()}},{text:'Добавить',formBind:!0,disabled:!0,handler:function(){var form$jscomp$0=this.up('form').getForm();form$jscomp$0.isValid()&&
form$jscomp$0.submit({success:function(form,action){console.log('Success',action.result.msg)},failure:function(form,action){console.log('Failed',action.result.msg)}});departmentForm.hide()}}]}),employeeForm=new Ext.form.Panel({title:'Новый сотрудник',floating:!0,url:API_ROOT+'api/main/employees/',layout:'column',defaults:{layout:'form',xtype:'container',defaultType:'textfield'},items:[{items:[{fieldLabel:'Фамилия',name:'last_name',allowBlank:!1},{fieldLabel:'Имя',name:'first_name',allowBlank:!1},
{fieldLabel:'Отчество',name:'otchestvo',allowBlank:!1}]},{items:[{xtype:'combobox',fieldLabel:'Отдел',name:'department',allowBlank:!1,store:departmentStore,displayField:'name',valueField:'id'},{xtype:'combobox',fieldLabel:'Должность',name:'post',allowBlank:!1,store:dolzhnostStore,displayField:'name',valueField:'id'},{xtype:'combobox',fieldLabel:'Кабинет',name:'cabinet',allowBlank:!1,store:cabinetStore,displayField:'name',valueField:'id'}]}],buttons:[{text:'Закрыть',handler:function(){employeeForm.hide();
this.up('form').getForm().reset()}},{text:'Очистить',handler:function(){this.up('form').getForm().reset()}},{text:'Добавить',formBind:!0,disabled:!0,handler:function(){var form$jscomp$0=this.up('form').getForm();form$jscomp$0.isValid()&&form$jscomp$0.submit({success:function(form,action){console.log('Success',action.result.msg)},failure:function(form,action){console.log('Failed',action.result.msg)}});employeeForm.hide()}}]});
Ext.define('CrudApp.view.main.MainController',{extend:Ext.app.ViewController,alias:'controller.main',onItemSelected:function(sender,record){Ext.Msg.confirm('Confirm','Are you sure?','onConfirm',this)},onSelectionChange:function(sender,record){Ext.Msg.confirm('Confirm','Edit?','onConfirm',this)},onCreateDepartmentBtnPressed:function(sender,record){departmentForm.show()},onCreateDolzhnostBtnPressed:function(sender,record){dolzhnostForm.show()},onCreateCabinetBtnPressed:function(sender,record){cabinetForm.show()},
onCreateEmployeeBtnPressed:function(sender,record){employeeForm.show()},onConfirm:function(choice){}});Ext.define('CrudApp.view.main.MainModel',{extend:Ext.app.ViewModel,alias:'viewmodel.main',data:{name:'CrudApp',loremIpsum:'Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.'}});
Ext.define('CrudApp.view.main.Main',{extend:Ext.tab.Panel,xtype:'app-main',controller:'main',viewModel:'main',ui:'navigation',tabBarHeaderPosition:1,tabPosition:'left',tabRotation:0,titleRotation:0,header:{layout:{align:'left'},title:{bind:{text:'CRUD-app'},flex:0},iconCls:'fa-th-list'},tabBar:{flex:1,layout:{align:'stretch',overflowHandler:'none'}},responsiveConfig:{tall:{headerPosition:'top'},wide:{headerPosition:'left'}},defaults:{bodyPadding:0,tabConfig:{responsiveConfig:{wide:{iconAlign:'left',
textAlign:'left'},tall:{iconAlign:'top',textAlign:'center',width:120}}}},items:[{title:'Отделы',layout:'fit',items:[{xtype:'listDepartment'}]},{title:'Должности',layout:'fit',items:[{xtype:'listDolzhnost'}]},{title:'Кабинеты',layout:'fit',items:[{xtype:'listCabinet'}]},{title:'Сотрудники',layout:'fit',items:[{xtype:'listEmployee'}]}]});Ext.application({extend:'DopuskWork.Application',mainView:'CrudApp.view.main.Main'});